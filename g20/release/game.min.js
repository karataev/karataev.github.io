function Config(){}function startup(){game=new Phaser.Game(Config.WIDTH,Config.HEIGHT,Phaser.CANVAS,"gameArea"),game.state.add("Boot",App.BootState),game.state.add("Preloader",App.PreloaderState),game.state.add("MainMenu",App.MainMenuState),game.state.add("Gameplay",App.GameplayState),game.state.add("GameComplete",App.GameCompleteState),game.state.start("Boot")}Config.VERSION="0.1",Config.WIDTH=960,Config.HEIGHT=640,Config.LANGUAGE="en",Config.ANIMATION=!0,Config.SOUNDS_ENABLED=!0,Config.TRANSPARENT=!1,Config.START_LEVEL=0,Config.TEST_GAME_COMPLETE=!1,Config.SHOW_FPS=!0,Config.OPEN_ALL_LEVELS=!0,Config.ENABLE_CHEAT=!1,Config.RELEASE=!1,Config.RELEASE&&(Config.ANIMATION=!0,Config.SOUNDS_ENABLED=!0,Config.TRANSPARENT=!1,Config.START_LEVEL=0,Config.TEST_GAME_COMPLETE=!1,Config.SHOW_FPS=!1,Config.OPEN_ALL_LEVELS=!1,Config.ENABLE_CHEAT=!1),App.Data=Class.extend({init:function(){this.gameStartSignal=new Phaser.Signal,this.levelStartSignal=new Phaser.Signal,this.flagClickSignal=new Phaser.Signal,this.atlasName="atlas",this.json=JSON.parse(JSON.stringify(game.cache.getJSON("data"))),this.curLevel=void 0,this.gameStartSignal.add(this.gameStart,this),this.levelStartSignal.add(this.levelStart,this)},createLevels:function(){this.levels=[];for(var a=0;a<this.json.levels.length;a++){var b=new App.Level(a,this.json.levels[a]);this.levels.push(b)}},gameStart:function(){this.createLevels(),this.levelStartSignal.dispatch(Config.START_LEVEL)},levelStart:function(a){this.curLevel=this.levels[a],game.state.start("Gameplay")},getAtlasKey:function(a){return this.atlasName+"/"+a+"_0000"},addAtlasSprite:function(a,b){var c=util.getParam(b,"x",0),d=util.getParam(b,"y",0),e=util.getParam(b,"center",!1),f=util.getParam(b,"parent",game.world),g=util.getParam(b,"atlas","atlas"),h=game.add.sprite(c,d,g,g+"/"+a+"_0000",f);return e&&h.anchor.set(.5,.5),h}}),App.Level=Class.extend({init:function(a,b){this.id=a,this.data=b,this.isPlayerCorrect=!1}});var game,data,cookies,fader,sounds,util;App.Sounds=Class.extend({init:function(){this.musicChannel=void 0,this.music=void 0},startMusic:function(){Config.SOUNDS_ENABLED&&(this.musicChannel=game.add.audio("music",1,!0),this.musicChannel.play())},startLevelMusic:function(){Config.SOUNDS_ENABLED&&(this.music=game.sound.play("sndMusic",1,!0))},stopLevelMusic:function(){this.music&&(this.music.stop(),this.music=void 0)},stopMusic:function(){this.music&&(this.music.stop(),this.music=void 0)},play:function(a,b){var c=1;void 0!=b&&(c=b),Config.SOUNDS_ENABLED&&game.sound.play(a,c)}}),App.Util=Class.extend({init:function(){},getParam:function(a,b,c){return a&&"undefined"!=typeof a[b]?a[b]:c},pulse:function(a,b){void 0==b&&(b=1.2);var c=game.add.tween(a.scale).to({x:b,y:b},1e3,Phaser.Easing.Sinusoidal.InOut).to({x:1,y:1},1e3,Phaser.Easing.Sinusoidal.InOut).loop().start();return c},wobble:function(a,b){void 0==b&&(b=1);for(var c=game.add.tween(a.scale),d=0;b>d;d++){var c=c.to({x:1.2,y:.8},100,Phaser.Easing.Sinusoidal.InOut);c.to({x:1,y:1},100,Phaser.Easing.Sinusoidal.InOut)}c.start()},showWithAlpha:function(a,b){var c=util.getParam(b,"delay",0),d=util.getParam(b,"time",500),e=util.getParam(b,"y",0);if(a.alpha=0,game.add.tween(a).to({alpha:1},d,Phaser.Easing.Linear.None,!0,c),e){var f=a.y;a.y+=e,game.add.tween(a).to({y:f},d,Phaser.Easing.Cubic.Out,!0,c)}},showWithScale:function(a,b){var c=util.getParam(b,"delay",0),d=util.getParam(b,"time",500);return a.scale.x=a.scale.y=0,game.add.tween(a.scale).to({x:1,y:1},d,Phaser.Easing.Back.Out,!0,c)},slide:function(a,b){var c=util.getParam(b,"delay",0),d=util.getParam(b,"time",500),e=util.getParam(b,"x",0),f=util.getParam(b,"y",0),g=util.getParam(b,"alpha",0),h=util.getParam(b,"ease",Phaser.Easing.Cubic.Out),i=a.x,j=a.y;a.alpha=g,a.x+=e,a.y+=f,game.add.tween(a).to({alpha:1,x:i,y:j},d,h,!0,c)},formatTime:function(a){var b=Math.floor(a/60),c=a-60*b;return 10>b&&(b="0"+b),10>c&&(c="0"+c),b+":"+c},randomizeArray:function(a){for(var b,c,d=a.length;d>0;)c=Math.floor(Math.random()*d),d--,b=a[d],a[d]=a[c],a[c]=b;return a},randomizeAndCopyArray:function(a){var b=a.slice();return this.randomizeArray(b)},equalArrays:function(a,b){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0},getDist:function(a,b,c,d){var e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}}),App.Fader=Class.extend({init:function(a){this.game=a},fade:function(a,b){if(this.callback=a,this.scope=b,Config.ANIMATION){this.pic=game.add.sprite(0,0,"fader"),this.pic.alpha=0,this.pic.inputEnabled=!0;var c=game.add.tween(this.pic).to({alpha:.8},300,Phaser.Easing.Linear.None,!0);c.onComplete.addOnce(this.fadeInComplete,this)}else this.callback.call(this.scope)},fadeInComplete:function(){App.Fader.SHOULD_FADE_OUT=!0,this.callback.call(this.scope)},fadeOut:function(){App.Fader.SHOULD_FADE_OUT=!1,this.pic=game.add.sprite(0,0,"fader"),this.pic.inputEnabled=!0;var a=game.add.tween(this.pic).to({alpha:0},300,Phaser.Easing.Linear.None,!0);a.onComplete.addOnce(this.fadeOutComplete,this)},fadeOutComplete:function(){this.pic.destroy()}}),App.Fader.SHOULD_FADE_OUT=!1,App.FinalGrid=Class.extend({init:function(a){var b=util.getParam(a,"parent",game.world),c=util.getParam(a,"x",0),d=util.getParam(a,"y",0);this.group=game.add.group(b),this.group.x=c,this.group.y=d;var e;for(this.cells=[],e=0;e<data.levels.length;e++){var f=data.levels[e],g=e%5*130,h=80*Math.floor(e/5),i=new App.FinalGridCell({parent:this.group,level:f,x:g,y:h});this.cells.push(i)}this.showCells()},showCells:function(){for(var a=0;a<this.cells.length;a++){var b=this.cells[a];util.slide(b.group,{y:20,delay:200*a})}}}),App.FinalGridCell=Class.extend({init:function(a){var b=util.getParam(a,"parent",game.world),c=util.getParam(a,"x",0),d=util.getParam(a,"y",0);this.level=util.getParam(a,"level",void 0);var e=130,f=80,g=this.level.data.assets[0];this.group=game.add.group(b),this.group.x=c,this.group.y=d,this.flag=data.addAtlasSprite(g,{parent:this.group,atlas:"flags1"}),this.flag.scale.x=this.flag.scale.y=.33,this.flag.x=(e-this.flag.width)/2,this.flag.y=(f-this.flag.height)/2;var h=this.level.isPlayerCorrect?"gradeCorrect":"gradeWrong";this.grade=data.addAtlasSprite(h,{parent:this.group,x:e/2,y:f/2,center:!0})}}),App.GridCell=Class.extend({init:function(a,b){this.asset=a;var c=util.getParam(b,"x",0),d=util.getParam(b,"y",0),e=util.getParam("parent",b,game.world);this.group=game.add.group(e),this.group.x=c,this.group.y=d;var f=320,g=240;this.flag=new App.MyButton(a,this.click,this,{parent:this.group,center:!0,atlas:"flags1"}),this.flag.bt.x=f/2,this.flag.bt.y=g/2},click:function(){data.flagClickSignal.dispatch(this)},disable:function(){this.flag.disableClick()}}),App.MyButton=Class.extend({init:function(a,b,c,d){this.callback=b,this.callbackContext=c;var e=util.getParam(d,"x",0),f=util.getParam(d,"y",0),g=util.getParam(d,"center",!1),h=util.getParam(d,"parent",game.world),i=util.getParam(d,"atlas","atlas");this.wobble=util.getParam(d,"wobble",!1);var j=util.getParam(d,"scale",1);this.fade=util.getParam(d,"fade",!1);var k=i+"/"+a+"_0000";this.bt=game.add.button(e,f,i,this.clickHandler,this,k,k,k,k,h),this.bt.scale.x=this.bt.scale.y=j,this.bt.input.useHandCursor=!0,g&&this.bt.anchor.set(.5,.5)},clickHandler:function(){sounds.play("sndClick"),this.wobble&&util.wobble(this.bt),this.fade?fader.fade(this.callback,this.callbackContext):this.callback.call(this.callbackContext)},scaleHide:function(){game.add.tween(this.bt.scale).to({x:0,y:0},200,Phaser.Easing.Linear.None,!0)},scaleShow:function(){game.add.tween(this.bt.scale).to({x:1,y:1},200,Phaser.Easing.Linear.None,!0)},hide:function(){this.bt.scale.x=this.bt.scale.y=0},show:function(){this.bt.scale.x=this.bt.scale.y=1},disableClick:function(){this.bt.inputEnabled=!1},enableClick:function(){this.bt.inputEnabled=!0},destroy:function(){this.bt.destroy()}}),App.SoundIcon=Class.extend({init:function(a){var b=util.getParam(a,"x",0),c=util.getParam(a,"y",0),d=util.getParam(a,"scale",1),e=util.getParam(a,"parent",game.world);this.group=game.add.group(e),this.group.x=b,this.group.y=c,this.group.scale.x=this.group.scale.y=d,this.btOn=new App.MyButton("soundIconOn",this.sndClick,this,{center:!0,parent:this.group}),this.btOff=new App.MyButton("soundIconOff",this.sndClick,this,{center:!0,parent:this.group}),this.updateIcon()},updateIcon:function(){Config.SOUNDS_ENABLED?(this.btOn.show(),this.btOff.hide()):(this.btOn.hide(),this.btOff.show())},hide:function(){this.group.visible=!1},sndClick:function(){Config.SOUNDS_ENABLED=!Config.SOUNDS_ENABLED,this.updateIcon(),util.wobble(this.group)},disableClick:function(){this.btOn.disableClick(),this.btOff.disableClick()}}),App.BootState=function(){},App.BootState.prototype={preload:function(){this.load.image("preloadBar","assets/images/preloadBar.png"),this.load.image("preloadBarHolder","assets/images/preloadBarHolder.png"),this.load.image("background","assets/images/background.jpg"),game.stage.backgroundColor="#EBE7DA"},create:function(){this.game.input.maxPointers=1,game.device.desktop?this.desktopMode():this.mobileMode(),Config.TRANSPARENT&&(this.game.world.alpha=.5),this.game.state.start("Preloader")},desktopMode:function(){var a="0px auto",b=Config.WIDTH+"px",c=Config.HEIGHT+"px",d="2px solid black",e="0px 4px 17px 0px rgba(0,0,0,0.77)",f=document.getElementById("gameArea");f.style.width=b,f.style.height=c,f.style.margin=a,f.style.border=d,f.style["box-shadow"]=e,f.style["-webkit-box-shadow"]=e,f.style["-moz-box-shadow"]=e},mobileMode:function(){game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.pageAlignHorizontally=!0,game.scale.pageAlignVertically=!0,game.scale.enterPortrait.add(this.rescale,this),game.scale.enterLandscape.add(this.rescale,this),game.scale.setScreenSize(!0)},rescale:function(){var a=this.game;setTimeout(function(){a.scale.refresh()},500)}},App.GameCompleteState=function(){},App.GameCompleteState.prototype={create:function(){this.add.sprite(0,0,"background"),this.home=new App.MyButton("homeButton",this.homeClick,this,{x:895,y:560,center:!0,wobble:!0,fade:!0}),this.grid=new App.FinalGrid({parent:game.world,x:155,y:40});var a=this.getCorrectAnswersTotal(),b="Правильные ответы: "+a+"/"+data.levels.length;this.answersTf=game.add.text(Config.WIDTH/2,365,b,{font:"40px Arial",fill:"#FFFFFF"}),this.answersTf.anchor.set(.5,0);var c="";c=20==a?data.json.result20:19==a?data.json.result19:18==a?data.json.result18:a>15?data.json.result16:a>10?data.json.result15:data.json.result10,this.commentTf=game.add.text(Config.WIDTH/2,425,c,{font:"22px Arial",fill:"#FFFFFF"}),this.commentTf.anchor.set(.5,0),this.moreGamesTf=game.add.text(35,526,"Еще игры!",{font:"55px Arial",fill:"#FFFFFF"}),this.game1=new App.MyButton("game1",this.game1Click,this,{x:420,y:560,center:!0}),this.game2=new App.MyButton("game2",this.game2Click,this,{x:640,y:560,center:!0}),Config.ANIMATION&&this.showWithTweens(),App.Fader.SHOULD_FADE_OUT&&fader.fadeOut()},game1Click:function(){window.open("http://postepenno.com/meloch","_blank")},game2Click:function(){window.open("http://postepenno.com/ussr","_blank")},getCorrectAnswersTotal:function(){for(var a=0,b=0;b<data.levels.length;b++){var c=data.levels[b];c.isPlayerCorrect&&a++}return a},showWithTweens:function(){util.slide(this.answersTf,{y:20,delay:4e3}),util.slide(this.commentTf,{y:20,delay:4500}),util.slide(this.moreGamesTf,{y:20,delay:5500}),util.slide(this.game1.bt,{y:20,delay:5700}),util.slide(this.game2.bt,{y:20,delay:5900}),util.slide(this.home.bt,{y:20,delay:6e3})},homeClick:function(){game.state.start("MainMenu")}},App.GameplayState=function(){},App.GameplayState.prototype={create:function(){this.add.sprite(0,0,"background"),this.uiGroup=new Phaser.Group(this.game,this.game.world),this.home=new App.MyButton("homeButton",this.homeClick,this,{x:920,y:45,center:!0,parentGroup:this.uiGroup,wobble:!0,fade:!0}),this.soundIcon=new App.SoundIcon({x:840,y:45});var a=data.curLevel.id+1+". "+data.curLevel.data.country;this.titleTf=game.add.text(Config.WIDTH/2,120,a,{font:"60px Arial",fill:"#FFFFFF"}),this.titleTf.anchor.set(.5,.5),this.createCells(),Config.ANIMATION&&this.showWithTweens(),App.Fader.SHOULD_FADE_OUT&&fader.fadeOut(),data.flagClickSignal.add(this.flagClick,this)},showWithTweens:function(){util.slide(this.titleTf,{x:-100});for(var a=0;a<this.cells.length;a++){var b=this.cells[a];util.slide(b.group,{y:100,delay:300+100*a,ease:Phaser.Easing.Back.Out})}},createCells:function(){this.cells=[];for(var a=0,b=160,c=[0,320,640,0,320,640],d=[0,0,0,240,240,240],e=util.randomizeAndCopyArray(data.curLevel.data.assets),f=0;f<c.length;f++){var g=e[f],h=new App.GridCell(g,{x:a+c[f],y:b+d[f],parent:game.world});this.cells.push(h)}},flagClick:function(a){this.playerFlag=a;var b,c=data.curLevel.data.assets[0];for(b=0;b<this.cells.length;b++)this.cells[b].disable();for(b=0;b<this.cells.length;b++){var d=this.cells[b];d.asset!=this.playerFlag.asset?game.add.tween(d.group).to({alpha:0},500,Phaser.Easing.Cubic.Out,!0):game.add.tween(d.group).to({x:Config.WIDTH/2-160,y:180},800,Phaser.Easing.Cubic.Out,!0)}var e="",f="#000000",g=0;this.playerFlag.asset===c?(data.curLevel.isPlayerCorrect=!0,g=Math.floor(Math.random()*data.json.commentsCorrect.length),e=data.json.commentsCorrect[g],f="#7EEE1A",this.sndAsset="sndCorrect"):(g=Math.floor(Math.random()*data.json.commentsWrong.length),e=data.json.commentsWrong[g],f="#FB1D11",this.sndAsset="sndWrong"),this.commentTf=game.add.text(Config.WIDTH/2,440,e,{font:"40px Arial",fill:f}),this.commentTf.anchor.set(.5,.5),this.next=new App.MyButton("nextButton",this.nextClick,this,{x:480,y:520,center:!0,parentGroup:this.uiGroup,wobble:!0}),util.slide(this.commentTf,{delay:500,y:20}),game.time.events.add(500,this.playSound,this),util.slide(this.next.bt,{delay:1e3,y:20})},playSound:function(){sounds.play(this.sndAsset)},nextClick:function(){this.next.disableClick(),game.add.tween(this.titleTf).to({x:this.titleTf.x+100,alpha:0},500,Phaser.Easing.Cubic.Out,!0),game.add.tween(this.next.bt).to({x:this.next.bt.x+100,alpha:0},500,Phaser.Easing.Cubic.Out,!0),game.add.tween(this.commentTf).to({x:this.commentTf.x+100,alpha:0},500,Phaser.Easing.Cubic.Out,!0),game.add.tween(this.playerFlag.group).to({x:this.playerFlag.group.x+100,alpha:0},500,Phaser.Easing.Cubic.Out,!0),game.time.events.add(500,this.stateEnd,this)},stateEnd:function(){var a=data.curLevel.id+1;data.levels[a]?data.levelStartSignal.dispatch(a):game.state.start("GameComplete")},homeClick:function(){game.state.start("MainMenu")},shutdown:function(){data.flagClickSignal.remove(this.flagClick,this)}},App.MainMenuState=function(){},App.MainMenuState.prototype={create:function(){game.add.sprite(0,0,"background"),data.addAtlasSprite("g20",{x:480,y:300,center:!0}),this.playBt=new App.MyButton("playButton",this.playClick,this,{x:480,y:540,center:!0,wobble:!1,fade:!0}),util.pulse(this.playBt.bt,.9),this.soundIcon=new App.SoundIcon({x:910,y:590});var a=game.add.text(5,Config.HEIGHT-5,"v "+Config.VERSION,{font:"12px Arial",fill:"#000000"});a.anchor.set(0,1),this.titleTf=game.add.text(Config.WIDTH/2,62,"БОЛЬШАЯ ДВАДЦАТКА",{font:"54px Arial",fill:"#FFFFFF"}),this.titleTf.anchor.set(.5,0);var b=data.addAtlasSprite("rus1",{atlas:"flags1"});b.y=Config.HEIGHT,App.Fader.SHOULD_FADE_OUT&&fader.fadeOut()},showWithTweens:function(){util.slide(this.title.group,{delay:500,time:1e3,y:-400,alpha:1,ease:Phaser.Easing.Back.Out}),util.showWithScale(this.creditsBt.bt,{delay:1e3}),util.showWithScale(this.soundIcon.group,{delay:1200}),util.showWithAlpha(this.playBt.bt,{delay:1500})},playClick:function(){Config.TEST_GAME_COMPLETE?game.state.start("GameComplete"):data.gameStartSignal.dispatch()}},App.PreloaderState=function(){},App.PreloaderState.prototype={preload:function(){this.add.sprite(0,0,"background");var a,b=["fader","blackBack"],c=["sndClick","sndCorrect","sndWrong"];for(a=0;a<b.length;a++){var d=-1==b[a].indexOf(".jpg")?b[a]+".png":b[a];this.load.image(b[a],"assets/images/"+d)}for(a=0;a<c.length;a++){var e=c[a]+".mp3",f=c[a]+".ogg";this.load.audio(c[a],["assets/sounds/"+e,"assets/sounds/"+f])}this.load.atlasJSONHash("atlas","assets/images/atlas.png","assets/images/atlas.json"),this.load.atlasJSONHash("flags1","assets/images/flags1.png","assets/images/flags1.json"),this.load.json("data","assets/json/data.json"),this.holder=this.game.add.group();var g=280,h=270;this.preloadBar=this.add.sprite(g+7,h+7,"preloadBar",null,this.holder),this.add.sprite(g,h,"preloadBarHolder",null,this.holder),this.titleTf=this.game.add.text(Config.WIDTH/2,240,"ЗАГРУЗКА...",{font:"bold 40px Arial",fill:"#FFFFFF"},this.holder),this.titleTf.anchor.set(.5,.5),this.progressTxt=this.game.add.text(Config.WIDTH/2,340,"0%",{font:"bold 40px Arial",fill:"#FFFFFF"},this.holder),this.progressTxt.anchor.set(.5,.5),this.load.setPreloadSprite(this.preloadBar),this.load.onFileComplete.add(this.fileLoaded,this)},fileLoaded:function(a){this.progressTxt.setText(a+"%")},create:function(){if(Config.ANIMATION){var a=this.game.add.tween(this.holder).to({alpha:0,y:this.holder.y+60},400,Phaser.Easing.Linear.None,!0);a.onComplete.addOnce(this.preloaderComplete,this)}else this.preloaderComplete()},preloaderComplete:function(){fader=new App.Fader(this.game),data=new App.Data,sounds=new App.Sounds,util=new App.Util,game.state.start("MainMenu")}};