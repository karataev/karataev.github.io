function Config(){}function startup(){game=new Phaser.Game(Config.WIDTH,Config.HEIGHT,Phaser.CANVAS,"gameArea"),game.state.add("Boot",App.BootState),game.state.add("Preloader",App.PreloaderState),game.state.add("MainMenu",App.MainMenuState),game.state.add("LevelSelect",App.LevelSelectState),game.state.add("Gameplay",App.GameplayState),game.state.add("GameComplete",App.GameCompleteState),game.state.start("Boot")}App.Commands=Class.extend({init:function(){},gameStart:function(){Config.TEST_GAME_COMPLETE?cmd.gameComplete():game.state.start("LevelSelect")},levelStart:function(a){data.curLevel=data.levels[a],data.levelStartTime=game.time.now,data.pauseTime=0,data.curLevel.moves=0,game.state.start("Gameplay")},playerMadeMove:function(){data.curLevel.moves++,game.state.getCurrentState().updateMoves()},levelComplete:function(){game.state.getCurrentState().levelComplete(),data.curLevel.complete(),cookies.levelComplete(),sounds.play("sndLevelComplete")},levelNext:function(){var a=data.curLevel.id,b=data.levels[a+1];b?fader.fade(this.gotoNextLevel,this):cmd.gameComplete()},gotoNextLevel:function(){var a=data.curLevel.id;cmd.levelStart(a+1)},gameComplete:function(){fader.fade(this.doGameComplete,this)},doGameComplete:function(){game.state.start("GameComplete")}}),Config.VERSION="0.8",Config.WIDTH=640,Config.HEIGHT=832,Config.LANGUAGE="en",Config.ANIMATION=!0,Config.SOUNDS_ENABLED=!1,Config.TRANSPARENT=!1,Config.START_LEVEL=0,Config.TEST_GAME_COMPLETE=!1,Config.SHOW_FPS=!0,Config.OPEN_ALL_LEVELS=!0,Config.ENABLE_CHEAT=!0,Config.DEBUG_GRID=!1,Config.RELEASE=!0,Config.RELEASE&&(Config.ANIMATION=!0,Config.SOUNDS_ENABLED=!0,Config.TRANSPARENT=!1,Config.START_LEVEL=0,Config.TEST_GAME_COMPLETE=!1,Config.SHOW_FPS=!1,Config.OPEN_ALL_LEVELS=!1,Config.ENABLE_CHEAT=!1),App.Cookies=Class.extend({init:function(){this.gameStorageKey="iknowart2",this.initSound(),this.isNewGame=!0,this.initLevels()},isSupported:function(){var a="test",b=window.sessionStorage;try{return b.setItem(a,"1"),b.removeItem(a),!0}catch(c){return!1}},getStorage:function(a){return localStorage[this.gameStorageKey+"."+a]},setStorage:function(a,b){this.isSupported()&&(localStorage[this.gameStorageKey+"."+a]=b)},initSound:function(){Config.SOUNDS_ENABLED="false"==this.getStorage("soundEnabled")?!1:!0},saveSound:function(){this.setStorage("soundEnabled",Config.SOUNDS_ENABLED)},initLevels:function(){if(void 0!=this.getStorage("levels"))for(var a=0;a<data.levels.length;a++){var b=data.levels[a];if("true"==this.getStorage("levels."+a+".isCompleted")){b.isOpen=!0,b.isCompleted=!0;var c=this.getStorage("levels."+a+".bestMoves");void 0!=c&&(b.bestMoves=parseInt(c)),this.isNewGame=!1}}this.updateOpenLevels()},updateOpenLevels:function(){var a,b;if(Config.OPEN_ALL_LEVELS)for(a=0;a<data.levels.length;a++)b=data.levels[a],b.isOpen=!0;else for(a=0;a<data.levels.length;a++)if(b=data.levels[a],!b.isCompleted){b.isOpen=!0;break}},levelComplete:function(){this.setStorage("levels","true");var a=data.curLevel.id;this.setStorage("levels."+a+".isCompleted","true"),this.setStorage("levels."+a+".bestMoves",data.curLevel.bestMoves),this.isNewGame=!1,this.updateOpenLevels()},clear:function(){localStorage.clear(),this.isNewGame=!0,this.uncompleteLevels(),this.updateOpenLevels()},uncompleteLevels:function(){for(var a=0;a<data.levels.length;a++){var b=data.levels[a];b.reset()}}}),App.Data=Class.extend({init:function(){this.texts=JSON.parse(game.cache.getText("textData")),this.curLevel=null,this.levelStartTime=0,this.levelStartTime=0,this.pauseTime=0,this.pausedByUser=!1,this.initPaintings(),this.initLevels(),this.atlasName="atlas"},text:function(a){return data.texts[Config.LANGUAGE][a]},getAtlasKey:function(a){return this.atlasName+"/"+a+"_0000"},addAtlasSprite:function(a,b){var c=0,d=0,e=game.world,f=!1;b&&(void 0!=b.x&&(c=b.x),void 0!=b.y&&(d=b.y),1==b.center&&(f=!0),void 0!=b.parent&&(e=b.parent));var g=game.add.sprite(c,d,this.atlasName,this.getAtlasKey(a),e);return f&&g.anchor.set(.5,.5),g},createPaintingSprite:function(a){var b=this.getPaintingByName(a);return new Phaser.Sprite(game,0,0,b.atlasName,b.atlasName+"/"+a+"_0000")},addPainting:function(a,b){this.paintings.push({name:a,desc:b,atlasName:"paintings"})},addPainting2:function(a,b){this.paintings.push({name:a,desc:b,atlasName:"paintings2"})},getPaintingDesc:function(){var a=this.getPaintingByName(this.curLevel.data.painting);return a.desc[Config.LANGUAGE]},getPaintingByName:function(a){var b,c;for(b=0;b<this.paintings.length;b++)if(c=this.paintings[b],c.name==a)return c;return null},initPaintings:function(){this.paintings=[],this.STARRY_NIGHT="picStarryNight",this.MONA_LISA="picMonaLisa",this.EARRING="picEarring",this.BURNING="picBurning",this.HARVEST="picHarvest",this.TREES="picMastTreeGrove",this.CAGE="picCage",this.LIFE_LINE="picLifeLine",this.OLD_MUSICIAN="picOldMusician",this.LILIES="picLilies",this.WAVE="picWave",this.WOMAN="picWoman",this.TOWER="picTower",this.CAFE="picCafe",this.SUNFLOWERS="picSunflowers",this.RIVER="picRiver",this.addPainting(this.MONA_LISA,{en:"Leonardo da Vinci\nMona Lisa (1503-1519)",ru:"Леонардо да Винчи\nМона Лиза (1503-1519)"}),this.addPainting(this.EARRING,{en:"Johannes Vermeer\nGirl with a Pearl Earring (1665)",ru:"Ян Вермеер\nДевушка с жемчужной сережкой (1665)"}),this.addPainting(this.OLD_MUSICIAN,{en:"Edouard Manet\nThe Old Musician (1862)",ru:"Эдуард Мане\nСтарый музыкант (1862)"}),this.addPainting(this.BURNING,{en:"Eero Jarnefelt\nBurning the Brushwood (1893)",ru:"Ээро Ярнефельт\nСжигание хвороста (1893)"}),this.addPainting(this.HARVEST,{en:"Vincent Van Gogh\nHarvest in Provence (1888)",ru:"Винсент Ван Гог\nСбор урожая (1888)"}),this.addPainting(this.TREES,{en:"Ivan Shishkin\nMast-Tree grove (1887)",ru:"Иван Шишкин\nКорабельная роща (1887)"}),this.addPainting(this.CAGE,{en:"Berthe Morisot\nThe Cage (1885)",ru:"Берта Моризо\nКлетка (1885)"}),this.addPainting(this.LIFE_LINE,{en:"Winslow Homer\nThe Life Line (1884)",ru:"Уинслоу Хомер\nЛиния жизни (1884)"}),this.addPainting(this.STARRY_NIGHT,{en:"Vincent van Gogh\nThe Starry Night (1889)",ru:"Винсент Ван Гог\nЗвездная ночь (1889)"}),this.addPainting2(this.LILIES,{en:"Claude Monet\nWater Lilies (1906)",ru:"Клод Моне\nВодяные лилии (1906)"}),this.addPainting2(this.WAVE,{en:"Kasushika Hokusai\nGreat Wave Off Kanagawa (1830)",ru:"Кацусика Хокусай\nБольшая волна в Канагаве (1830)"}),this.addPainting2(this.WOMAN,{en:"Johannes Vermeer\nYoung Woman with a Water Pitcher (1665)",ru:"Ян Вермеер\nМолодая женщина с кувшином воды (1665)"}),this.addPainting2(this.TOWER,{en:"Pieter Brueghel the Elder\nTower of Babel (1563)",ru:"Питер Брейгель Старший\nВавилонская башня (1563)"}),this.addPainting2(this.CAFE,{en:"Vincent Van Gogh\nCafe Terrace at Night (1888)",ru:"Винсент Ван Гог\nНочная терраса кафе (1888)"}),this.addPainting2(this.SUNFLOWERS,{en:"Vincent van Gogh\nVase with Twelve Sunflowers (1888)",ru:"Винсент Ван Гог\nПодсолнухи (1888)"}),this.addPainting2(this.RIVER,{en:"Emilio Sanchez-Perrier\nBoating on the River (1890)",ru:"Эмилио Санчез Перье\nКатаение на лодке по реке (1890)"})},initLevels:function(){this.levels=[],this.addLevel({painting:this.MONA_LISA,type:"rotateTiles",divide:2}),this.addLevel({painting:this.EARRING,type:"swapTiles",divide:2}),this.addLevel({painting:this.HARVEST,type:"rotateCircle",circles:[{x:320,y:320,radius:180,startAngle:180}]}),this.addLevel({painting:this.TREES,type:"dragTiles",tiles:[{from:{row:2,col:0},to:{row:2,col:4}},{from:{row:4,col:2},to:{row:1,col:2}}]}),this.addLevel({painting:this.CAGE,type:"rotateTiles",divide:3}),this.addLevel({painting:this.STARRY_NIGHT,type:"swapTiles",divide:3}),this.addLevel({painting:this.LILIES,type:"rotateCircle",circles:[{x:160,y:160,radius:125,startAngle:120},{x:480,y:160,radius:125,startAngle:70},{x:160,y:470,radius:125,startAngle:180},{x:480,y:470,radius:125,startAngle:220}]}),this.addLevel({painting:this.CAFE,type:"dragTiles",tiles:[{from:{row:1,col:0},to:{row:0,col:0}},{from:{row:0,col:1},to:{row:4,col:1}},{from:{row:4,col:2},to:{row:2,col:2}},{from:{row:2,col:3},to:{row:3,col:3}},{from:{row:3,col:4},to:{row:1,col:4}}]}),this.addLevel({painting:this.LIFE_LINE,type:"rotateTiles",divide:3,matrix:[[0,1]]}),this.addLevel({painting:this.WOMAN,type:"swapTiles",divide:4}),this.addLevel({painting:this.SUNFLOWERS,type:"rotateCircle",circles:[{x:320,y:320,radius:275,startAngle:120},{x:320,y:320,radius:200,startAngle:45},{x:320,y:320,radius:130,startAngle:-100}]}),this.addLevel({painting:this.BURNING,type:"dragTiles",tiles:[{from:{row:1,col:0},to:{row:1,col:2}},{from:{row:3,col:0},to:{row:3,col:3}},{from:{row:2,col:1},to:{row:2,col:2}},{from:{row:1,col:2},to:{row:4,col:2}},{from:{row:2,col:3},to:{row:2,col:0}},{from:{row:1,col:4},to:{row:3,col:4}},{from:{row:3,col:4},to:{row:1,col:4}}]}),this.addLevel({painting:this.RIVER,type:"rotateTiles",divide:3,matrix:[[0,-1],[0,1]]}),this.addLevel({painting:this.TOWER,type:"swapTiles",divide:5}),this.addLevel({painting:this.OLD_MUSICIAN,type:"rotateTiles",divide:5,matrix:[[0,-1],[-1,0],[-1,-1]]}),this.addLevel({painting:this.WAVE,type:"rotateTiles",divide:5,matrix:[[-2,0],[-1,0],[1,0],[2,0]]})},createDummyLevels:function(){for(var a=0;a<this.paintings.length;a++){var b=this.paintings[a];this.addLevel({painting:b.name,type:"rotateTiles",divide:3})}},addLevel:function(a){var b=this.levels.length,c=new App.Level(b,a);this.levels.push(c)},getLevelTime:function(){return Math.round(game.time.elapsedSince(this.levelStartTime)-data.pauseTime)},getTotalTime:function(){for(var a=0,b=0;b<this.levels.length;b++){var c=this.levels[b];c.isCompleted&&(a+=c.bestTime)}return a},getTotalMoves:function(){for(var a=0,b=0;b<this.levels.length;b++){var c=this.levels[b];c.isCompleted&&void 0!=c.bestMoves&&(a+=c.bestMoves)}return a}}),App.Dialog=Class.extend({init:function(a,b,c){this.game=a;var d=0,e=0,f=!1,g=!0;if(c&&(void 0!=c.x&&(d=c.x),void 0!=c.y&&(e=c.y),1==c.blockBack&&(f=!0),0==c.doTween&&(g=!1)),this.holder=new Phaser.Group(this.game,this.game.world),f&&(this.block=new Phaser.Sprite(this.game,0,0,"blackBack"),this.block.inputEnabled=!0,this.holder.add(this.block)),this.boxHolder=new Phaser.Group(this.game,this.holder),this.boxHolder.x=d,this.boxHolder.y=e,this.box=data.addAtlasSprite(b,{parent:this.boxHolder}),g){var h=this.boxHolder.y;this.boxHolder.y=Config.HEIGHT,this.game.add.tween(this.boxHolder).to({y:h},1e3,Phaser.Easing.Back.Out,!0),f&&(this.block.alpha=0,this.game.add.tween(this.block).to({alpha:1},500,Phaser.Easing.Linear.None,!0))}},destroy:function(){this.holder.destroy()}}),App.Level=Class.extend({init:function(a,b){this.id=a,this.data=b,this.moves=void 0,this.bestMoves=void 0,this.reset()},reset:function(){this.isCompleted=!1,this.isOpen=!1},complete:function(){this.isCompleted=!0,void 0!=this.bestMoves?this.moves<this.bestMoves&&(this.bestMoves=this.moves):this.bestMoves=this.moves},getTitle:function(){return this.data.name}});var game,cmd,data,cookies,fader,sounds,util;App.Sounds=Class.extend({init:function(){this.musicChannel=void 0},startMusic:function(){Config.SOUNDS_ENABLED&&(this.musicChannel=game.add.audio("music",1,!0),this.musicChannel.play())},stopMusic:function(){this.musicChannel&&this.musicChannel.pause()},play:function(a,b){var c=1;void 0!=b&&(c=b),Config.SOUNDS_ENABLED&&game.sound.play(a,c)}}),App.Util=Class.extend({init:function(){},pulse:function(a,b){void 0==b&&(b=1.2),game.add.tween(a.scale).to({x:b,y:b},1e3,Phaser.Easing.Sinusoidal.InOut).to({x:1,y:1},1e3,Phaser.Easing.Sinusoidal.InOut).loop().start()},wobble:function(a,b){void 0==b&&(b=1);for(var c=game.add.tween(a.scale),d=0;b>d;d++){var c=c.to({x:1.2,y:.8},100,Phaser.Easing.Sinusoidal.InOut);c.to({x:1,y:1},100,Phaser.Easing.Sinusoidal.InOut)}c.start()},tweenWithAlpha:function(a,b){a.alpha=0,game.add.tween(a).to({alpha:1},500,Phaser.Easing.Linear.None,!0,b)},formatTime:function(a){var b=Math.floor(a/1e3),c=Math.floor(b/3600),d=Math.floor((b-3600*c)/60),e=b-3600*c-60*d;return 10>c&&(c="0"+c),10>d&&(d="0"+d),10>e&&(e="0"+e),d+":"+e},randomizeArray:function(a){for(var b,c,d=a.length;d>0;)c=Math.floor(Math.random()*d),d--,b=a[d],a[d]=a[c],a[c]=b;return a},randomizeAndCopyArray:function(a){var b=a.slice();return this.randomizeArray(b)},equalArrays:function(a,b){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0},getDist:function(a,b,c,d){var e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}}),App.CreditsView=App.Dialog.extend({init:function(a){this._super(a,"creditsBox",{x:70,y:120,blockBack:!0}),this.closeBt=new App.MyButton(this.game,"closeButton",this.closeClick,this,{x:470,y:30,center:!0,parentGroup:this.boxHolder}),this.logoBt=new App.MyButton(this.game,"postepennoLogo",this.logoClick,this,{x:125,y:160,parentGroup:this.boxHolder});var b=data.text("credits"),c=a.add.text(250,60,b,{font:"60px Arial",fill:"#000000",align:"center"},this.boxHolder);c.anchor.set(.5,.5)},closeClick:function(){this.destroy()},logoClick:function(){window.open("http://postepenno.com","_blank")}}),App.Fader=Class.extend({init:function(a){this.game=a},fade:function(a,b){if(this.callback=a,this.scope=b,Config.ANIMATION){this.pic=game.add.sprite(0,0,"fader"),this.pic.alpha=0,this.pic.inputEnabled=!0;var c=game.add.tween(this.pic).to({alpha:.8},300,Phaser.Easing.Linear.None,!0);c.onComplete.addOnce(this.fadeInComplete,this)}else this.callback.call(this.scope)},fadeInComplete:function(){App.Fader.SHOULD_FADE_OUT=!0,this.callback.call(this.scope)},fadeOut:function(){App.Fader.SHOULD_FADE_OUT=!1,this.pic=game.add.sprite(0,0,"fader"),this.pic.inputEnabled=!0;var a=game.add.tween(this.pic).to({alpha:0},300,Phaser.Easing.Linear.None,!0);a.onComplete.addOnce(this.fadeOutComplete,this)},fadeOutComplete:function(){this.pic.destroy()}}),App.Fader.SHOULD_FADE_OUT=!1,App.Gallery=Class.extend({init:function(a){this.group=game.add.group(a),this.grid=new App.Grid(this.group,640,640,5,5),this.bornModes=[],this.addBornMode({useScale:!0,useRotation:!1,startFrom:"center"}),this.addBornMode({useScale:!0,useRotation:!0,startFrom:"topLeft"}),this.addBornMode({useScale:!0,useRotation:!1,startFrom:"topLeft"}),this.startRound()},addBornMode:function(a){this.bornModes.push(new App.BornMode(a))},startRound:function(){var a=Math.floor(Math.random()*this.bornModes.length);this.bornMode=this.bornModes[a];var b=Math.floor(Math.random()*data.paintings.length);this.sourceSprite=data.createPaintingSprite(data.paintings[b].name),this.createTiles(),this.showTiles(),game.time.events.add(this.bornMode.showTime,this.endRound,this)},createTiles:function(){this.tiles=[];for(var a=0;a<this.grid.rows;a++)for(var b=0;b<this.grid.cols;b++){var c=a*this.grid.cols+b,d=new App.PicTileGallery(this,c,this.group,this.sourceSprite,a,b,this.grid.cellWidth,this.grid.cellHeight);this.tiles.push(d)}},showTiles:function(){for(var a=0;a<this.tiles.length;a++){var b=this.tiles[a];b.born(this.bornMode)}},endRound:function(){this.hideTiles(),game.time.events.add(3*Phaser.Timer.SECOND,this.roundComplete,this)},hideTiles:function(){for(var a=0;a<this.tiles.length;a++){var b=this.tiles[a],c=100*a;b.dieWithScale(c)}},destroyTiles:function(){for(var a=0;a<this.tiles.length;a++){var b=this.tiles[a];b.destroy()}},roundComplete:function(){this.destroyTiles(),this.startRound()}}),App.BornMode=Class.extend({init:function(a){this.useScale=!0,this.useRotation=!0,this.startFrom="topLeft",a&&(void 0!=a.useScale&&(this.useScale=a.useScale),void 0!=a.useRotation&&(this.useRotation=a.useRotation),void 0!=a.startFrom&&(this.startFrom=a.startFrom)),this.showTime=3e3,"topLeft"==this.startFrom?this.showTime=5e3:"center"==this.startFrom&&(this.showTime=4e3)},getDelay:function(a){return"topLeft"==this.startFrom?100*(5*a.row+a.col):"center"==this.startFrom?300*(Math.abs(2-a.row)+Math.abs(2-a.col)):void 0}}),App.GameLogic=Class.extend({init:function(a){this.group=game.add.group(a),this.group.x=0,this.group.y=0,this.sourceSprite=data.createPaintingSprite(data.curLevel.data.painting);var b=data.curLevel.data.divide,c=data.curLevel.data.divide;this.grid=new App.Grid(this.group,this.sourceSprite.width,this.sourceSprite.height,b,c),this.isTweening=!1,game.input.onDown.add(this.touchDownHandler,this)},touchDownHandler:function(a){Math.round(a.x),Math.round(a.y);console.log("game logic. override.")},getTileUnderPoint:function(a,b){for(var c=0;c<this.tiles.length;c++){var d=this.tiles[c];if(d.isPointInside(a,b))return d}return null},getTileAt:function(a,b){for(var c=0;c<this.tiles.length;c++){var d=this.tiles[c];if(d.row==a&&d.col==b)return d}return null},update:function(){}}),App.GameTitle=Class.extend({init:function(a,b){this.group=game.add.group(),this.group.x=a,this.group.y=b,this.wordIY=17,this.wordKnowY=35,this.wordArtY=36,this.word2Y=38,this.wordI=data.addAtlasSprite("wordI",{x:0,y:this.wordIY,parent:this.group}),this.wordKnow=data.addAtlasSprite("wordKnow",{x:130,y:this.wordKnowY,parent:this.group}),this.wordArt=data.addAtlasSprite("wordArt",{x:340,y:this.wordArtY,parent:this.group}),this.word2=data.addAtlasSprite("word2",{x:470,y:this.word2Y,parent:this.group}),this.time=0},update:function(){this.wordI.y=this.wordIY+15*Math.sin(this.time+.4*3),this.wordKnow.y=this.wordKnowY+15*Math.sin(this.time+.8),this.wordArt.y=this.wordArtY+15*Math.sin(this.time+.4),this.word2.y=this.word2Y+15*Math.sin(this.time+0),this.time+=.05}}),App.Grid=Class.extend({init:function(a,b,c,d,e){this.rows=d,this.cols=e,this.width=b,this.height=c,this.group=game.add.group(a),this.cellWidth=Math.round(this.width/this.cols),this.cellHeight=Math.round(this.height/this.rows);var f,g;for(this.cells=[],f=0;d>f;f++)for(g=0;e>g;g++){var h=f*e+g,i=new App.GridCell(this,this.group,h,f,g);this.cells.push(i)}Config.DEBUG_GRID&&this.drawCells()},drawCells:function(){for(this.g=new Phaser.Graphics(game,0,0),this.group.add(this.g),this.g.clear(),this.g.lineStyle(2,7829367),i=0;i<=this.cols;i++)this.g.moveTo(i*this.cellWidth,0),this.g.lineTo(i*this.cellWidth,this.height);for(i=0;i<=this.rows;i++)this.g.moveTo(0,i*this.cellHeight),this.g.lineTo(this.width,i*this.cellHeight)}}),App.GridCell=Class.extend({init:function(a,b,c,d,e){this.id=c,this.grid=a,this.row=d,this.col=e,this.x=e*a.cellWidth,this.y=d*a.cellHeight,Config.DEBUG_GRID&&game.add.text(this.x+5,this.y+5,c.toString(),{font:"12px Arial",fill:"#000000"},b)}}),App.LanguageButton=Class.extend({init:function(a){var b=0,c=0,d=1,e=game.world;void 0!=a&&(void 0!=a.x&&(b=a.x),void 0!=a.y&&(c=a.y),void 0!=a.scale&&(d=a.scale),void 0!=a.parentGroup&&(e=a.parentGroup)),this.group=game.add.group(e),this.group.x=b,this.group.y=c,this.group.scale.x=this.group.scale.y=d,this.english=new App.MyButton(game,"flagEn",this.click,this,{center:!0,parentGroup:this.group}),this.russian=new App.MyButton(game,"flagRu",this.click,this,{center:!0,parentGroup:this.group}),this.updateIcon()},updateIcon:function(){this.english.hide(),this.russian.hide(),"en"==Config.LANGUAGE?this.english.show():"ru"==Config.LANGUAGE&&this.russian.show()},click:function(){util.wobble(this.group),"en"==Config.LANGUAGE?Config.LANGUAGE="ru":"ru"==Config.LANGUAGE&&(Config.LANGUAGE="en"),this.updateIcon()}}),App.LevelItem=Class.extend({init:function(a,b,c,d,e){if(this.game=a,this.level=c,this.parentGroup=b,this.group=new Phaser.Group(this.game,this.parentGroup),this.group.x=d,this.group.y=e,c.isOpen){var f,g=0;c.isCompleted?(f="levelItemCompleteBack",g=3757085):(f="levelItemBack",g=16777215),this.bt=new App.MyButton(this.game,f,this.click,this,{center:!0,parentGroup:this.group});var h=this.game.add.bitmapText(0,0,"eras",(this.level.id+1).toString(),50,this.group);if(h.x=.5*-h.textWidth,h.y=.3*-h.textHeight,h.tint=g,c.isCompleted){var i=0;void 0!=c.bestMoves&&(i=c.bestMoves);var j=this.game.add.bitmapText(0,0,"eras",i.toString(),18,this.group);j.x=.5*-j.textWidth,j.y=.5*-j.textHeight+30,j.tint=2236962}}else{var k=data.addAtlasSprite("levelItemLockedBack",{x:0,y:0,parent:this.group});k.anchor.set(.5,.5)}},click:function(){util.wobble(this.group),fader.fade(this.go,this)},go:function(){cmd.levelStart(this.level.id)}}),App.LevelsGroup=Class.extend({init:function(a,b,c){this.game=a,this.id=b,this.parentGroup=c,this.group=new Phaser.Group(this.game,this.parentGroup),this.group.y=this.id*Config.HEIGHT;var d=80,e=85;this.rows=4,this.cols=4,this.boundsRect={x:95,y:105,width:450,height:440};for(var f=this.rows*this.cols,g=(this.boundsRect.width-d)/(this.cols-1),h=(this.boundsRect.height-e)/(this.rows-1),i=this.id*f,j=(this.id+1)*f,k=0,l=i;j>l;l++){var m=data.levels[l];if(m){var n=this.boundsRect.x+d/2+k%this.cols*g,o=this.boundsRect.y+e/2+Math.floor(k/this.cols)*h;new App.LevelItem(this.game,this.group,m,n,o)}k++}},drawBounds:function(){this.g=game.add.graphics(0,0,this.group),this.g.clear(),this.g.lineStyle(5,this.color),this.g.drawRect(this.boundsRect.x,this.boundsRect.y,this.boundsRect.width,this.boundsRect.height)}}),App.LogicDragTiles=Class.extend({init:function(a){this.group=game.add.group(a),this.sourceSprite=data.createPaintingSprite(data.curLevel.data.painting),this.group.add(this.sourceSprite),this.createTiles(),this.activeTile=null,game.input.onDown.add(this.touchDownHandler,this)},createTiles:function(){this.tiles=[];for(var a=0;a<data.curLevel.data.tiles.length;a++){var b=data.curLevel.data.tiles[a];this.addTile(b.from,b.to)}},addTile:function(a,b){var c=this.tiles.length,d=new App.PicTileDrag(this,c,this.group,this.sourceSprite,a,b);this.tiles.push(d)},touchDownHandler:function(a){var b=Math.round(a.x),c=Math.round(a.y),d=this.getTileUnderPoint(b-this.group.x,c-this.group.y);d&&(this.activeTile=d,this.activeTile.select(b,c),this.activeTile.toTop(),this.update(),game.input.onUp.add(this.touchUpHandler,this))},getTileUnderPoint:function(a,b){for(var c=0;c<this.tiles.length;c++){var d=this.tiles[c];if(d.isPointInside(a,b))return d}return null},touchUpHandler:function(){game.input.onUp.remove(this.touchUpHandler,this),cmd.playerMadeMove(),this.maybeLevelComplete(),this.activeTile=null},maybeLevelComplete:function(){var a=10;this.activeTile.getDistance()<a&&(this.activeTile.victory(),this.removeTile(this.activeTile),0==this.tiles.length?(game.input.onDown.add(this.touchDownHandler,this),cmd.levelComplete()):sounds.play("sndGood"))},removeTile:function(a){var b=this.tiles.indexOf(a);this.tiles.splice(b,1)},update:function(){this.activeTile&&this.activeTile.update()}}),App.LogicRotateCircle=Class.extend({init:function(a){this.group=game.add.group(a),this.group.x=0,this.group.y=0,this.sourceSprite=data.createPaintingSprite(data.curLevel.data.painting),this.group.add(this.sourceSprite),this.circles=[];for(var b=0;b<data.curLevel.data.circles.length;b++){var c=data.curLevel.data.circles[b];this.addCircle(c)}this.activeCircle=null,game.input.onDown.add(this.touchDownHandler,this)},addCircle:function(a){var b=new App.RotationCircle(this.group,this.sourceSprite,a.x,a.y,a.radius,a.startAngle);this.circles.push(b)},touchDownHandler:function(a){var b=Math.round(a.x),c=Math.round(a.y),d=this.getCircleUnderPoint(b,c);d&&(game.input.onUp.add(this.touchUpHandler,this),this.activeCircle=d,this.activeCircle.updateOffsetAngle(b,c),this.update())},getCircleUnderPoint:function(a,b){for(var c=null,d=1e3,e=0;e<this.circles.length;e++){var f=this.circles[e];f.isPointInside(a,b)&&f.radius<d&&(c=f,d=f.radius)}return c},touchUpHandler:function(){game.input.onUp.remove(this.touchUpHandler,this),cmd.playerMadeMove(),this.maybeLevelComplete(),this.activeCircle=null},maybeLevelComplete:function(){var a=this.activeCircle.getAngle();Math.abs(a)<5&&(this.activeCircle.victory(),this.removeCircle(this.activeCircle),0==this.circles.length?(game.input.onDown.remove(this.touchDownHandler,this),cmd.levelComplete()):sounds.play("sndGood"))},removeCircle:function(a){var b=this.circles.indexOf(a);this.circles.splice(b,1)},update:function(){if(this.activeCircle){var a=game.input.activePointer.worldX,b=game.input.activePointer.worldY;this.activeCircle.rotateToPoint(a,b)}}}),App.LogicRotateTiles=App.GameLogic.extend({init:function(a){this._super(a),this.matrix=data.curLevel.data.matrix,void 0==this.matrix&&(this.matrix=[]),this.createTiles(),this.shuffleTilesRotation()},createTiles:function(){this.tiles=[];for(var a=0;a<this.grid.rows;a++)for(var b=0;b<this.grid.cols;b++){var c=a*this.grid.cols+b,d=new App.PicTileRotate(this,c,this.group,this.sourceSprite,a,b,this.grid.cellWidth,this.grid.cellHeight);this.tiles.push(d)}},shuffleTilesRotation:function(){for(var a=0;a<this.tiles.length;a++){var b=this.tiles[a],c=this.getRand();b.setRotationState(c)}},getRand:function(){return(void 0==this.randoms||0==this.randoms.length)&&(this.randoms=[0,1,2,3],util.randomizeArray(this.randoms)),this.randoms.pop()},touchDownHandler:function(a){var b=Math.round(a.x),c=Math.round(a.y),d=this.getTileUnderPoint(b-this.group.x,c-this.group.y);d&&!this.isTweening&&(this.isTweening=!0,d.rotateNext(),this.rotateMatrixTiles(d.row,d.col),cmd.playerMadeMove())},rotateMatrixTiles:function(a,b){for(var c=0;c<this.matrix.length;c++){var d=this.matrix[c],e=d[0],f=d[1],g=this.getTileAt(a+e,b+f);g&&g.rotateNext()}},tileDoneRotation:function(){0!=this.isTweening&&(this.isTweening=!1,this.maybeLevelComplete())},maybeLevelComplete:function(){for(var a=0;a<this.tiles.length;a++){var b=this.tiles[a];if(0!=b.rotationState)return}game.input.onDown.remove(this.touchDownHandler,this),cmd.levelComplete()}}),App.LogicSwapTiles=App.GameLogic.extend({init:function(a){this._super(a),this.createTiles(),this.shuffleTilesPosition(),this.selectedTile=null},createTiles:function(){this.tiles=[];for(var a=0;a<this.grid.rows;a++)for(var b=0;b<this.grid.cols;b++){var c=a*this.grid.cols+b,d=new App.PicTileSwap(this,c,this.group,this.sourceSprite,a,b,this.grid.cellWidth,this.grid.cellHeight);this.tiles.push(d)}},shuffleTilesPosition:function(){var a,b,c=[];for(a=0;a<this.grid.rows;a++)for(b=0;b<this.grid.cols;b++)c.push({row:a,col:b});do var d=util.randomizeAndCopyArray(c);while(util.equalArrays(c,d));for(a=0;a<this.tiles.length;a++){var e=d[a],f=this.tiles[a];f.setRowCol(e.row,e.col)}},touchDownHandler:function(a){var b=Math.round(a.x),c=Math.round(a.y),d=this.getTileUnderPoint(b-this.group.x,c-this.group.y);d&&!this.isTweening&&(this.selectedTile?(d!=this.selectedTile&&(this.swapTiles(this.selectedTile,d),cmd.playerMadeMove()),this.selectedTile.deselect(),this.selectedTile=null):(this.selectedTile=d,this.selectedTile.select(),this.selectedTile.toTop()))},swapTiles:function(a,b){this.isTweening=!0,a.toTop(),b.toTop();var c=a.row,d=a.col;a.tweenRowCol(b.row,b.col),b.tweenRowCol(c,d)},tileDoneTranslation:function(){0!=this.isTweening&&(this.isTweening=!1,this.maybeLevelComplete())},maybeLevelComplete:function(){for(var a=0,b=0;b<this.grid.rows;b++)for(var c=0;c<this.grid.cols;c++){var d=this.tiles[a];if(d.row!=b||d.col!=c)return;a++}cmd.levelComplete(),game.input.onDown.remove(this.touchDownHandler,this)},update:function(){this.selectedTile&&this.selectedTile.updateSelected()}}),App.MyButton=Class.extend({init:function(a,b,c,d,e){this.game=a;var f=0,g=0;this.callback=c,this.callbackContext=d;var h=!1,i=a.world,j=!0;if(this.wobble=!1,e&&(void 0!=e.x&&(f=e.x),void 0!=e.y&&(g=e.y),1==e.center&&(h=!0),void 0!=e.parentGroup&&(i=e.parentGroup),e.atlas===!1&&(j=!1),1==e.wobble&&(this.wobble=!0)),j){var k=data.getAtlasKey(b);this.bt=a.add.button(f,g,data.atlasName,this.clickHandler,this,k,k,k,k,i)}else this.bt=a.add.button(f,g,b,this.clickHandler,this,null,null,null,null,i);this.bt.input.useHandCursor=!0,h&&this.bt.anchor.set(.5,.5)},clickHandler:function(){sounds.play("sndClick"),this.wobble&&util.wobble(this.bt),this.callback.call(this.callbackContext)},scaleHide:function(){this.game.add.tween(this.bt.scale).to({x:0,y:0},200,Phaser.Easing.Linear.None,!0)},scaleShow:function(){this.game.add.tween(this.bt.scale).to({x:1,y:1},200,Phaser.Easing.Linear.None,!0)},hide:function(){this.bt.scale.x=this.bt.scale.y=0},show:function(){this.bt.scale.x=this.bt.scale.y=1},disableClick:function(){this.bt.inputEnabled=!1},enableClick:function(){this.bt.inputEnabled=!0},destroy:function(){this.bt.destroy()}}),App.PicTile=Class.extend({init:function(a,b,c,d,e,f,g,h){this.manager=a,this.id=b,this.parent=c,this.row=e,this.col=f,this.width=g,this.height=h;var i=f*g,j=e*h;this.group=game.add.group(c);var k=game.make.bitmapData(this.width,this.height),l=i,m=j,n=new Phaser.Rectangle(l,m,this.width,this.height);k.copyPixels(d,n,0,0),this.bmdHolder=new Phaser.Image(game,0,0,k),this.bmdHolder.anchor.set(.5,.5),this.bmdHolder.x=this.width/2,this.bmdHolder.y=this.height/2,this.group.add(this.bmdHolder),this.setXY(i,j)},isPointInside:function(a,b){var c=a>=this.group.x&&a<=this.group.x+this.width,d=b>=this.group.y&&b<=this.group.y+this.height;return c&&d},getX:function(){return this.group.x},getY:function(){return this.group.y},setXY:function(a,b){this.group.x=a,this.group.y=b},setX:function(a){this.group.x=a},setY:function(a){this.group.y=a},setRowCol:function(a,b){this.row=a,this.col=b,this.setXY(b*this.width,a*this.height)},toTop:function(){this.parent.bringToTop(this.group)},destroy:function(){this.group.destroy()}}),App.PicTileDrag=App.PicTile.extend({init:function(a,b,c,d,e,f){var g=128,h=128;this._super(a,b,c,d,e.row,e.col,g,h),this.rail=void 0,e.row==f.row?this.rail="horizontal":e.col==f.col&&(this.rail="vertical"),this.startPos={x:this.getX(),y:this.getY()},this.setXY(f.col*g,f.row*h)},select:function(a,b){this.dragOffset={x:a-this.getX(),y:b-this.getY()}},update:function(){var a=game.input.activePointer.worldX,b=game.input.activePointer.worldY;"horizontal"==this.rail?this.setX(a-this.dragOffset.x):"vertical"==this.rail&&this.setY(b-this.dragOffset.y),this.fitInBounds()},fitInBounds:function(){var a={x:0,y:0,width:640,height:640},b=this.getX(),c=this.getY();b<a.x?this.setX(a.x):b+this.width>a.x+a.width&&this.setX(a.x+a.width-this.width),c<a.y?this.setY(a.y):c+this.height>a.y+a.height&&this.setY(a.y+a.height-this.height)},getDistance:function(){var a=0;return"horizontal"==this.rail?a=Math.abs(this.getX()-this.startPos.x):"vertical"==this.rail&&(a=Math.abs(this.getY()-this.startPos.y)),a},victory:function(){game.add.tween(this.group).to({x:this.startPos.x,y:this.startPos.y},300,Phaser.Easing.Quadratic.Out,!0);var a=data.addAtlasSprite("rectWinSign",{x:this.startPos.x+this.width/2,y:this.startPos.y+this.height/2,parent:this.parent});a.anchor.set(.5,.5),a.width=this.width,a.height=this.height;var b=1.5*a.scale.x;game.add.tween(a.scale).to({x:b,y:b},1e3,Phaser.Easing.Linear.None,!0),game.add.tween(a).to({alpha:0},1e3,Phaser.Easing.Linear.None,!0)}}),App.PicTileGallery=App.PicTile.extend({init:function(a,b,c,d,e,f,g,h){this._super(a,b,c,d,e,f,g,h)},bornWithScale:function(a){this.bmdHolder.scale.x=this.bmdHolder.scale.y=0,game.add.tween(this.bmdHolder.scale).to({x:1,y:1},500,Phaser.Easing.Back.Out,!0,a)},dieWithScale:function(a){game.add.tween(this.bmdHolder.scale).to({x:0,y:0},500,Phaser.Easing.Back.In,!0,a)},born:function(a){var b=a.getDelay(this);if(a.useScale&&(this.bmdHolder.scale.x=this.bmdHolder.scale.y=0,game.add.tween(this.bmdHolder.scale).to({x:1,y:1},500,Phaser.Easing.Back.Out,!0,b)),a.useRotation){this.bmdHolder.angle=90;var c=0;game.add.tween(this.bmdHolder).to({angle:c},500,Phaser.Easing.Linear.None,!0,b)}},bornWithScaleRotation:function(a){this.bmdHolder.scale.x=this.bmdHolder.scale.y=0,this.bmdHolder.angle=90;var b=0;game.add.tween(this.bmdHolder.scale).to({x:1,y:1},500,Phaser.Easing.Back.Out,!0,a),game.add.tween(this.bmdHolder).to({angle:b},500,Phaser.Easing.Linear.None,!0,a)},dieWithScaleRotation:function(a){game.add.tween(this.bmdHolder.scale).to({x:0,y:0},500,Phaser.Easing.Back.In,!0,a),game.add.tween(this.bmdHolder).to({angle:90},500,Phaser.Easing.Linear.None,!0,a)}}),App.PicTileRotate=App.PicTile.extend({init:function(a,b,c,d,e,f,g,h){this._super(a,b,c,d,e,f,g,h),this.rotationState=0},rotateNext:function(){this.rotationState++,4==this.rotationState&&(this.rotationState=0),this.rotate(!0)},setRotationState:function(a){this.rotationState=a,this.rotate(!1)},rotate:function(a){var b=0;if(1==this.rotationState?b=90:2==this.rotationState?b=180:3==this.rotationState&&(b=-90),a){var c=game.add.tween(this.bmdHolder).to({angle:b},200,Phaser.Easing.Linear.None,!0);
c.onComplete.addOnce(this.rotateTweenComplete,this)}else this.bmdHolder.angle=b},rotateTweenComplete:function(){this.manager.tileDoneRotation()}}),App.PicTileSwap=App.PicTile.extend({init:function(a,b,c,d,e,f,g,h){this._super(a,b,c,d,e,f,g,h),this.g=game.add.graphics(0,0,this.group)},select:function(){this.selection=data.addAtlasSprite("rectWinSign",{parent:this.group}),this.selection.width=this.width,this.selection.height=this.height,this.selection.anchor.set(.5,.5),this.selection.x=this.selection.width/2,this.selection.y=this.selection.height/2,this.rotateTime=0},deselect:function(){this.group.remove(this.selection),this.bmdHolder.angle=0},tweenRowCol:function(a,b){this.row=a,this.col=b;var c=this.col*this.width,d=this.row*this.height,e=400,f=game.add.tween(this.group).to({x:c,y:d},e,Phaser.Easing.Cubic.InOut,!0);f.onComplete.addOnce(this.translateTweenComplete,this)},translateTweenComplete:function(){this.manager.tileDoneTranslation()},updateSelected:function(){this.bmdHolder.angle=3*Math.sin(this.rotateTime),this.selection.angle=3*Math.sin(this.rotateTime),this.rotateTime+=.1}}),App.RotationCircle=Class.extend({init:function(a,b,c,d,e,f){this.parent=a,this.radius=e,this.sourceSprite=b,this.width=2*e,this.height=2*e;var g=game.make.bitmapData(this.width,this.height),h=new Phaser.Rectangle(0,0,this.width,this.height),i=game.make.bitmapData(this.width,this.height);i.circle(e,e,e);var j=new Phaser.Image(game,0,0,i),k=new Phaser.Rectangle(-c+e,-d+e,this.sourceSprite.width,this.sourceSprite.height),l=h;g.alphaMask(this.sourceSprite,j,k,l),this.bmdHolder=new Phaser.Image(game,0,0,g),this.bmdHolder.anchor.set(.5,.5),this.bmdHolder.x=this.width/2,this.bmdHolder.y=this.height/2,this.parent.add(this.bmdHolder),this.bmdHolder.x=c,this.bmdHolder.y=d,this.offsetAngle=0,this.bmdHolder.angle=f},rotateToPoint:function(a,b){var c=a-this.bmdHolder.x,d=b-this.bmdHolder.y,e=180*Math.atan2(d,c)/Math.PI;this.bmdHolder.angle=-this.offsetAngle+e},updateOffsetAngle:function(a,b){var c=a-this.bmdHolder.x,d=b-this.bmdHolder.y,e=180*Math.atan2(d,c)/Math.PI;this.offsetAngle=-this.bmdHolder.angle+e},isPointInside:function(a,b){var c=util.getDist(this.bmdHolder.x,this.bmdHolder.y,a,b);return c<=this.radius},getAngle:function(){return this.bmdHolder.angle},getX:function(){return this.bmdHolder.x},getY:function(){return this.bmdHolder.y},victory:function(){game.add.tween(this.bmdHolder).to({angle:0},1e3,Phaser.Easing.Quadratic.Out,!0);var a=data.addAtlasSprite("circleWinSign",{x:this.bmdHolder.x,y:this.bmdHolder.y,parent:this.parent});a.anchor.set(.5,.5),a.width=this.width,a.height=this.height;var b=1.5*a.scale.x;game.add.tween(a.scale).to({x:b,y:b},1e3,Phaser.Easing.Linear.None,!0),game.add.tween(a).to({alpha:0},1e3,Phaser.Easing.Linear.None,!0)}}),App.SoundIcon=Class.extend({init:function(a,b){var c=0,d=0,e=1,f=a.world;void 0!=b&&(void 0!=b.x&&(c=b.x),void 0!=b.y&&(d=b.y),void 0!=b.scale&&(e=b.scale),void 0!=b.parentGroup&&(f=b.parentGroup)),this.group=a.add.group(f),this.group.x=c,this.group.y=d,this.group.scale.x=this.group.scale.y=e,this.btOn=new App.MyButton(a,"soundIconOn",this.sndClick,this,{center:!0,parentGroup:this.group}),this.btOff=new App.MyButton(a,"soundIconOff",this.sndClick,this,{center:!0,parentGroup:this.group}),this.updateIcon()},updateIcon:function(){Config.SOUNDS_ENABLED?(this.btOn.show(),this.btOff.hide()):(this.btOn.hide(),this.btOff.show())},hide:function(){this.group.visible=!1},sndClick:function(){Config.SOUNDS_ENABLED=!Config.SOUNDS_ENABLED,Config.SOUNDS_ENABLED?sounds.startMusic():sounds.stopMusic(),cookies.saveSound(),this.updateIcon(),util.wobble(this.group)},disableClick:function(){this.btOn.disableClick(),this.btOff.disableClick()}}),App.BootState=function(){},App.BootState.prototype={preload:function(){this.load.image("preloadBar","assets/images/preloadBar.png"),this.load.image("preloadBarHolder","assets/images/preloadBarHolder.png"),this.load.image("background","assets/images/background.jpg"),this.load.image("cuteBack1.jpg","assets/images/cuteBack1.jpg"),game.stage.backgroundColor="#EBE7DA"},create:function(){this.game.input.maxPointers=1,this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0,this.game.scale.enterPortrait.add(this.rescale,this),this.game.scale.enterLandscape.add(this.rescale,this),this.game.scale.setScreenSize(!0),Config.TRANSPARENT&&(this.game.world.alpha=.5),this.game.state.start("Preloader")},rescale:function(){var a=this.game;setTimeout(function(){a.scale.refresh()},500)}},App.GameCompleteState=function(){},App.GameCompleteState.prototype={create:function(){this.add.sprite(0,0,"cuteBack2.jpg"),this.completeTf=game.add.text(Config.WIDTH/2,60,data.text("gameComplete"),{font:"60px Arial",fill:"#CC0000"}),this.completeTf.anchor.set(.5,.5),this.awesomeTf=game.add.text(Config.WIDTH/2,150,data.text("awesome"),{font:"50px Arial",fill:"#000000"}),this.awesomeTf.anchor.set(.5,.5),this.dog=data.addAtlasSprite("youAreAwesome",{x:145,y:190});var a=data.getTotalMoves();this.movesTf=game.add.text(Config.WIDTH/2,490,data.text("totalMoves")+a,{font:"50px Arial",fill:"#000000"}),this.movesTf.anchor.set(.5,.5),this.iknowart1=new App.MyButton(this.game,"iknowart1Button",this.iknowart1Click,this,{x:100,y:575,center:!0,wobble:!0}),this.playTf=game.add.text(170,575,data.text("iknowart1"),{font:"50px Arial",fill:"#6D4028"}),this.playTf.anchor.set(0,.5),this.twitter=new App.MyButton(this.game,"twitterButton",this.twitterClick,this,{x:100,y:675,center:!0,wobble:!0}),this.shareTf=game.add.text(170,675,data.text("share"),{font:"50px Arial",fill:"#004462"}),this.shareTf.anchor.set(0,.5),this.home=new App.MyButton(this.game,"homeButton",this.homeClick,this,{x:320,y:765,center:!0,wobble:!0}),this.showWithTweens(),App.Fader.SHOULD_FADE_OUT&&fader.fadeOut()},showWithTweens:function(){util.tweenWithAlpha(this.completeTf,500),util.tweenWithAlpha(this.awesomeTf,1e3),util.tweenWithAlpha(this.dog,2e3),util.tweenWithAlpha(this.movesTf,2500),util.tweenWithAlpha(this.iknowart1.bt,3e3),util.tweenWithAlpha(this.playTf,3500),util.tweenWithAlpha(this.twitter.bt,4e3),util.tweenWithAlpha(this.shareTf,4500),util.tweenWithAlpha(this.home.bt,5e3)},iknowart1Click:function(){window.open("http://postepenno.com/html5/iknowart","_blank")},twitterClick:function(){var a=data.getTotalMoves(),b="http://twitter.com/share?text=I completed I Know Art 2 game with "+a+" moves. I'm awesome!&url=http://postepenno.com/html5/iknowart2";window.open(b,"_blank")},homeClick:function(){fader.fade(this.gotoMainMenu,this)},gotoMainMenu:function(){game.state.start("MainMenu")}},App.GameplayState=function(){},App.GameplayState.prototype={create:function(){this.coreGroup=new Phaser.Group(this.game,this.game.world),this.uiGroup=new Phaser.Group(this.game,this.game.world),this.uiGroup.y=640,this.uiGroup.fixedToCamera=!0,data.addAtlasSprite("levelUIBack",{parent:this.uiGroup}),data.addAtlasSprite("levelNumUnderlay",{x:Config.WIDTH/2,y:42,center:!0,parent:this.uiGroup}),this.home=new App.MyButton(this.game,"backButton",this.homeClick,this,{x:100,y:125,center:!0,parentGroup:this.uiGroup,wobble:!0}),this.restart=new App.MyButton(this.game,"restartButton",this.restartClick,this,{x:260,y:125,center:!0,parentGroup:this.uiGroup,wobble:!0}),Config.ENABLE_CHEAT&&(this.cheatBt=new App.MyButton(this.game,"cheatButton",this.cheatClick,this,{x:615,y:25,center:!0,parentGroup:this.uiGroup})),this.logic=void 0;var a=data.curLevel.data.type;"swapTiles"==a?this.logic=new App.LogicSwapTiles(this.coreGroup):"rotateTiles"==a?this.logic=new App.LogicRotateTiles(this.coreGroup):"rotateCircle"==a?this.logic=new App.LogicRotateCircle(this.coreGroup):"dragTiles"==a&&(this.logic=new App.LogicDragTiles(this.coreGroup));var b=data.text("level")+(data.curLevel.id+1);this.levelTf=game.add.text(Config.WIDTH/2,42,b,{font:"50px Arial",fill:"#000000"},this.uiGroup),this.levelTf.anchor.set(.5,.5),this.movesTf=game.add.text(530,125,data.text("moves")+"0",{font:"30px Arial",fill:"#000000"},this.uiGroup),this.movesTf.anchor.set(.5,.5),this.soundIcon=new App.SoundIcon(this.game,{x:380,y:125,parentGroup:this.uiGroup}),App.Fader.SHOULD_FADE_OUT&&fader.fadeOut()},updateMoves:function(){this.movesTf.text=data.text("moves")+data.curLevel.moves},update:function(){this.logic.update()},restartClick:function(){fader.fade(this.doRestart,this)},doRestart:function(){cmd.levelStart(data.curLevel.id)},nextClick:function(){cmd.levelNext()},homeClick:function(){fader.fade(this.gotoMainMenu,this)},gotoMainMenu:function(){game.state.start("LevelSelect")},cheatClick:function(){cmd.levelComplete()},globalPauseOn:function(){this.globalPauseStart=game.time.now},globalPauseOff:function(){data.pausedByUser||(data.pauseTime+=Math.round(game.time.now-this.globalPauseStart))},addTimerEvent:function(){this.timerEvent=this.game.time.events.loop(Phaser.Timer.SECOND,this.updateUI,this)},removeTimerEvent:function(){this.game.time.events.remove(this.timerEvent)},updateUI:function(){this.timer.setTime(data.getLevelTime())},levelComplete:function(){this.movesTf.visible=!1,this.next=new App.MyButton(this.game,"nextButton",this.nextClick,this,{x:540,y:125,center:!0,parentGroup:this.uiGroup,wobble:!0}),this.tweenAlphaButton(this.next.bt,0),this.levelTf.visible=!1,this.descTxt=game.add.text(Config.WIDTH/2,42,data.getPaintingDesc(),{font:"bold 22px Arial",fill:"#000000",align:"center"},this.uiGroup),this.descTxt.anchor.set(.5,.5),this.descTxt.alpha=0,game.add.tween(this.descTxt).to({alpha:1},500,Phaser.Easing.Linear.None,!0)},tweenAlphaButton:function(a,b){a.alpha=0,this.add.tween(a).to({alpha:1},500,Phaser.Easing.Linear.None,!0,b)},pauseClick:function(){this.removeTimerEvent(),this.pauseView=new App.PauseView(this)},resumeGame:function(){}},App.LevelSelectState=function(){},App.LevelSelectState.prototype={create:function(){this.add.sprite(0,0,"cuteBack2.jpg"),data.addAtlasSprite("itemsBack",{x:70,y:80}),this.home=new App.MyButton(this.game,"homeButton",this.homeClick,this,{x:320,y:760,center:!0,wobble:!0}),this.itemsHolder=new Phaser.Group(this.game,this.game.world),this.groupsNum=1;for(var a=0;a<this.groupsNum;a++){new App.LevelsGroup(this.game,a,this.itemsHolder)}var b=data.getTotalMoves();this.movesTf=game.add.text(Config.WIDTH/2,590,data.text("totalMoves")+b,{font:"50px Arial",fill:"#000000"},this.uiGroup),this.movesTf.anchor.set(.5,.5),App.Fader.SHOULD_FADE_OUT&&fader.fadeOut()},scrollUpClick:function(){1==App.LevelSelectState.CURRENT_GROUP_ID&&this.scrollUp.scaleHide(),App.LevelSelectState.CURRENT_GROUP_ID==this.groupsNum-1&&this.scrollDown.scaleShow(),App.LevelSelectState.CURRENT_GROUP_ID--,this.scrollUp.disableClick(),this.scrollDown.disableClick();var a=this.game.add.tween(this.itemsHolder);a.to({y:-Config.HEIGHT*App.LevelSelectState.CURRENT_GROUP_ID},500,Phaser.Easing.Quadratic.InOut,!0),a.onComplete.addOnce(this.scrollComplete,this)},scrollDownClick:function(){0==App.LevelSelectState.CURRENT_GROUP_ID&&this.scrollUp.scaleShow(),App.LevelSelectState.CURRENT_GROUP_ID==this.groupsNum-2&&this.scrollDown.scaleHide(),App.LevelSelectState.CURRENT_GROUP_ID++,this.scrollUp.disableClick(),this.scrollDown.disableClick();var a=this.game.add.tween(this.itemsHolder);a.to({y:-Config.HEIGHT*App.LevelSelectState.CURRENT_GROUP_ID},500,Phaser.Easing.Quadratic.InOut,!0),a.onComplete.addOnce(this.scrollComplete,this)},scrollComplete:function(){this.scrollUp.enableClick(),this.scrollDown.enableClick()},homeClick:function(){fader.fade(this.gotoMainMenu,this)},gotoMainMenu:function(){this.game.state.start("MainMenu")}},App.LevelSelectState.CURRENT_GROUP_ID=0,App.MainMenuState=function(){},App.MainMenuState.prototype={create:function(){this.add.sprite(0,0,"cuteBack1.jpg"),this.galleryHolder=game.add.group(),this.title=new App.GameTitle(20,45),this.playBt=new App.MyButton(this.game,"playButton",this.playClick,this,{x:520,y:735,center:!0,wobble:!0}),this.creditsBt=new App.MyButton(this.game,"creditsButton",this.creditsClick,this,{x:200,y:735,center:!0,wobble:!0}),this.soundIcon=new App.SoundIcon(this.game,{x:80,y:735}),this.language=new App.LanguageButton({x:340,y:735}),this.showWithTweens();var a="v "+Config.VERSION,b=this.add.text(5,Config.HEIGHT-5,a,{font:"12px Arial",fill:"#000000"});b.anchor.set(0,1),App.Fader.SHOULD_FADE_OUT&&fader.fadeOut()},showWithTweens:function(){util.tweenWithAlpha(this.title.group,0),this.tweenScaleButton(this.soundIcon.group,500),this.tweenScaleButton(this.creditsBt.bt,700),this.tweenScaleButton(this.language.group,900),this.tweenScaleButton(this.playBt.bt,1100),game.time.events.add(1500,this.startGallery,this)},startGallery:function(){this.gallery=new App.Gallery(this.galleryHolder)},tweenScaleButton:function(a,b){a.scale.x=a.scale.y=0,this.add.tween(a.scale).to({x:1,y:1},500,Phaser.Easing.Back.Out,!0,b)},tweenAlphaButton:function(a,b){a.alpha=0,this.add.tween(a).to({alpha:1},500,Phaser.Easing.Linear.None,!0,b)},playClick:function(){fader.fade(this.startGame,this)},startGame:function(){cmd.gameStart()},deleteProgressClick:function(){new App.DeleteProgressView(this.game)},creditsClick:function(){new App.CreditsView(this.game)},update:function(){this.title.update()}},App.PreloaderState=function(){},App.PreloaderState.prototype={preload:function(){this.add.sprite(0,0,"cuteBack1.jpg");var a,b=["fader","blackBack","cuteBack2.jpg"],c=["sndClick","sndLevelComplete","sndGood","music"];for(a=0;a<b.length;a++){var d=-1==b[a].indexOf(".jpg")?b[a]+".png":b[a];this.load.image(b[a],"assets/images/"+d)}for(a=0;a<c.length;a++){var e=c[a]+".mp3",f=c[a]+".ogg";this.load.audio(c[a],["assets/sounds/"+e,"assets/sounds/"+f])}this.load.atlasJSONHash("atlas","assets/images/atlas.png","assets/images/atlas.json"),this.load.atlasJSONHash("paintings","assets/images/paintings.jpg","assets/images/paintings.json"),this.load.atlasJSONHash("paintings2","assets/images/paintings2.jpg","assets/images/paintings2.json"),this.load.bitmapFont("eras","assets/fonts/eras.png","assets/fonts/eras.fnt"),this.load.text("textData","assets/txt/TextData.json"),this.holder=this.game.add.group(),this.preloadBar=this.add.sprite(126,271,"preloadBar",null,this.holder),this.add.sprite(120,264,"preloadBarHolder",null,this.holder),this.progressTxt=this.game.add.text(Config.WIDTH/2,210,"0%",{font:"bold 50px Arial",fill:"#000000"},this.holder),this.progressTxt.anchor.set(.5,0),this.load.setPreloadSprite(this.preloadBar),this.load.onFileComplete.add(this.fileLoaded,this)},fileLoaded:function(a){this.progressTxt.setText(a+"%")},create:function(){var a=this.game.add.tween(this.holder).to({alpha:0,y:this.holder.y+60},800,Phaser.Easing.Linear.None,!0);a.onComplete.addOnce(this.preloaderComplete,this)},preloaderComplete:function(){fader=new App.Fader(this.game),cmd=new App.Commands,data=new App.Data,cookies=new App.Cookies,sounds=new App.Sounds,sounds.startMusic(),util=new App.Util,this.game.state.start("MainMenu")}};