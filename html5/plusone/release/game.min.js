var Background=Class.extend({init:function(){this.bitmap=new createjs.Bitmap(preloader.queue.getResult("background"));stage.addChild(this.bitmap)},destroy:function(){stage.removeChild(this.bitmap)}}),Button=Class.extend({init:function(a,b,c,d,g){this.assetName=a;this.x=b;this.y=c;this.bmp;this.callback=d;this.scope=g;this.bmp=new createjs.Bitmap(preloader.queue.getResult(a));this.bmp.x=b;this.bmp.y=c;stage.addChild(this.bmp);this.bmp.addEventListener("click",this)},handleEvent:function(a){switch(a.type){case "click":Sounds.play("sndClick"),
this.callback(this,this.scope)}},destroy:function(){this.bmp.removeEventListener("click",this);stage.removeChild(this.bmp)}}),Circle=Class.extend({myVar:"MYVARR",parent:void 0,container:void 0,shape:void 0,game:void 0,defaultX:void 0,defaultY:void 0,bmpText:void 0,value:void 0,init:function(a,b,c,d){this.radius=a;this.parent=b;this.game=c;this.value=d;this.draw();this.shape.addEventListener("click",this)},handleEvent:function(a){"click"===a.type&&this.game.circleClicked(this)},draw:function(){this.container=
new createjs.Container;this.parent.addChild(this.container);var a=(new createjs.Graphics).beginFill(this.getColor()).drawCircle(0,0,this.radius);this.shape=new createjs.Shape(a);this.container.addChild(this.shape);this.bmpText=new BitmapTextField(60,60,this.value.toString(),"hermes",-1,0,0,"center","center",!0);this.bmpText.x=-this.radius;this.bmpText.y=-this.radius-3;this.container.addChild(this.bmpText)},getColor:function(){0==Config.tempColors.length&&(Config.tempColors=Config.colors.slice(0));
var a=Math.floor(Math.random()*Config.tempColors.length),b=Config.tempColors[a];Config.tempColors.splice(a,1);return b},setPos:function(a,b){this.container.x=a;this.container.y=b;this.defaultX=a;this.defaultY=b},shake:function(){this.container.x=this.defaultX;this.container.y=this.defaultY;var a=createjs.Ease.quadIn,b=createjs.Ease.quadOut,c=createjs.Ease.quadInOut;createjs.Tween.get(this.container,{override:!0}).to({x:this.defaultX+5},50,b).to({x:this.defaultX-5},100,c).to({x:this.defaultX+5},100,
c).to({x:this.defaultX-5},100,c).to({x:this.defaultX},50,a)},tweenBorn:function(a){this.container.scaleX=this.container.scaleY=0;createjs.Tween.get(this.container).wait(a).to({scaleX:1,scaleY:1},500,createjs.Ease.backOut).call(this.game.circleReady,[],this.game)},destroy:function(){this.shape.removeEventListener("click",this);createjs.Tween.get(this.container).to({scaleX:0,scaleY:0},500,createjs.Ease.quadOut).call(this.dieComplete,[],this)},dieComplete:function(){this.parent.removeChild(this.container)}});
function Config(){}Config.completeNames="textAwesome textYouRock textCool textGreat textPerfect textWellDone textDoingGreat".split(" ");Config.TRANSPARENT=!1;Config.colors="#79C2ED #F9C205 #E97619 #D92250 #6C6297 #419283 #88BF26".split(" ");Config.tempColors=Config.colors.slice(0);Config.radius=30;Config.soundEnabled=!0;Config.GRADE_A=24E4;Config.GRADE_B=27E4;Config.GRADE_C=3E5;Config.GRADE_D=36E4;Config.GRADE_E=48E4;
var Credits=Class.extend({init:function(){this.back=new Background;this.logoBt=new Button("postepennoLogo",0,30,this.logoClick,this);this.addHitArea(this.logoBt.bmp);this.karataevBt=new Button("karataev",0,310,this.karataevClick,this);this.addHitArea(this.karataevBt.bmp);this.backBt=new Button("backButton",60,400,this.backClick,this)},addHitArea:function(a){var b=new createjs.Shape;b.graphics.beginFill("#000").drawRect(0,0,a.image.width,a.image.height);a.hitArea=b},logoClick:function(a,b){window.open("http://postepenno.com",
"_blank")},karataevClick:function(a,b){window.location.href="mailto:eugene.karataev@gmail.com"},backClick:function(a,b){b.destroy();new MainMenu},destroy:function(){this.logoBt.destroy();this.karataevBt.destroy();this.backBt.destroy();this.back.destroy()}}),FinalGrade=Class.extend({init:function(a,b,c,d){this.parent=a;this.holder=new createjs.Container;this.holder.x=b;this.holder.y=c;this.parent.addChild(this.holder);this.pic=new Picture("grade",this.holder,0,0);this.tri=new Picture("triangle",this.holder,
0,0);this.tri.bitmap.regX=12;this.tri.setPos(25+50*d,50)},destroy:function(){this.pic.destroy();this.tri.destroy();this.parent.removeChild(this.holder)}}),Game=Class.extend({init:function(){this.circles=void 0;this.readyCircles=0;this.soundIcon=this.circlesGraphics=this.circlesShape=this.circlesHolder=this.back=this.txtLevel=this.curLevel=this.levels=this.curIndex=this.shuffledValues=void 0;this.gameTime=this.startTime=0;this.createWindow();this.initLevels();createjs.Ticker.init();this.startTime=
createjs.Ticker.getTime();this.tickRef=createjs.Ticker.on("tick",this.tick,this);this.levelStart(0)},createWindow:function(){this.back=new Background;this.circlesGraphics=new createjs.Graphics;this.circlesShape=new createjs.Shape(this.circlesGraphics);this.circlesHolder=new createjs.Container;this.circlesHolder.addChild(this.circlesShape);this.circlesHolder.x=25;this.circlesHolder.y=100;stage.addChild(this.circlesHolder);this.ui=new GameUI(stage,this)},tick:function(){this.gameTime=createjs.Ticker.getTime()-
this.startTime;this.ui.update()},initLevels:function(){this.levels=[];this.addLevel(1,"+1",4,1);this.addLevel(1,"+1",1,4);this.addLevel(1,"+1",2,2);this.addLevel(1,"+1",3,2);this.addLevel(1,"+1",2,3);this.addLevel(1,"+1",3,3);this.addLevel(1,"+1",4,3);this.addLevel(1,"+1",4,4);this.addLevel(2,"+2",4,1);this.addLevel(2,"+2",4,2);this.addLevel(2,"+2",3,3);this.addLevel(2,"+2",4,3);this.addLevel(3,"+3",2,3);this.addLevel(3,"+3",2,4);this.addLevel(5,"+5",2,2);this.addLevel(5,"+5",3,3);this.addLevel(50,
"+5",2,2);this.addLevel(50,"+5",3,3);this.addLevel(8,"+8",2,5);this.addLevel(5,"+5",4,4);this.addLevel(10,"+10",3,3);this.addLevel(7,"+7",4,3);this.addLevel(10,"+1",4,4);this.addLevel(1,"+1",4,5);this.addLevel(29,"+3",4,5)},addLevel:function(a,b,c,d){var g=this.levels.length;d*=c;for(var h=[],e=0;e<d;e++){var f;"+1"===b?f=a+e:"+2"===b?f=a+2*e:"+3"===b?f=a+3*e:"+5"===b?f=a+5*e:"+7"===b?f=a+7*e:"+8"===b?f=a+8*e:"+10"===b&&(f=a+10*e);h.push(f)}this.levels.push(new Level(g,h,c))},initData:function(){this.shuffledValues=
this.curLevel.values.slice(0);this.shuffledValues=this.shuffle(this.shuffledValues)},shuffle:function(a){for(var b=a.length,c,d;0<b;)d=Math.floor(Math.random()*b),b--,c=a[b],a[b]=a[d],a[d]=c;return a},levelStart:function(a){this.curLevel=this.levels[a];this.initData();this.updateCircleHolder();this.createCircles();this.tweenBornCircles();this.curIndex=this.readyCircles=0;this.ui.levelStart()},updateCircleHolder:function(){var a=(2*Config.radius+10)*Math.floor((this.curLevel.values.length+this.curLevel.inRow-
1)/this.curLevel.inRow)-10;this.circlesHolder.x=(320-((2*Config.radius+10)*this.curLevel.inRow-10))/2;this.circlesHolder.y=40+(240-a/2)},createCircles:function(){this.circles=[];for(var a=0;a<this.shuffledValues.length;a++){var b=new Circle(Config.radius,this.circlesHolder,this,this.shuffledValues[a]);b.setPos(Config.radius+a%this.curLevel.inRow*(2*Config.radius+10),Config.radius+Math.floor(a/this.curLevel.inRow)*(2*Config.radius+10));this.circles.push(b)}},tweenBornCircles:function(){for(var a=0;a<
this.circles.length;a++)this.circles[a].tweenBorn(100*a)},circleReady:function(){this.readyCircles++;this.readyCircles===this.circles.length&&console.log("circles are ready!")},circleClicked:function(a){a.value===this.curLevel.values[this.curIndex]?this.correctAnswer(a):this.wrongAnswer(a)},correctAnswer:function(a){Sounds.play("sndRight");this.removeCircle(a);this.curIndex++;0==this.circles.length&&new LevelCompleteCommand(this)},wrongAnswer:function(a){Sounds.play("sndWrong");a.shake()},removeCircle:function(a){var b=
this.circles.indexOf(a);this.circles.splice(b,1);a.destroy()},destroy:function(){createjs.Ticker.off("tick",this.tickRef);this.ui.destroy();this.back.destroy()}}),GameComplete=Class.extend({init:function(a){this.back=new Background;this.title=new Picture("gameCompleteTitle",stage,59,30);var b="Your time: "+Util.formatTime(a);this.timeTf=new TextField(stage,b,0,158,320,50,"#000000","center","top");b=0;a<Config.GRADE_A?(b=0,a="AMAZING!"):a<Config.GRADE_B?(b=1,a="Awesome"):a<Config.GRADE_C?(b=2,a="Super"):
a<Config.GRADE_D?(b=3,a="Great"):a<Config.GRADE_E?(b=4,a="Good"):(b=5,a="OK");this.finalGrade=new FinalGrade(stage,10,225,b);this.resultTf=new TextField(stage,a,0,330,320,50,"#E97619","center","top");this.menuBt=new Button("menuButton",90,404,this.menuClick,this);this.tweenComponents()},tweenComponents:function(){this.addTween(this.title.bitmap,500,1E3);this.addTween(this.timeTf.bmpTf,1500,1E3);this.addTween(this.finalGrade.holder,2500,1E3);this.addTween(this.resultTf.bmpTf,3500,1E3);this.addTween(this.menuBt.bmp,
4500,1E3)},addTween:function(a,b,c){a.alpha=0;createjs.Tween.get(a).wait(b).to({alpha:1},c)},menuClick:function(a,b){b.destroy();new MainMenu},destroy:function(){this.title.destroy();this.timeTf.destroy();this.finalGrade.destroy();this.resultTf.destroy();this.menuBt.destroy();this.back.destroy()}}),GameUI=Class.extend({init:function(a,b){this.parent=a;this.game=b;this.back;this.createBack();this.levelTf=new TextField(this.parent,"Level ...",10,0,150,50,"#666666","left","top");this.timeTf=new TextField(this.parent,
"Time 00:00",10,37,150,50,"#666666","left","top");this.soundIcon=new SoundIcon(this.parent,250,10)},formatTime:function(a){var b=Math.round(a/1E3),c=Math.floor(b/3600);a=Math.floor((b-3600*c)/60);b=b-3600*c-60*a;10>a&&(a="0"+a);10>b&&(b="0"+b);return a+":"+b},createBack:function(){var a=new createjs.Graphics;a.beginFill("#FFF").drawRect(0,0,320,80);this.back=new createjs.Shape(a);this.parent.addChild(this.back)},levelStart:function(){this.levelTf.setText("Level "+(this.game.curLevel.id+1)+"/"+this.game.levels.length)},
update:function(){var a=Util.formatTime(this.game.gameTime);this.timeTf.setText("Time "+a)},destroy:function(){this.parent.removeChild(this.back);this.soundIcon.destroy();this.levelTf.destroy();this.timeTf.destroy()}}),Level=Class.extend({init:function(a,b,c){this.id=a;this.values=b;this.inRow=c}}),LevelCompleteCommand=Class.extend({init:function(a){this.game=a;Sounds.play("sndLevelComplete");a=Math.floor(Math.random()*Config.completeNames.length);this.title=new Picture(Config.completeNames[a],stage,
0,250);this.title.bitmap.alpha=0;this.title.bitmap.regX=160;this.title.bitmap.x=160;this.title.bitmap.scaleX=this.title.bitmap.scaleY=0;a=createjs.Ease.linear;createjs.Tween.get(this.title.bitmap).to({scaleX:1,scaleY:1},700,createjs.Ease.backOut);createjs.Tween.get(this.title.bitmap).to({y:150},2E3,a);createjs.Tween.get(this.title.bitmap).to({alpha:1},500,a).wait(1E3).to({alpha:0},500,a).call(this.titleComplete,[],this)},titleComplete:function(){this.destroy();this.game.curLevel.id===this.game.levels.length-
1?(this.game.destroy(),this.gameComplete()):this.game.levelStart(this.game.curLevel.id+1)},gameComplete:function(){var a=this.game.gameTime;this.game.destroy();new GameComplete(a)},destroy:function(){this.title.destroy()}}),gameDiv,canvas,stage,preloader;
function startup(){gameDiv=document.getElementById("fill");gameDiv.setAttribute("style","width: 320px; height: 480px; position:absolute");canvas=document.getElementById("content");stage=new createjs.Stage(canvas);window.onresize=function(){onResize()};onResize();createjs.Touch.enable(stage);createjs.Ticker.setFPS(30);stage.mouseMoveOutside=!0;preloader=new Preloader(preloaderComplete,this)}
function preloaderComplete(a){a=new BitmapFont(preloader.queue.getResult("hermesTexture"),preloader.queue.getResult("hermesXML"),32);BitmapTextField.registerBitmapFont(a,"hermes");Config.TRANSPARENT&&(stage.alpha=0.5);new MainMenu;createjs.Ticker.on("tick",tick)}function tick(){stage.update()}
var MainMenu=Class.extend({init:function(){this.back=new Background;this.line1=new YellowLine(stage,0,40,"right");this.line2=new YellowLine(stage,0,150,"left");this.title=new Picture("mainMenuTitle",stage,0,77);this.playBt=new Button("playButton",60,290,this.playClick,this);this.creditsBt=new Button("creditsButton",60,400,this.creditsClick,this)},playClick:function(a,b){b.destroy();new Game},creditsClick:function(a,b){b.destroy();new Credits},destroy:function(){this.creditsBt.destroy();this.playBt.destroy();
this.line1.destroy();this.line2.destroy();this.title.destroy();this.back.destroy()}}),Picture=Class.extend({init:function(a,b,c,d){this.assetName=a;this.parent=b;this.bitmap=new createjs.Bitmap(preloader.queue.getResult(a));this.bitmap.x=c;this.bitmap.y=d;this.parent.addChild(this.bitmap)},setPos:function(a,b){this.bitmap.x=a;this.bitmap.y=b},destroy:function(){this.parent.removeChild(this.bitmap)}}),Preloader=Class.extend({queue:void 0,callback:void 0,scope:void 0,loaderBar:void 0,percentTf:void 0,
init:function(a,b){this.callback=a;this.scope=b;this.loaderBar=new createjs.Shape;this.loaderBar.graphics.beginFill("#000000").drawRect(0,230,320,20).endFill();this.loaderBar.scaleX=0;stage.addChild(this.loaderBar);this.percentTf=new createjs.Text("0%","30px Arial","#555555");this.percentTf.textAlign="center";this.percentTf.x=160;this.percentTf.y=180;stage.addChild(this.percentTf);this.queue=new createjs.LoadQueue(!1);createjs.Sound.alternateExtensions=["mp3"];this.queue.installPlugin(createjs.Sound);
for(var c=[{id:"hermesTexture",src:"assets/hermes_0.png"},{id:"hermesXML",src:"assets/hermes.xml"},{id:"playButton",src:"assets/playButton.png"},{id:"menuButton",src:"assets/menuButton.png"},{id:"background",src:"assets/background.png"},{id:"yellowLine",src:"assets/yellowLine.png"},{id:"mainMenuTitle",src:"assets/mainMenuTitle.png"},{id:"soundIconOn",src:"assets/soundIconOn.png"},{id:"soundIconOff",src:"assets/soundIconOff.png"},{id:"gameCompleteTitle",src:"assets/gameCompleteTitle.png"},{id:"grade",
src:"assets/grade.png"},{id:"triangle",src:"assets/triangle.png"},{id:"creditsButton",src:"assets/creditsButton.png"},{id:"backButton",src:"assets/backButton.png"},{id:"postepennoLogo",src:"assets/postepennoLogo.png"},{id:"karataev",src:"assets/karataev.png"},{id:"sndWrong",src:"assets/wrong.ogg"},{id:"sndRight",src:"assets/right.ogg"},{id:"sndLevelComplete",src:"assets/levelComplete.ogg"},{id:"sndClick",src:"assets/click.ogg"}],d=0;d<Config.completeNames.length;d++)c.push({id:Config.completeNames[d],
src:"assets/"+Config.completeNames[d]+".png"});this.queue.on("fileload",this.onFileLoad,this);this.queue.on("complete",this.onComplete,this);this.queue.loadManifest(c)},onComplete:function(a){stage.removeChild(this.loaderBar);stage.removeChild(this.percentTf);stage.update();this.callback(this.scope)},onFileLoad:function(a){a=Math.round(100*this.queue.progress);this.percentTf.text=a+"%";this.loaderBar.scaleX=this.queue.progress;stage.update()}});
function onResize(){var a=window.innerWidth,b=Math.min(a/320,window.innerHeight/480),c=320*b,d=480*b;gameDiv.style.width=c+"px";gameDiv.style.height=d+"px";gameDiv.style.left=(a-c)/2+"px";stage.scaleX=b;stage.scaleY=b;stage.canvas.width=c;stage.canvas.height=d;stage.update()}
var SoundIcon=Class.extend({init:function(a,b,c){this.parent=a;this.holder=new createjs.Container;this.parent.addChild(this.holder);this.holder.x=b;this.holder.y=c;this.bmpOn=new createjs.Bitmap(preloader.queue.getResult("soundIconOn"));this.holder.addChild(this.bmpOn);this.bmpOff=new createjs.Bitmap(preloader.queue.getResult("soundIconOff"));this.holder.addChild(this.bmpOff);this.updateIcon();this.holder.addEventListener("click",this)},updateIcon:function(){Config.soundEnabled?(this.bmpOn.visible=
!0,this.bmpOff.visible=!1):(this.bmpOn.visible=!1,this.bmpOff.visible=!0)},handleEvent:function(a){switch(a.type){case "click":Sounds.play("sndClick"),Config.soundEnabled=!Config.soundEnabled,this.updateIcon()}},destroy:function(){this.holder.removeEventListener("click",this);this.parent.removeChild(this.holder)}}),Sounds=Class.extend({});Sounds.play=function(a){Config.soundEnabled&&createjs.Sound.play(a)};
var TextField=Class.extend({init:function(a,b,c,d,g,h,e,f,k){this.parent=a;this.txt=b;this.color=e;this.bmpTf=new BitmapTextField(g,h,this.txt,"hermes",-1,0,0,f,k,!0);this.bmpTf.x=c;this.bmpTf.y=d;this.bmpTf.setColor(this.color);this.parent.addChild(this.bmpTf)},setText:function(a){this.bmpTf.setText(a)},destroy:function(){this.parent.removeChild(this.bmpTf)}}),Util=Class.extend({});
Util.formatTime=function(a){var b=Math.round(a/1E3),c=Math.floor(b/3600);a=Math.floor((b-3600*c)/60);b=b-3600*c-60*a;10>a&&(a="0"+a);10>b&&(b="0"+b);return a+":"+b};
var YellowLine=Class.extend({init:function(a,b,c,d){this.parent=a;this.bitmap=new createjs.Bitmap(preloader.queue.getResult("yellowLine"));this.bitmap.x=b;this.bitmap.y=c;this.parent.addChild(this.bitmap);this.targetX=this.startX=0;"left"===d?(this.startX=0,this.targetX=-20):"right"===d&&(this.startX=-20,this.targetX=0);this.bitmap.x=this.startX;createjs.Tween.get(this.bitmap,{loop:!0}).to({x:this.targetX},1E3).to({x:this.startX},0)},destroy:function(){createjs.Tween.removeTweens(this.bitmap);this.parent.removeChild(this.bitmap)}});
