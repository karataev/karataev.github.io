function Config(){}function startup(){game=new Phaser.Game(Config.WIDTH,Config.HEIGHT,Phaser.CANVAS,"gameArea"),game.state.add("Boot",App.BootState),game.state.add("Preloader",App.PreloaderState),game.state.add("MainMenu",App.MainMenuState),game.state.add("LevelSelect",App.LevelSelectState),game.state.add("Gameplay",App.GameplayState),game.state.start("Boot")}Commands=function(){},Commands.prototype={gameStart:function(){Config.TEST_GAME_COMPLETE?cmd.gameComplete():cmd.levelStart(0)},levelStart:function(a){data.curLevel=data.levels[a],data.levelStartTime=game.time.now,data.pauseTime=0,game.state.start("Gameplay")},levelComplete:function(){stateSlider.levelComplete()},gameComplete:function(){console.log("GAME COMPLETE!")}},Config.VERSION="0.1",Config.WIDTH=640,Config.HEIGHT=712,Config.TOUCH_BOUNDS={x:0,y:100,width:Config.WIDTH,height:Config.HEIGHT-100},Config.ANIMATION=!0,Config.SOUNDS_ENABLED=!1,Config.TRANSPARENT=!1,Config.START_LEVEL=0,Config.TEST_GAME_COMPLETE=!1,Config.SHOW_FPS=!0,Config.OPEN_ALL_LEVELS=!0,Config.DEBUG_PHYSICS=!1,Config.RELEASE=!1,Config.RELEASE&&(Config.ANIMATION=!0,Config.SOUNDS_ENABLED=!0,Config.TRANSPARENT=!1,Config.START_LEVEL=0,Config.TEST_GAME_COMPLETE=!1,Config.SHOW_FPS=!1,Config.OPEN_ALL_LEVELS=!1,Config.DEBUG_PHYSICS=!1);var Cookies=Class.extend({init:function(){this.gameStorageKey="moneyfall",this.initSound(),this.isNewGame=!0,this.initLevels()},isSupported:function(){var a="test",b=window.sessionStorage;try{return b.setItem(a,"1"),b.removeItem(a),!0}catch(c){return!1}},getStorage:function(a){return localStorage[this.gameStorageKey+"."+a]},setStorage:function(a,b){this.isSupported()&&(localStorage[this.gameStorageKey+"."+a]=b)},initSound:function(){Config.SOUNDS_ENABLED="false"==this.getStorage("soundEnabled")?!1:!0},saveSound:function(){this.setStorage("soundEnabled",Config.SOUNDS_ENABLED)},initLevels:function(){if(void 0!=this.getStorage("levels"))for(var a=0;a<data.levels.length;a++){var b=data.levels[a];if("true"==this.getStorage("levels."+a+".isCompleted")){b.isOpen=!0,b.isCompleted=!0;var c=this.getStorage("levels."+a+".time");void 0!==c&&(b.bestTime=parseInt(c)),this.isNewGame=!1}}this.updateOpenLevels()},updateOpenLevels:function(){var a,b;if(Config.OPEN_ALL_LEVELS)for(a=0;a<data.levels.length;a++)b=data.levels[a],b.isOpen=!0;else for(a=0;a<data.levels.length;a++)if(b=data.levels[a],!b.isCompleted){b.isOpen=!0;break}},levelComplete:function(){this.setStorage("levels","true");var a=data.curLevel.id;this.setStorage("levels."+a+".isCompleted","true"),this.setStorage("levels."+a+".time",data.curLevel.bestTime),this.isNewGame=!1,this.updateOpenLevels()},clear:function(){localStorage.clear(),this.isNewGame=!0,this.uncompleteLevels(),this.updateOpenLevels()},uncompleteLevels:function(){for(var a=0;a<data.levels.length;a++){var b=data.levels[a];b.reset()}}});Data=Class.extend({init:function(){this.curLevel=null,this.levelStartTime=0,this.levelStartTime=0,this.pauseTime=0,this.pausedByUser=!1,this.initLevels()},initLevels:function(){this.levels=[],this.addLevel({name:"Zigzag Line",items:[{id:0,x:200,y:320},{id:1,x:400,y:160},{id:2,x:200,y:640},{id:3,x:400,y:480}],links:[{p1:2,p2:3},{p1:0,p2:3},{p1:1,p2:0}]}),this.addLevel({name:"Star",items:[{id:0,x:80,y:320},{id:1,x:323,y:161},{id:2,x:160,y:600},{id:3,x:480,y:600},{id:4,x:560,y:320}],links:[{p1:0,p2:3},{p1:1,p2:3},{p1:1,p2:2},{p1:4,p2:2},{p1:4,p2:0}]}),this.addLevel({name:"House",items:[{id:0,x:100,y:350},{id:1,x:300,y:150},{id:2,x:101,y:601},{id:3,x:548,y:600},{id:4,x:550,y:350}],links:[{p1:4,p2:0},{p1:4,p2:2},{p1:0,p2:3},{p1:0,p2:2},{p1:2,p2:3},{p1:4,p2:3},{p1:4,p2:1},{p1:1,p2:0}]}),this.addLevel({name:"Possible Quad",items:[{id:0,x:320,y:401},{id:1,x:120,y:200},{id:2,x:120,y:600},{id:3,x:520,y:600},{id:4,x:520,y:200}],links:[{p1:0,p2:3},{p1:0,p2:2},{p1:1,p2:2},{p1:2,p2:3},{p1:4,p2:3},{p1:4,p2:0},{p1:1,p2:0}]}),this.addLevel({name:"Two Triangles",items:[{id:0,x:320,y:240},{id:1,x:120,y:360},{id:2,x:240,y:600},{id:3,x:400,y:600},{id:4,x:520,y:360}],links:[{p1:4,p2:1},{p1:4,p2:0},{p1:1,p2:0},{p1:2,p2:3},{p1:0,p2:3},{p1:0,p2:2}]}),this.addLevel({name:"Cube",items:[{id:0,x:520,y:480},{id:1,x:520,y:240},{id:2,x:120,y:320},{id:3,x:360,y:320},{id:4,x:120,y:560},{id:5,x:360,y:560},{id:6,x:280,y:240}],links:[{p1:0,p2:5},{p1:1,p2:0},{p1:3,p2:1},{p1:1,p2:6},{p1:2,p2:6},{p1:3,p2:4},{p1:2,p2:5},{p1:2,p2:4},{p1:4,p2:5},{p1:3,p2:5},{p1:3,p2:2}]}),this.addLevel({name:"Quad Twisted",items:[{id:0,x:600,y:401},{id:1,x:240,y:401},{id:2,x:80,y:401},{id:3,x:160,y:200},{id:4,x:160,y:640},{id:5,x:480,y:640},{id:6,x:480,y:200}],links:[{p1:4,p2:5},{p1:6,p2:5},{p1:0,p2:5},{p1:6,p2:0},{p1:6,p2:3},{p1:3,p2:4},{p1:3,p2:2},{p1:2,p2:4},{p1:1,p2:4},{p1:3,p2:1}]}),this.addLevel({name:"Fractal Triangle",items:[{id:0,x:560,y:560},{id:1,x:320,y:440},{id:2,x:240,y:320},{id:3,x:320,y:200},{id:4,x:80,y:560},{id:5,x:400,y:560},{id:6,x:400,y:320}],links:[{p1:4,p2:5},{p1:0,p2:5},{p1:6,p2:0},{p1:2,p2:4},{p1:1,p2:5},{p1:6,p2:1},{p1:2,p2:1},{p1:6,p2:2},{p1:6,p2:3},{p1:3,p2:2}]}),this.addLevel({name:"Romb",items:[{id:0,x:440,y:400},{id:1,x:200,y:400},{id:2,x:320,y:520},{id:3,x:320,y:600},{id:4,x:320,y:200},{id:5,x:320,y:280},{id:6,x:120,y:200},{id:7,x:120,y:600},{id:8,x:520,y:600},{id:9,x:520,y:200}],links:[{p1:5,p2:2},{p1:2,p2:0},{p1:5,p2:0},{p1:4,p2:5},{p1:5,p2:1},{p1:1,p2:2},{p1:2,p2:3},{p1:6,p2:4},{p1:9,p2:4},{p1:3,p2:8},{p1:7,p2:3},{p1:6,p2:7},{p1:9,p2:8}]}),this.addLevel({name:"Romb2",items:[{id:0,x:320,y:640},{id:1,x:400,y:560},{id:2,x:240,y:560},{id:3,x:400,y:400},{id:4,x:240,y:400},{id:5,x:400,y:240},{id:6,x:240,y:240},{id:7,x:320,y:160},{id:8,x:160,y:400},{id:9,x:480,y:400}],links:[{p1:4,p2:8},{p1:2,p2:8},{p1:6,p2:8},{p1:9,p2:3},{p1:9,p2:1},{p1:5,p2:9},{p1:7,p2:6},{p1:5,p2:7},{p1:0,p2:1},{p1:2,p2:0},{p1:3,p2:1},{p1:2,p2:1},{p1:4,p2:2},{p1:4,p2:3},{p1:5,p2:3},{p1:5,p2:6},{p1:6,p2:4}]})},addLevel:function(a){var b=this.levels.length,c=new Level(b,a);this.levels.push(c)},getLevelTime:function(){return Math.round(game.time.elapsedSince(this.levelStartTime)-data.pauseTime)},getTotalTime:function(){for(var a=0,b=0;b<this.levels.length;b++){var c=this.levels[b];c.isCompleted&&(a+=c.bestTime)}return a}}),Dialog=Class.extend({init:function(a,b,c){this.game=a;var d=0,e=0,f=!1,g=!0;if(c&&(void 0!=c.x&&(d=c.x),void 0!=c.y&&(e=c.y),1==c.blockBack&&(f=!0),0==c.doTween&&(g=!1)),this.holder=new Phaser.Group(this.game,this.game.world),f&&(this.block=new Phaser.Sprite(this.game,0,0,"blackBack"),this.block.inputEnabled=!0,this.holder.add(this.block)),this.boxHolder=new Phaser.Group(this.game,this.holder),this.boxHolder.x=d,this.boxHolder.y=e,this.box=new Phaser.Sprite(this.game,0,0,b),this.boxHolder.add(this.box),g){var h=this.boxHolder.y;this.boxHolder.y=Config.HEIGHT,this.game.add.tween(this.boxHolder).to({y:h},1e3,Phaser.Easing.Back.Out,!0),f&&(this.block.alpha=0,this.game.add.tween(this.block).to({alpha:1},500,Phaser.Easing.Linear.None,!0))}},destroy:function(){this.holder.destroy()}}),GameLogic=Class.extend({init:function(a,b,c,d,e,f){this.game=a,this.parentGroup=b,this.dotsGroup=c,this.linksGroup=d,this.dots=e,this.staticLinks=f,this.drawLine=null,this.userLinks=[],this.game.input.onDown.add(this.touchDownHandler,this),this.game.input.onUp.add(this.touchUpHandler,this),this.maxConnectIndex=8,this.connectIndex=0,this.game.world.setBounds(-Config.WIDTH,0,4*Config.WIDTH,Config.HEIGHT),this.vfx=new VisualFX(this.game)},addStaticLink:function(a,b){var c=this.getDotById(a),d=this.getDotById(b),e=new StaticLink(this.game,this.linksGroup,c,d);this.staticLinks.push(e)},removeStaticLink:function(a){var b=this.staticLinks.indexOf(a);this.staticLinks.splice(b,1),a.destroy()},getDotById:function(a){for(var b=0;b<this.dots.length;b++){var c=this.dots[b];if(c.id===a)return c}return null},touchDownHandler:function(a){if(this.touchInsideBounds(a.x,a.y))if(this.drawLine)this.drawLine.startFollow();else{var b=Math.round(a.x),c=Math.round(a.y),d=this.getTapDotUnderPoint(b,c);d&&(this.connectIndex++,Sounds.play("sndCollect"+this.connectIndex),this.startDrawingLine(d),this.vfx.explodeStars(d.getX(),d.getY()))}},touchInsideBounds:function(a,b){var c=Config.TOUCH_BOUNDS.x,d=Config.TOUCH_BOUNDS.y,e=Config.TOUCH_BOUNDS.width,f=Config.TOUCH_BOUNDS.height;return a>=c&&c+e>=a&&b>=d&&d+f>=b?!0:!1},fitPointInBounds:function(a,b){var c=Config.TOUCH_BOUNDS.x,d=Config.TOUCH_BOUNDS.y,e=Config.TOUCH_BOUNDS.width,f=Config.TOUCH_BOUNDS.height;return c>a?a=c:a>c+e&&(a=c+e),d>b?b=d:b>d+f&&(b=d+f),{x:a,y:b}},startDrawingLine:function(a){this.drawLine=new DrawLine(this.game,a,this.parentGroup)},touchUpHandler:function(){this.drawLine&&this.drawLine.stopFollow()},getTapDotUnderPoint:function(a,b){for(var c=40,d=void 0,e=0;e<this.dots.length;e++){var f=this.dots[e],g=a-f.getX(),h=b-f.getY(),i=Math.sqrt(g*g+h*h);c>=i&&(c=i,d=f)}return d},getNearestDotUnderPoint:function(a,b){for(var c=30,d=void 0,e=0;e<this.dots.length;e++){var f=this.dots[e];if(f!=this.drawLine.dot){var g=a-f.getX(),h=b-f.getY(),i=Math.sqrt(g*g+h*h);c>=i&&(c=i,d=f)}}return d},getStaticLinkByDots:function(a,b){for(var c=0;c<this.staticLinks.length;c++){var d=this.staticLinks[c];if(d.a1===a&&d.a2===b||d.a1===b&&d.a2===a)return d}return null},update:function(){if(this.drawLine&&(this.drawLine.update(),this.drawLine.isFollowing())){var a=this.game.input.activePointer.worldX,b=this.game.input.activePointer.worldY,c=this.getNearestDotUnderPoint(a,b);if(c){var d=this.getStaticLinkByDots(this.drawLine.dot,c);if(d)this.connectTwoDots(c,d);else{var e=this.fitPointInBounds(a,b);this.drawLine.setEndPos(e.x,e.y)}}else{var e=this.fitPointInBounds(a,b);this.drawLine.setEndPos(e.x,e.y)}}},connectTwoDots:function(a,b){var c=new UserLink(this.game,this.linksGroup,this.drawLine.dot,a);this.userLinks.push(c),this.vfx.explodeStars(a.getX(),a.getY()),this.drawLine.destroy(),this.drawLine=null,this.removeStaticLink(b),0==this.staticLinks.length?this.playerSolvedLevel():(this.connectIndex++,this.connectIndex>this.maxConnectIndex&&(this.connectIndex=this.maxConnectIndex),Sounds.play("sndCollect"+this.connectIndex),this.startDrawingLine(a))},playerSolvedLevel:function(){Sounds.play("sndLevelComplete"),this.game.input.onDown.remove(this.touchDownHandler,this),this.game.input.onUp.add(this.touchUpHandler,this),cmd.levelComplete()},undo:function(){if(this.connectIndex--,this.connectIndex<0&&(this.connectIndex=0),this.userLinks.length>0){var a=this.userLinks.pop();this.addStaticLink(a.a1.id,a.a2.id),this.drawLine.destroy(),this.startDrawingLine(a.a1),this.drawLine.stopFollow(),a.destroy()}else this.drawLine&&(this.drawLine.destroy(),this.drawLine=null)}}),Level=Class.extend({init:function(a,b){this.id=a,this.data=b,this.reset()},reset:function(){this.isCompleted=!1,this.isOpen=!1,this.bestTime=594e4,this.lastTime=-1},complete:function(a){this.isCompleted=!0,this.lastTime=1e3*Math.floor(a/1e3),this.lastTime<this.bestTime&&(this.bestTime=this.lastTime)},getTitle:function(){return this.data.name}});var game,cmd,data,cookies,fader,stateSlider,parser;Parser=Class.extend({init:function(){},generateLevel:function(a,b,c){this.game=a,this.parentGroup=b,this.game.add.sprite(0,0,"background",0,b),this.paper=new Paper(this.game,this.parentGroup);var d=c.id+1,e=new Phaser.Text(this.game,Config.WIDTH/2,Config.HEIGHT/2+35,d,{font:"500px Arial",fill:"#FFFFFF"});e.anchor.set(.5,.5),b.add(e),this.linksGroup=new Phaser.Group(this.game,this.parentGroup),this.dotsGroup=new Phaser.Group(this.game,this.parentGroup),this.parseLevelData(c.data);var f={dotsGroup:this.dotsGroup,linksGroup:this.linksGroup,dots:this.dots,staticLinks:this.staticLinks};return f},parseLevelData:function(a){this.dots=[],this.staticLinks=[];var b,c=a.items,d=a.links;if(c)for(b=0;b<c.length;b++){var e=c[b],f=e.id,g=c[b].x,h=c[b].y;this.addDot(f,g,h)}if(d)for(b=0;b<d.length;b++)this.addStaticLink(d[b].p1,d[b].p2)},addDot:function(a,b,c){var d=new Dot(this.game,this.dotsGroup,a,b,c);this.dots.push(d)},addStaticLink:function(a,b){var c=this.getDotById(a),d=this.getDotById(b),e=new StaticLink(this.game,this.linksGroup,c,d);this.staticLinks.push(e)},getDotById:function(a){for(var b=0;b<this.dots.length;b++){var c=this.dots[b];if(c.id===a)return c}return null}}),Sounds=function(){},Sounds.startMusic=function(){Config.SOUNDS_ENABLED&&(Sounds.musicChannel=game.add.audio("music",1,!0),Sounds.musicChannel.play())},Sounds.stopMusic=function(){Sounds.musicChannel&&Sounds.musicChannel.pause()},Sounds.play=function(a,b){var c=1;void 0!=b&&(c=b),Config.SOUNDS_ENABLED&&game.sound.play(a,c)};var Util=function(){};Util.pulse=function(a,b){a.add.tween(b.scale).to({x:1.2,y:1.2},1e3,Phaser.Easing.Sinusoidal.InOut).to({x:1,y:1},1e3,Phaser.Easing.Sinusoidal.InOut).loop().start()},Util.formatTime=function(a){var b=Math.floor(a/1e3),c=Math.floor(b/3600),d=Math.floor((b-3600*c)/60),e=b-3600*c-60*d;return 10>c&&(c="0"+c),10>d&&(d="0"+d),10>e&&(e="0"+e),d+":"+e},CreditsView=Dialog.extend({init:function(a){this._super(a,"creditsBox",{x:60,y:60,blockBack:!0}),this.closeBt=new MyButton(this.game,"closeButton",this.closeClick,this,{x:507,y:40,center:!0,parentGroup:this.boxHolder}),this.logoBt=new MyButton(this.game,"postepennoLogo",this.logoClick,this,{x:120,y:104,parentGroup:this.boxHolder}),this.gameByTxt=new Phaser.Text(this.game,260,470,"Game by Eugene Karataev",{font:"bold 38px Arial"}),this.gameByTxt.anchor.set(.5,0),this.boxHolder.add(this.gameByTxt),this.emailTxt=new Phaser.Text(this.game,260,520,"eugene.karataev@gmail.com",{font:"bold 34px Arial"}),this.emailTxt.anchor.set(.5,0),this.boxHolder.add(this.emailTxt)},closeClick:function(){this.destroy()},logoClick:function(){window.open("http://postepenno.com","_blank")}}),DeleteProgressView=Dialog.extend({init:function(){this._super(game,"clearProgressBox",{x:100,y:150,blockBack:!0}),this.yesBt=new MyButton(this.game,"yesButton",this.yesClick,this,{x:120,y:210,center:!0,parentGroup:this.boxHolder}),this.noBt=new MyButton(this.game,"noButton",this.noClick,this,{x:320,y:210,center:!0,parentGroup:this.boxHolder})},yesClick:function(){console.log("TODO: SHOULD CLEAR COOKIES!"),this.destroy()},noClick:function(){this.destroy()}}),Dot=Class.extend({init:function(a,b,c,d,e){this.game=a,this.id=c,this.group=new Phaser.Group(this.game,b),this.group.x=d,this.group.y=e,this.lastSprite=void 0,this.setState(Dot.BASE)},getX:function(){return this.group.x},getY:function(){return this.group.y},setState:function(a){this.state=a,this.sprite&&this.sprite.destroy(),a==Dot.BASE?this.setSprite("dotBase"):a==Dot.ACTIVE?this.setSprite("dotActive"):a==Dot.VISITED&&this.setSprite("dotVisited")},setSprite:function(a){this.sprite=new Phaser.Sprite(this.game,0,0,a),this.sprite.anchor.set(.5,.5),this.group.addAt(this.sprite,0)},setLast:function(a){1==a?(this.lastSprite=new Phaser.Sprite(this.game,0,0,"dotLast"),this.lastSprite.anchor.set(.5,.5),this.group.add(this.lastSprite)):0==a&&this.lastSprite.destroy()}}),Dot.BASE="AnchorBase",Dot.ACTIVE="AnchorActive",Dot.VISITED="AnchorVisited",DrawLine=Class.extend({init:function(a,b,c){this.game=a,this.followPointer=!1,this.dot=b,this.ex=this.dot.getX(),this.ey=this.dot.getY(),this.group=new Phaser.Group(this.game,c),this.g=new Phaser.Graphics(this.game,0,0),this.group.add(this.g),this.bmdWidth=640,this.bmdHeight=15,this.bmd=this.game.add.bitmapData(this.bmdWidth,this.bmdHeight),this.bmdGroup=new Phaser.Group(this.game,this.group),this.bmdGroup.x=this.ex,this.bmdGroup.y=this.ey,this.game.add.sprite(0,-this.bmdHeight/2,this.bmd,0,this.bmdGroup),this.endSprite=new Phaser.Sprite(this.game,0,0,"drawLineEnd"),this.endSprite.anchor.set(.5,.5),this.group.add(this.endSprite,0),this.render(),this.startFollow()},setEndPos:function(a,b){this.ex=a,this.ey=b,this.render()},render:function(){var a=this.ex-this.dot.getX(),b=this.ey-this.dot.getY(),c=Math.round(Math.sqrt(a*a+b*b)),d=Math.atan2(b,a);this.bmdGroup.rotation=d,this.bmd.clear();var e=new Phaser.Rectangle(0,0,c,this.bmdHeight);this.bmd.copyPixels("drawLine",e,0,0),this.endSprite.x=this.ex,this.endSprite.y=this.ey},update:function(){this.endSprite.rotation+=.1},startFollow:function(){this.followPointer=!0},stopFollow:function(){this.followPointer=!1},isFollowing:function(){return this.followPointer},destroy:function(){this.group.destroy()}}),FPS=function(a,b){this.game=a,this.parentGroup=b,this.game.time.advancedTiming=!0,this.init()},FPS.prototype.init=function(){this.fpsTxt=new Phaser.Text(this.game,0,0,"FPS: XXX",{font:"bold 20px Arial",fill:"#FF0000"}),this.parentGroup.add(this.fpsTxt),this.update(),this.game.time.events.loop(Phaser.Timer.SECOND,this.update,this)},FPS.prototype.update=function(){this.fpsTxt.setText("FPS: "+this.game.time.fps)},Fader=Class.extend({init:function(a){this.game=a},fade:function(a,b){this.callback=a,this.scope=b,this.pic=game.add.sprite(0,0,"fader"),this.pic.alpha=0,this.pic.inputEnabled=!0;var c=game.add.tween(this.pic).to({alpha:.8},300,Phaser.Easing.Linear.None,!0);c.onComplete.addOnce(this.fadeInComplete,this)},fadeInComplete:function(){Fader.SHOULD_FADE_OUT=!0,this.callback.call(this.scope)},fadeOut:function(){Fader.SHOULD_FADE_OUT=!1,this.pic=game.add.sprite(0,0,"fader"),this.pic.inputEnabled=!0;var a=game.add.tween(this.pic).to({alpha:0},300,Phaser.Easing.Linear.None,!0);a.onComplete.addOnce(this.fadeOutComplete,this)},fadeOutComplete:function(){this.pic.destroy()}}),Fader.SHOULD_FADE_OUT=!1,LevelCompleteView=Dialog.extend({init:function(){this._super(game,"levelCompleteBack",{x:100,y:400}),this.nextButton=new MyButton(this.game,"nextButton",this.nextClick,this,{x:220,y:180,center:!0,parent:this.box})},nextClick:function(){cmd.levelNext()}}),LevelItem=Class.extend({init:function(a,b,c,d,e){if(this.game=a,this.level=c,this.parentGroup=b,this.group=new Phaser.Group(this.game,this.parentGroup),this.group.x=d,this.group.y=e,c.isOpen){var f,g="#000000";c.isCompleted?(f="levelItemCompleteBack",g="#39541D"):(f="levelItemBack",g="#212A56"),this.bt=new MyButton(this.game,f,this.click,this,{center:!0,parentGroup:this.group});var h=new Phaser.Text(this.game,0,0,(this.level.id+1).toString(),{font:"50px Arial",fill:g});h.anchor.set(.5,.5),this.group.add(h)}else{var i=new Phaser.Sprite(this.game,0,0,"levelItemLockedBack");i.anchor.set(.5,.5),this.group.add(i)}if(c.isOpen&&c.isCompleted){var j=Util.formatTime(this.level.bestTime),k=new Phaser.Text(this.game,0,25,j,{font:"16px Arial",fill:g});k.anchor.set(.5,0),this.group.add(k)}},click:function(){fader.fade(this.go,this)},go:function(){cmd.levelStart(this.level.id)}}),LevelsGroup=Class.extend({init:function(a,b,c){this.game=a,this.id=b,this.parentGroup=c,this.group=new Phaser.Group(this.game,this.parentGroup),this.group.y=this.id*Config.HEIGHT;for(var d=25,e=5,f=100,g=100,h=(Config.WIDTH-f*(e-1))/2,i=200,j=this.id*d,k=(this.id+1)*d,l=0,m=j;k>m;m++){var n=data.levels[m];if(n){var o=h+l%e*f,p=i+Math.floor(l/e)*g;new LevelItem(this.game,this.group,n,o,p)}l++}}}),MyButton=function(a,b,c,d,e){var f=0,g=0,h=!1,i=void 0;e&&(void 0!=e.x&&(f=e.x),void 0!=e.y&&(g=e.y),1==e.center&&(h=!0),void 0!=e.parentGroup&&(i=e.parentGroup)),Phaser.Button.call(this,a,f,g,b,c,d),void 0!=i?i.add(this):a.add.existing(this),this.input.useHandCursor=!0,h&&this.anchor.set(.5,.5)},MyButton.prototype=Object.create(Phaser.Button.prototype),MyButton.prototype.constructor=MyButton,MyButton.prototype.onInputDownHandler=function(){Sounds.play("sndClick")},MyButton.prototype.scaleHide=function(){this.game.add.tween(this.scale).to({x:0,y:0},200,Phaser.Easing.Linear.None,!0)},MyButton.prototype.scaleShow=function(){this.game.add.tween(this.scale).to({x:1,y:1},200,Phaser.Easing.Linear.None,!0)},MyButton.prototype.hide=function(){this.scale.x=this.scale.y=0},MyButton.prototype.show=function(){this.scale.x=this.scale.y=1},MyButton.prototype.disableClick=function(){this.inputEnabled=!1},MyButton.prototype.enableClick=function(){this.inputEnabled=!0},DecorData=Class.extend({init:function(a,b,c){this.assetName=a,this.x=b,this.y=c}}),Paper=Class.extend({init:function(a,b){this.game=a,this.parentGroup=b,this.game.add.sprite(10,110,"paperBack",0,b);var c=Paper.decorData[Paper.decorId];this.decorSprite=this.game.add.sprite(c.x,c.y,c.assetName,0,this.parentGroup),this.decorSprite.alpha=.5}}),Paper.initData=function(){var a=new DecorData("decorSnail",520,570),b=new DecorData("decorSnail2",50,570);Paper.decorData=[a,b],Paper.decorId=0,Paper.updateDecor()},Paper.updateDecor=function(){Paper.decorId=Math.floor(Math.random()*Paper.decorData.length)},PauseView=Dialog.extend({init:function(a){this.parentState=a,this._super(game,"pauseBox",{x:100,y:200,blockBack:!0}),this.exitBt=new MyButton(this.game,"levelsButton",this.exitClick,this,{x:130,y:210,center:!0,parentGroup:this.boxHolder}),this.nextBt=new MyButton(this.game,"nextButton",this.resumeClick,this,{x:310,y:210,center:!0,parentGroup:this.boxHolder}),this.startTime=game.time.now,data.pausedByUser=!0},exitClick:function(){fader.fade(this.gotoMenu,this)},gotoMenu:function(){game.state.start("LevelSelect")},resumeClick:function(){data.pausedByUser=!1,data.pauseTime+=Math.round(game.time.now-this.startTime),this.parentState.resumeGame(),this.destroy()}}),SoundIcon=function(a,b){var c=0,d=0,e=1,f=void 0;void 0!=b&&(void 0!=b.x&&(c=b.x),void 0!=b.y&&(d=b.y),void 0!=b.scale&&(e=b.scale),void 0!=b.parentGroup&&(f=b.parentGroup)),Phaser.Group.call(this,a,void 0,"sndIcon"),f?f.add(this):a.add.existing(this),this.x=c,this.y=d,this.scale.x=this.scale.y=e,this.btOn=new Phaser.Button(this.game,0,0,"soundIconOn",this.sndClick,this),this.add(this.btOn),this.btOff=new Phaser.Button(this.game,0,0,"soundIconOff",this.sndClick,this),this.add(this.btOff),this.btOn.anchor.set(.5,.5),this.btOff.anchor.set(.5,.5),this.updateIcon()},SoundIcon.prototype=Object.create(Phaser.Group.prototype),SoundIcon.prototype.constructor=SoundIcon,SoundIcon.prototype.updateIcon=function(){Config.SOUNDS_ENABLED?(this.btOn.visible=!0,this.btOff.visible=!1):(this.btOn.visible=!1,this.btOff.visible=!0)},SoundIcon.prototype.sndClick=function(){Config.SOUNDS_ENABLED=!Config.SOUNDS_ENABLED,Config.SOUNDS_ENABLED?Sounds.startMusic():Sounds.stopMusic(),cookies.saveSound(),this.updateIcon()},StateSlider=Class.extend({init:function(){this.transitionTime=1500,this.easingIn=Phaser.Easing.Cubic.In,this.easingOut=Phaser.Easing.Cubic.Out},levelComplete:function(){var a=data.curLevel.id,b=data.levels[a+1];b?this.slideToNextLevel(b):cmd.gameComplete()},slideToNextLevel:function(a){Paper.updateDecor();var b=game.state.getCurrentState().getCoreGroup();this.transitionGroup=new Phaser.Group(game,b),this.transitionGroup.x=Config.WIDTH,parser.generateLevel(game,this.transitionGroup,a);var c=new Phaser.Tween(game.camera,game,game.tweens);c.to({x:Config.WIDTH},this.transitionTime,Phaser.Easing.Cubic.InOut),c.onComplete.addOnce(this.levelSlideComplete,this),c.start()},levelSlideComplete:function(){var a=data.curLevel.id+1;cmd.levelStart(a)}}),StaticLink=Class.extend({init:function(a,b,c,d){this.game=a,this.a1=c,this.a2=d;var e=this.a2.getX()-this.a1.getX(),f=this.a2.getY()-this.a1.getY(),g=Math.round(Math.sqrt(e*e+f*f)),h=Math.atan2(f,e);this.group=new Phaser.Group(this.game,b),this.bmdWidth=g,this.bmdHeight=15,this.bmd=this.game.add.bitmapData(this.bmdWidth,this.bmdHeight),this.bmdGroup=new Phaser.Group(this.game,this.group),this.bmdGroup.x=this.a1.getX(),this.bmdGroup.y=this.a1.getY(),this.game.add.sprite(0,-this.bmdHeight/2,this.bmd,0,this.bmdGroup),this.bmdGroup.rotation=h,this.bmd.clear();var i=new Phaser.Rectangle(0,0,g,this.bmdHeight);this.bmd.copyPixels("staticLink",i,0,0)},render:function(){},destroy:function(){this.group.destroy()}}),UserLink=Class.extend({init:function(a,b,c,d){this.game=a,this.a1=c,this.a2=d;var e=this.a2.getX()-this.a1.getX(),f=this.a2.getY()-this.a1.getY(),g=Math.round(Math.sqrt(e*e+f*f)),h=Math.atan2(f,e);this.group=new Phaser.Group(this.game,b),this.bmdWidth=g,this.bmdHeight=15,this.bmd=this.game.add.bitmapData(this.bmdWidth,this.bmdHeight),this.bmdGroup=new Phaser.Group(this.game,this.group),this.bmdGroup.x=this.a1.getX(),this.bmdGroup.y=this.a1.getY(),this.game.add.sprite(0,-this.bmdHeight/2,this.bmd,0,this.bmdGroup),this.bmdGroup.rotation=h,this.bmd.clear();var i=new Phaser.Rectangle(0,0,g,this.bmdHeight);this.bmd.copyPixels("userLink",i,0,0)},render:function(){this.g.clear(),this.g.lineStyle(5,"0x000000"),this.g.moveTo(this.a1.getX(),this.a1.getY()),this.g.lineTo(this.a2.getX(),this.a2.getY())},destroy:function(){this.group.destroy()}}),VisualFX=Class.extend({init:function(a){this.game=a,this.emitter=this.game.add.emitter(0,0,100),this.emitter.makeParticles(["starParticle1","starParticle2","starParticle3","starParticle4"]),this.emitter.gravity=0,this.emitter.setAlpha(1,0,4e3),this.emitter.setScale(.3,1.5,.3,1.5,2e3)},explodeStars:function(a,b){this.emitter.x=a,this.emitter.y=b,this.emitter.start(!0,2e3,null,10)}});var App={};App.BootState=function(){},App.BootState.prototype={preload:function(){this.load.image("preloadBar","assets/images/preloadBar.png"),this.load.image("preloadBarHolder","assets/images/preloadBarHolder.png"),this.load.image("background","assets/images/background.png"),game.stage.backgroundColor="#EBE7DA"},create:function(){this.game.input.maxPointers=1,this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0,this.game.scale.enterPortrait.add(this.rescale,this),this.game.scale.enterLandscape.add(this.rescale,this),this.game.scale.setScreenSize(!0),Config.TRANSPARENT&&(this.game.world.alpha=.5),this.game.state.start("Preloader")},rescale:function(){var a=this.game;setTimeout(function(){a.scale.refresh()},500)}},App.GameplayState=function(){},App.GameplayState.prototype={init:function(a){this.readySignal=null,a&&void 0!=a.readySignal&&(this.readySignal=a.readySignal)},create:function(){this.coreGroup=new Phaser.Group(this.game,this.game.world);var a=parser.generateLevel(this.game,this.coreGroup,data.curLevel);this.logic=new GameLogic(this.game,this.coreGroup,a.dotsGroup,a.linksGroup,a.dots,a.staticLinks),this.uiGroup=new Phaser.Group(this.game,this.game.world),this.uiGroup.fixedToCamera=!0,this.add.sprite(0,0,"levelUIBack",0,this.uiGroup),this.restartBt=new MyButton(this.game,"restartButton",this.restartClick,this,{x:480,y:50,center:!0,parentGroup:this.uiGroup}),this.pauseBt=new MyButton(this.game,"pauseButton",this.pauseClick,this,{x:590,y:50,center:!0,parentGroup:this.uiGroup}),this.undoBt=new MyButton(this.game,"undoButton",this.undoClick,this,{x:270,y:50,center:!0,parentGroup:this.uiGroup}),this.soundIcon=new SoundIcon(this.game,{x:370,y:50,parentGroup:this.uiGroup}),this.cheatBt=new MyButton(this.game,"cheatButton",this.cheatClick,this,{x:40,y:40,center:!0,parentGroup:this.uiGroup}),Config.SHOW_FPS&&(this.fps=new FPS(this.game,this.uiGroup)),this.game.onPause.add(this.globalPauseOn,this),this.game.onResume.add(this.globalPauseOff,this),this.readySignal&&(this.readySignal.dispatch(),this.readySignal.dispose())},cheatClick:function(){cmd.levelComplete()},undoClick:function(){this.logic.undo()},globalPauseOn:function(){this.globalPauseStart=game.time.now},globalPauseOff:function(){data.pausedByUser||(data.pauseTime+=Math.round(game.time.now-this.globalPauseStart))},addTimerEvent:function(){this.timerEvent=this.game.time.events.loop(Phaser.Timer.SECOND,this.updateUI,this)},removeTimerEvent:function(){this.game.time.events.remove(this.timerEvent)},updateUI:function(){this.timer.setTime(data.getLevelTime())},levelComplete:function(){this.add.tween(this.coreGroup).to({x:-640},1e3,Phaser.Easing.Cubic.In,!0)},getCoreGroup:function(){return this.coreGroup},update:function(){this.logic.update()},render:function(){},restartClick:function(){cmd.levelStart(data.curLevel.id,!1)},pauseClick:function(){this.removeTimerEvent(),this.pauseView=new PauseView(this)},resumeGame:function(){}},App.LevelSelectState=function(){},App.LevelSelectState.prototype={create:function(){this.add.sprite(0,0,"background"),this.itemsHolder=new Phaser.Group(this.game,this.game.world);for(var a=0;3>a;a++){new LevelsGroup(this.game,a,this.itemsHolder)}this.game.add.sprite(0,10,"levelSelectTitle"),this.homeBt=new MyButton(this.game,"homeButton",this.homeClick,this,{x:70,y:650,center:!0}),this.scrollUp=new MyButton(this.game,"upButton",this.scrollUpClick,this,{x:570,y:650,center:!0}),this.scrollDown=new MyButton(this.game,"downButton",this.scrollDownClick,this,{x:450,y:650,center:!0}),this.itemsHolder.y=-Config.HEIGHT*App.LevelSelectState.CURRENT_GROUP_ID,0==App.LevelSelectState.CURRENT_GROUP_ID?this.scrollUp.hide():2==App.LevelSelectState.CURRENT_GROUP_ID&&this.scrollDown.hide(),Fader.SHOULD_FADE_OUT&&fader.fadeOut()},scrollUpClick:function(){1==App.LevelSelectState.CURRENT_GROUP_ID?this.scrollUp.scaleHide():2==App.LevelSelectState.CURRENT_GROUP_ID&&this.scrollDown.scaleShow(),App.LevelSelectState.CURRENT_GROUP_ID--,this.scrollUp.disableClick(),this.scrollDown.disableClick();var a=this.game.add.tween(this.itemsHolder);a.to({y:-Config.HEIGHT*App.LevelSelectState.CURRENT_GROUP_ID},500,Phaser.Easing.Quadratic.InOut,!0),a.onComplete.addOnce(this.scrollComplete,this)},scrollDownClick:function(){0==App.LevelSelectState.CURRENT_GROUP_ID?this.scrollUp.scaleShow():1==App.LevelSelectState.CURRENT_GROUP_ID&&this.scrollDown.scaleHide(),App.LevelSelectState.CURRENT_GROUP_ID++,this.scrollUp.disableClick(),this.scrollDown.disableClick();var a=this.game.add.tween(this.itemsHolder);a.to({y:-Config.HEIGHT*App.LevelSelectState.CURRENT_GROUP_ID},500,Phaser.Easing.Quadratic.InOut,!0),a.onComplete.addOnce(this.scrollComplete,this)},scrollComplete:function(){this.scrollUp.enableClick(),this.scrollDown.enableClick()},homeClick:function(){fader.fade(this.gotoMainMenu,this)},gotoMainMenu:function(){this.game.state.start("MainMenu")}},App.LevelSelectState.CURRENT_GROUP_ID=0,App.MainMenuState=function(){},App.MainMenuState.prototype={create:function(){this.add.sprite(0,0,"background"),this.title=this.add.sprite(110,150,"gameTitle"),this.add.sprite(0,387,"menuCharacter"),this.playBt=new MyButton(this.game,"playButton2",this.playClick,this,{x:415,y:580,center:!0}),Util.pulse(this,this.playBt),this.soundIcon=new SoundIcon(this.game,{x:580,y:60}),this.deleteProgressBt=new MyButton(this.game,"restartButton",this.deleteProgressClick,this,{x:580,y:640,center:!0}),this.creditsBt=new MyButton(this.game,"creditsButton",this.creditsClick,this,{x:580,y:520,center:!0});var a="v "+Config.VERSION;this.add.text(2,0,a,{font:"10px Arial",fill:"#000000"}),Config.SHOW_FPS&&(this.fps=new FPS(this.game,this.game.world)),Config.RELEASE||this.add.text(10,10,"DEVELOPMENT VERSION",{font:"30px Arial",fill:"#FF0000"}),Fader.SHOULD_FADE_OUT&&fader.fadeOut()},showWithTweens:function(){this.title.alpha=0,this.add.tween(this.title).to({alpha:1},800,Phaser.Easing.Linear.None,!0),this.tweenScaleButton(this.soundIcon,800),this.tweenScaleButton(this.creditsBt,1e3),this.tweenScaleButton(this.deleteProgressBt,1200),this.tweenAlphaButton(this.playBt,1500)},tweenScaleButton:function(a,b){a.scale.x=a.scale.y=0,this.add.tween(a.scale).to({x:1,y:1},500,Phaser.Easing.Back.Out,!0,b)},tweenAlphaButton:function(a,b){a.alpha=0,this.add.tween(a).to({alpha:1},500,Phaser.Easing.Linear.None,!0,b)},playClick:function(){fader.fade(this.startGame,this)},startGame:function(){cmd.gameStart()},deleteProgressClick:function(){new DeleteProgressView(this.game)},creditsClick:function(){new CreditsView(this.game)}},App.PreloaderState=function(){},App.PreloaderState.prototype={preload:function(){this.add.sprite(0,0,"background");var a,b=["fader","blackBack","gameTitle","playButton2","soundIconOn","soundIconOff","creditsButton","menuCharacter","creditsBox","closeButton","postepennoLogo","clearProgressBox","yesButton","noButton","levelSelectTitle","homeButton","upButton","downButton","levelItemBack","levelItemCompleteBack","levelItemLockedBack","levelUIBack","restartButton","pauseButton","undoButton","cheatButton","paperBack","dotBase","dotActive","dotVisited","dotLast","drawLineEnd","starParticle1","starParticle2","starParticle3","starParticle4","staticLink","userLink","drawLine","decorSnail","decorSnail2","pauseBox","levelsButton","nextButton","levelCompleteBack"],c=["sndClick","sndCollect1","sndCollect2","sndCollect3","sndCollect4","sndCollect5","sndCollect6","sndCollect7","sndCollect8","sndLevelComplete"];
for(a=0;a<b.length;a++){var d=-1==b[a].indexOf(".jpg")?b[a]+".png":b[a];this.load.image(b[a],"assets/images/"+d)}for(a=0;a<c.length;a++){var e=c[a]+".mp3",f=c[a]+".ogg";this.load.audio(c[a],["assets/sounds/"+e,"assets/sounds/"+f])}this.holder=this.game.add.group(),this.add.sprite(120,280,"preloadBarHolder",null,this.holder),this.preloadBar=this.add.sprite(127,287,"preloadBar",null,this.holder),this.progressTxt=this.game.add.text(Config.WIDTH/2,200,"0%",{font:"bold 50px Arial",fill:"#000000"},this.holder),this.progressTxt.anchor.set(.5,0),this.load.setPreloadSprite(this.preloadBar),this.load.onFileComplete.add(this.fileLoaded,this)},fileLoaded:function(a){this.progressTxt.setText(a+"%")},create:function(){var a=this.game.add.tween(this.holder).to({alpha:0,y:this.holder.y+60},800,Phaser.Easing.Linear.None,!0);a.onComplete.addOnce(this.preloaderComplete,this)},preloaderComplete:function(){fader=new Fader(this.game),cmd=new Commands,data=new Data,data.init(),cookies=new Cookies,stateSlider=new StateSlider,parser=new Parser,Paper.initData(),this.game.state.start("MainMenu")}};