function Config(){}function startup(){game=new Phaser.Game(Config.WIDTH,Config.HEIGHT,Phaser.CANVAS,"gameArea"),game.state.add("Boot",App.BootState),game.state.add("Preloader",App.PreloaderState),game.state.add("MainMenu",App.MainMenuState),game.state.add("Gameplay",App.GameplayState),game.state.add("GameComplete",App.GameCompleteState),game.state.add("LevelSelect",App.LevelSelectState),game.state.start("Boot")}App.Commands=Class.extend({init:function(){this.playerMove=new Phaser.Signal},gameStart:function(){Config.TEST_GAME_COMPLETE?cmd.gameComplete():game.state.start("LevelSelect")},levelStart:function(a){data.curLevel=data.levels[a],data.levelStartTime=game.time.now,data.pauseTime=0,data.levelMoves=0,game.state.start("Gameplay")},levelStartFromFile:function(){var a=JSON.parse(JSON.stringify(game.cache.getJSON("jsonLevel")));data.curLevel=new App.Level(0,a),game.state.start("Gameplay")},levelComplete:function(){sounds.play("sndLevelComplete"),new App.LevelCompleteView},levelNext:function(){var a=data.curLevel.id,b=data.levels[a+1];b?fader.fade(this.gotoNextLevel,this):cmd.gameComplete()},gotoNextLevel:function(){var a=data.curLevel.id;cmd.levelStart(a+1)},gameComplete:function(){fader.fade(this.doGameComplete,this)},doGameComplete:function(){game.state.start("GameComplete")}}),Config.VERSION="0.3",Config.WIDTH=640,Config.HEIGHT=832,Config.ITEM_GFX_RADIUS=30,Config.ITEM_TOUCH_RADIUS=35,Config.DRAG_BOUNDS={x:0,y:100,width:Config.WIDTH,height:Config.HEIGHT-100},Config.ANIMATION=!0,Config.SOUNDS_ENABLED=!1,Config.TRANSPARENT=!1,Config.START_LEVEL=0,Config.TEST_GAME_COMPLETE=!1,Config.SHOW_FPS=!0,Config.OPEN_ALL_LEVELS=!0,Config.ENABLE_CHEAT=!0,Config.LOAD_LEVEL_FROM_FILE=!0,Config.EDITOR_MODE=!1,Config.RELEASE=!1,Config.RELEASE&&(Config.ANIMATION=!0,Config.SOUNDS_ENABLED=!0,Config.TRANSPARENT=!1,Config.START_LEVEL=0,Config.TEST_GAME_COMPLETE=!1,Config.SHOW_FPS=!1,Config.OPEN_ALL_LEVELS=!1,Config.ENABLE_CHEAT=!1,Config.LOAD_LEVEL_FROM_FILE=!1,Config.EDITOR_MODE=!1),App.Cookies=Class.extend({init:function(){this.gameStorageKey="ussrposters",this.initSound(),this.isNewGame=!0,this.initLevels()},isSupported:function(){var a="test",b=window.sessionStorage;try{return b.setItem(a,"1"),b.removeItem(a),!0}catch(c){return!1}},getStorage:function(a){return localStorage[this.gameStorageKey+"."+a]},setStorage:function(a,b){this.isSupported()&&(localStorage[this.gameStorageKey+"."+a]=b)},initSound:function(){Config.SOUNDS_ENABLED="false"==this.getStorage("soundEnabled")?!1:!0},saveSound:function(){this.setStorage("soundEnabled",Config.SOUNDS_ENABLED)},initLevels:function(){if(void 0!=this.getStorage("levels"))for(var a=0;a<data.levels.length;a++){var b=data.levels[a];"true"==this.getStorage("levels."+a+".isCompleted")&&(b.isOpen=!0,b.isCompleted=!0,this.isNewGame=!1)}this.updateOpenLevels()},updateOpenLevels:function(){var a,b;if(Config.OPEN_ALL_LEVELS)for(a=0;a<data.levels.length;a++)b=data.levels[a],b.isOpen=!0;else for(a=0;a<data.levels.length;a++)if(b=data.levels[a],!b.isCompleted){b.isOpen=!0;break}},levelComplete:function(){this.setStorage("levels","true");var a=data.curLevel.id;this.setStorage("levels."+a+".isCompleted","true"),this.isNewGame=!1,this.updateOpenLevels()},clear:function(){localStorage.clear(),this.isNewGame=!0,this.uncompleteLevels(),this.updateOpenLevels()},uncompleteLevels:function(){for(var a=0;a<data.levels.length;a++){var b=data.levels[a];b.reset()}}}),App.Data=Class.extend({init:function(){this.curLevel=null,this.levelStartTime=0,this.smileySet=[{happy:"dragItemHappy",sad:"dragItemSad",meh:"dragItemMeh"},{happy:"dragItemHappy2",sad:"dragItemSad2",meh:"dragItemMeh2"}],this.pauseTime=0,this.pausedByUser=!1,this.levelMoves=0,this.initLevels(),this.atlasName="atlas"},getRandomSmileySet:function(){return Math.floor(Math.random()*this.smileySet.length)},getSmileyAsset:function(a,b){return this.smileySet[a][b]},text:function(a){return data.texts[Config.LANGUAGE][a]},getAtlasKey:function(a){return this.atlasName+"/"+a+"_0000"},addAtlasSprite:function(a,b){var c=util.getParam(b,"x",0),d=util.getParam(b,"y",0),e=util.getParam(b,"center",!1),f=util.getParam(b,"parent",game.world),g=game.add.sprite(c,d,this.atlasName,this.getAtlasKey(a),f);return e&&g.anchor.set(.5,.5),g},initLevels:function(){this.levels=[],this.addLevel({name:"Rails Krest",items:[{id:0,x:489,y:199},{id:1,x:189,y:619},{id:2,x:485,y:619},{id:3,x:195,y:199}],links:[{p1:2,p2:3},{p1:0,p2:1}],rails:[{x1:568,y1:622,x2:94,y2:622},{x1:556,y1:199,x2:91,y2:199}],circleRails:[]}),this.addLevel({name:"Rails 2",items:[{id:0,x:502,y:506},{id:1,x:502,y:339},{id:2,x:160,y:509},{id:3,x:160,y:340},{id:4,x:432,y:199},{id:5,x:228,y:619},{id:6,x:418,y:622},{id:7,x:229,y:199}],links:[{p1:1,p2:2},{p1:0,p2:3},{p1:6,p2:7},{p1:5,p2:4}],rails:[{x1:502,y1:622,x2:502,y2:199},{x1:160,y1:622,x2:160,y2:199},{x1:568,y1:622,x2:94,y2:622},{x1:556,y1:199,x2:91,y2:199}],circleRails:[]}),this.addLevel({name:"Rails diagonal",items:[{id:0,x:284,y:701},{id:1,x:171,y:402},{id:2,x:455,y:522},{id:3,x:323,y:218},{id:4,x:455,y:350},{id:5,x:230,y:305},{id:6,x:138,y:555},{id:7,x:314,y:546}],links:[{p1:7,p2:2},{p1:3,p2:2},{p1:4,p2:1},{p1:0,p2:1},{p1:5,p2:7},{p1:4,p2:7},{p1:7,p2:6}],rails:[{x1:333,y1:749,x2:73,y2:489},{x1:584,y1:479,x2:252,y2:147},{x1:442,y1:673,x2:67,y2:298},{x1:585,y1:659,x2:74,y2:148}],circleRails:[]}),this.addLevel({name:"Star Rails",items:[{id:0,x:497,y:268},{id:1,x:133,y:619},{id:2,x:68,y:449},{id:3,x:324,y:196},{id:4,x:504,y:624},{id:5,x:574,y:446},{id:6,x:323,y:702},{id:7,x:140,y:272}],links:[{p1:3,p2:4},{p1:4,p2:2},{p1:2,p2:0},{p1:0,p2:6},{p1:6,p2:7},{p1:7,p2:5},{p1:5,p2:1},{p1:1,p2:3}],rails:[{x1:563,y1:680,x2:91,y2:226},{x1:533,y1:233,x2:99,y2:650}]}),this.addLevel({name:"Rails Quad",items:[{id:0,x:347,y:412},{id:1,x:60,y:156},{id:2,x:591,y:158},{id:3,x:49,y:672},{id:4,x:601,y:673},{id:5,x:555,y:358},{id:6,x:555,y:444},{id:7,x:128,y:366},{id:8,x:128,y:428},{id:9,x:380,y:593},{id:10,x:307,y:593},{id:11,x:310,y:218},{id:12,x:387,y:218}],links:[{p1:1,p2:0},{p1:0,p2:4},{p1:3,p2:0},{p1:0,p2:2},{p1:4,p2:2},{p1:7,p2:2},{p1:9,p2:2},{p1:2,p2:1},{p1:10,p2:1},{p1:5,p2:1},{p1:1,p2:3},{p1:6,p2:3},{p1:11,p2:3},{p1:3,p2:4},{p1:12,p2:4},{p1:4,p2:8}],rails:[{x1:555,y1:594,x2:555,y2:218},{x1:128,y1:592,x2:128,y2:218},{x1:555,y1:594,x2:128,y2:592},{x1:555,y1:218,x2:128,y2:218}]}),this.addLevel({name:"Between Rails",items:[{id:0,x:562,y:628},{id:1,x:313,y:701},{id:2,x:53,y:245},{id:3,x:369,y:225},{id:4,x:55,y:641},{id:5,x:478,y:477},{id:6,x:576,y:322},{id:7,x:330,y:468},{id:8,x:167,y:309},{id:9,x:484,y:166},{id:10,x:152,y:751},{id:11,x:505,y:751},{id:12,x:184,y:166}],links:[{p1:11,p2:2},{p1:10,p2:2},{p1:9,p2:0},{p1:12,p2:0},{p1:2,p2:1},{p1:1,p2:0},{p1:5,p2:1},{p1:1,p2:8},{p1:3,p2:2},{p1:2,p2:6},{p1:11,p2:3},{p1:3,p2:5},{p1:5,p2:4},{p1:9,p2:4},{p1:4,p2:0},{p1:0,p2:7},{p1:12,p2:7},{p1:7,p2:8},{p1:8,p2:6},{p1:6,p2:10}],rails:[{x1:579,y1:751,x2:67,y2:751},{x1:575,y1:166,x2:79,y2:166}]}),this.addLevel({name:"Rails Romb",items:[{id:0,x:43,y:563},{id:1,x:313,y:339},{id:2,x:131,y:158},{id:3,x:322,y:521},{id:4,x:311,y:451,fixed:!0},{id:5,x:56,y:236},{id:6,x:102,y:701},{id:7,x:547,y:734},{id:8,x:308,y:197},{id:9,x:161,y:520},{id:10,x:524,y:155},{id:11,x:574,y:323},{id:12,x:592,y:514},{id:13,x:406,y:245},{id:14,x:283,y:762},{id:15,x:470,y:606},{id:16,x:122,y:356}],links:[{p1:4,p2:5},{p1:4,p2:6},{p1:4,p2:7},{p1:4,p2:8},{p1:1,p2:15},{p1:2,p2:13},{p1:3,p2:16},{p1:0,p2:14},{p1:6,p2:12},{p1:5,p2:12},{p1:6,p2:10},{p1:7,p2:10},{p1:7,p2:9},{p1:8,p2:9},{p1:8,p2:11},{p1:5,p2:11},{p1:5,p2:8},{p1:8,p2:7},{p1:7,p2:6},{p1:6,p2:5},{p1:16,p2:11},{p1:11,p2:14},{p1:14,p2:9},{p1:9,p2:15},{p1:15,p2:10},{p1:10,p2:13},{p1:13,p2:12},{p1:12,p2:16}],rails:[{x1:306,y1:134,x2:593,y2:453},{x1:593,y1:453,x2:313,y2:802},{x1:313,y1:802,x2:45,y2:449},{x1:45,y1:449,x2:306,y2:134}]}),this.addLevel({name:"Vertical Rail",items:[{id:0,x:600,y:636},{id:1,x:315,y:768},{id:2,x:206,y:522},{id:3,x:201,y:226},{id:4,x:480,y:589},{id:5,x:91,y:423},{id:6,x:552,y:532},{id:7,x:495,y:755},{id:8,x:258,y:158},{id:9,x:597,y:474},{id:10,x:549,y:185},{id:11,x:91,y:692},{id:12,x:259,y:420},{id:13,x:518,y:346},{id:14,x:455,y:150},{id:15,x:440,y:471},{id:16,x:600,y:267},{id:17,x:91,y:285},{id:18,x:146,y:156},{id:19,x:180,y:729},{id:20,x:354,y:637},{id:21,x:365,y:324},{id:22,x:376,y:194},{id:23,x:91,y:566}],links:[{p1:0,p2:1},{p1:1,p2:2},{p1:2,p2:3},{p1:3,p2:4},{p1:4,p2:5},{p1:6,p2:7},{p1:7,p2:8},{p1:8,p2:9},{p1:9,p2:10},{p1:10,p2:11},{p1:12,p2:13},{p1:13,p2:14},{p1:14,p2:15},{p1:15,p2:16},{p1:16,p2:17},{p1:18,p2:19},{p1:19,p2:20},{p1:20,p2:21},{p1:21,p2:22},{p1:22,p2:23}],rails:[{x1:91,y1:764,x2:91,y2:164}]}),this.addLevel({name:"Vertical Rail 2",items:[{id:0,x:230,y:569},{id:1,x:596,y:404},{id:2,x:51,y:313},{id:3,x:384,y:135},{id:4,x:173,y:705},{id:5,x:600,y:687},{id:6,x:470,y:757},{id:7,x:64,y:523},{id:8,x:75,y:669},{id:9,x:539,y:206},{id:10,x:189,y:405},{id:11,x:501,y:346},{id:12,x:455,y:617},{id:13,x:610,y:516},{id:14,x:200,y:165},{id:15,x:184,y:303},{id:16,x:304,y:590},{id:17,x:304,y:344},{id:18,x:304,y:752},{id:19,x:304,y:228},{id:20,x:304,y:484}],links:[{p1:14,p2:9},{p1:13,p2:6},{p1:3,p2:0},{p1:2,p2:6},{p1:10,p2:8},{p1:1,p2:3},{p1:16,p2:1},{p1:1,p2:0},{p1:0,p2:2},{p1:2,p2:3},{p1:3,p2:17},{p1:5,p2:11},{p1:17,p2:5},{p1:5,p2:4},{p1:4,p2:10},{p1:10,p2:11},{p1:11,p2:18},{p1:7,p2:13},{p1:18,p2:7},{p1:7,p2:6},{p1:6,p2:12},{p1:12,p2:13},{p1:13,p2:19},{p1:9,p2:8},{p1:8,p2:14},{p1:14,p2:15},{p1:19,p2:9},{p1:9,p2:15},{p1:15,p2:20}],rails:[{x1:304,y1:764,x2:304,y2:164}]}),this.addLevel({name:"Many Rails",items:[{id:0,x:81,y:621},{id:1,x:562,y:776},{id:2,x:426,y:402},{id:3,x:88,y:383},{id:4,x:207,y:147},{id:5,x:486,y:658},{id:6,x:578,y:406},{id:7,x:43,y:496},{id:8,x:210,y:695},{id:9,x:109,y:695},{id:10,x:398,y:695},{id:11,x:329,y:564},{id:12,x:490,y:564},{id:13,x:151,y:564},{id:14,x:219,y:442},{id:15,x:304,y:442},{id:16,x:496,y:442},{id:17,x:310,y:319},{id:18,x:134,y:319},{id:19,x:539,y:319},{id:20,x:357,y:199},{id:21,x:489,y:199},{id:22,x:133,y:199}],links:[{p1:1,p2:2},{p1:3,p2:0},{p1:0,p2:11},{p1:1,p2:11},{p1:2,p2:11},{p1:3,p2:11},{p1:4,p2:6},{p1:7,p2:5},{p1:4,p2:17},{p1:6,p2:17},{p1:7,p2:17},{p1:5,p2:17},{p1:20,p2:18},{p1:18,p2:14},{p1:14,p2:12},{p1:12,p2:8},{p1:8,p2:13},{p1:13,p2:14},{p1:14,p2:19},{p1:19,p2:20},{p1:9,p2:12},{p1:12,p2:15},{p1:15,p2:18},{p1:18,p2:21},{p1:8,p2:11},{p1:11,p2:14},{p1:14,p2:17},{p1:17,p2:20},{p1:10,p2:13},{p1:13,p2:16},{p1:16,p2:19},{p1:19,p2:22}],rails:[{x1:575,y1:695,x2:54,y2:695},{x1:575,y1:564,x2:54,y2:564},{x1:575,y1:442,x2:54,y2:442},{x1:575,y1:319,x2:54,y2:319},{x1:575,y1:199,x2:54,y2:199}]}),this.addLevel({name:"Circle Rail Intro",items:[{id:0,x:550,y:460},{id:1,x:95,y:460},{id:2,x:320,y:685},{id:3,x:320,y:235}],links:[{p1:0,p2:1},{p1:2,p2:3}],rails:[],circleRails:[{x:320,y:460,r:225}]}),this.addLevel({name:"Circle Rail 2",items:[{id:0,x:159,y:619},{id:1,x:490,y:619},{id:2,x:490,y:310},{id:3,x:161,y:295},{id:4,x:550,y:460},{id:5,x:95,y:460},{id:6,x:320,y:685},{id:7,x:320,y:235}],links:[{p1:0,p2:3},{p1:3,p2:2},{p1:2,p2:1},{p1:1,p2:0},{p1:5,p2:6},{p1:6,p2:4},{p1:4,p2:7},{p1:7,p2:5}],rails:[],circleRails:[{x:320,y:460,r:225}]}),this.addLevel({name:"Concentric Circles",items:[{id:0,x:88,y:521},{id:1,x:180,y:407},{id:2,x:396,y:331},{id:3,x:235,y:583},{id:4,x:445,y:544},{id:5,x:186,y:659},{id:6,x:126,y:319},{id:7,x:466,y:270},{id:8,x:391,y:689},{id:9,x:554,y:405},{id:10,x:266,y:226},{id:11,x:536,y:564}],links:[{p1:1,p2:3},{p1:8,p2:0},{p1:0,p2:10},{p1:10,p2:5},{p1:5,p2:9},{p1:9,p2:6},{p1:6,p2:11},{p1:11,p2:7},{p1:7,p2:8},{p1:8,p2:1},{p1:9,p2:3},{p1:11,p2:2},{p1:10,p2:4},{p1:3,p2:4},{p1:4,p2:1},{p1:1,p2:2},{p1:2,p2:3}],rails:[],circleRails:[{x:320,y:460,r:150},{x:320,y:460,r:240}]}),this.addLevel({name:"Two Circles",items:[{id:0,x:430,y:741},{id:1,x:202,y:198},{id:2,x:426,y:184},{id:3,x:320,y:639,fixed:!0},{id:4,x:215,y:746},{id:5,x:326,y:789},{id:6,x:243,y:419},{id:7,x:175,y:327},{id:8,x:171,y:626},{id:9,x:320,y:290,fixed:!0},{id:10,x:319,y:140},{id:11,x:470,y:627},{id:12,x:224,y:523},{id:13,x:443,y:376},{id:14,x:389,y:506},{id:15,x:469,y:277}],links:[{p1:15,p2:14},{p1:13,p2:12},{p1:13,p2:2},{p1:2,p2:8},{p1:8,p2:12},{p1:15,p2:1},{p1:1,p2:0},{p1:0,p2:14},{p1:9,p2:3},{p1:5,p2:3},{p1:11,p2:3},{p1:4,p2:3},{p1:10,p2:9},{p1:7,p2:9},{p1:6,p2:9},{p1:13,p2:6},{p1:6,p2:10},{p1:10,p2:7},{p1:7,p2:15},{p1:14,p2:4},{p1:4,p2:11},{p1:11,p2:5},{p1:5,p2:12},{p1:7,p2:4},{p1:6,p2:5}],rails:[],circleRails:[{x:320,y:639,r:150},{x:320,y:290,r:150}]}),this.addLevel({name:"Grid Circle",items:[{id:0,x:305,y:321},{id:1,x:579,y:180},{id:2,x:104,y:745},{id:3,x:375,y:393},{id:4,x:247,y:593},{id:5,x:439,y:275},{id:6,x:378,y:652},{id:7,x:42,y:350},{id:8,x:481,y:651},{id:9,x:179,y:253},{id:10,x:106,y:590},{id:11,x:562,y:395},{id:12,x:475,y:460},{id:13,x:261,y:460},{id:14,x:267,y:704},{id:15,x:154,y:460},{id:16,x:306,y:210}],links:[{p1:5,p2:6},{p1:7,p2:4},{p1:14,p2:7},{p1:10,p2:9},{p1:9,p2:8},{p1:15,p2:8},{p1:8,p2:4},{p1:6,p2:10},{p1:10,p2:13},{p1:14,p2:3},{p1:3,p2:16},{p1:2,p2:16},{p1:2,p2:11},{p1:0,p2:10},{p1:0,p2:9},{p1:1,p2:9},{p1:8,p2:1},{p1:3,p2:1},{p1:1,p2:0},{p1:0,p2:2},{p1:2,p2:3},{p1:13,p2:6},{p1:4,p2:15},{p1:16,p2:11},{p1:5,p2:13},{p1:13,p2:11},{p1:11,p2:5},{p1:7,p2:15},{p1:15,p2:14},{p1:14,p2:16},{p1:5,p2:16},{p1:16,p2:7},{p1:6,p2:9},{p1:9,p2:4},{p1:12,p2:6},{p1:6,p2:4},{p1:4,p2:12},{p1:12,p2:5},{p1:5,p2:7},{p1:7,p2:12}],rails:[{x1:570,y1:460,x2:70,y2:460}],circleRails:[{x:320,y:460,r:250}]})},addLevel:function(a){var b=this.levels.length,c=new App.Level(b,JSON.parse(JSON.stringify(a)));this.levels.push(c)},getLevelTime:function(){return Math.round(game.time.elapsedSince(this.levelStartTime)-data.pauseTime)}}),App.Dialog=Class.extend({init:function(a,b){var c=util.getParam(b,"x",0),d=util.getParam(b,"y",0),e=util.getParam(b,"blockBack",!1),f=util.getParam(b,"doTween",!0);this.holder=new Phaser.Group(game,game.world),e&&(this.block=new Phaser.Sprite(game,0,0,"blackBack"),this.block.inputEnabled=!0,this.holder.add(this.block)),this.boxHolder=new Phaser.Group(game,this.holder),this.boxHolder.x=c,this.boxHolder.y=d,this.box=data.addAtlasSprite(a,{parent:this.boxHolder,center:!0}),f&&(this.boxHolder.alpha=0,this.boxHolder.scale.x=this.boxHolder.scale.y=.5,game.add.tween(this.boxHolder).to({alpha:1},500,Phaser.Easing.Linear.None,!0),game.add.tween(this.boxHolder.scale).to({x:1,y:1},500,Phaser.Easing.Back.Out,!0),e&&(this.block.alpha=0,game.add.tween(this.block).to({alpha:1},200,Phaser.Easing.Linear.None,!0)))},dissapear:function(){var a=game.add.tween(this.boxHolder).to({alpha:0},500,Phaser.Easing.Linear.None,!0);a.onComplete.add(this.destroy,this),game.add.tween(this.boxHolder).to({y:this.boxHolder.y-300},500,Phaser.Easing.Back.In,!0),game.add.tween(this.block).to({alpha:0},200,Phaser.Easing.Linear.None,!0)},destroy:function(){this.holder.destroy()}}),App.Level=Class.extend({init:function(a,b){this.id=a,this.data=b,this.reset()},reset:function(){this.isCompleted=!1,this.isOpen=!1},complete:function(){this.isCompleted=!0}});var game,cmd,data,cookies,fader;App.SlideDialog=Class.extend({init:function(a,b){var c=util.getParam(b,"x",0),d=util.getParam(b,"y",0),e=util.getParam(b,"blockBack",!1),f=util.getParam(b,"doTween",!0);if(this.holder=new Phaser.Group(game,game.world),e&&(this.block=new Phaser.Sprite(game,0,0,"blackBack"),this.block.inputEnabled=!0,this.holder.add(this.block)),this.boxHolder=new Phaser.Group(game,this.holder),this.boxHolder.x=c,this.boxHolder.y=d,this.box=data.addAtlasSprite(a,{parent:this.boxHolder}),f){var g=this.boxHolder.y;this.boxHolder.y=Config.HEIGHT,game.add.tween(this.boxHolder).to({y:g},1e3,Phaser.Easing.Back.Out,!0),e&&(this.block.alpha=0,game.add.tween(this.block).to({alpha:1},500,Phaser.Easing.Linear.None,!0))}},destroy:function(){this.holder.destroy()}}),App.Sounds=Class.extend({init:function(){this.musicChannel=void 0},startMusic:function(){Config.SOUNDS_ENABLED&&(this.musicChannel=game.add.audio("music",1,!0),this.musicChannel.play())},stopMusic:function(){this.musicChannel&&this.musicChannel.pause()},play:function(a,b){var c=1;void 0!=b&&(c=b),Config.SOUNDS_ENABLED&&game.sound.play(a,c)}}),App.Util=Class.extend({init:function(){},getParam:function(a,b,c){return a&&"undefined"!=typeof a[b]?a[b]:c},pulse:function(a,b){void 0==b&&(b=1.2),game.add.tween(a.scale).to({x:b,y:b},1e3,Phaser.Easing.Sinusoidal.InOut).to({x:1,y:1},1e3,Phaser.Easing.Sinusoidal.InOut).loop().start()},wobble:function(a,b){void 0==b&&(b=1);for(var c=game.add.tween(a.scale),d=0;b>d;d++)c=c.to({x:1.2,y:.8},100,Phaser.Easing.Sinusoidal.InOut),c.to({x:1,y:1},100,Phaser.Easing.Sinusoidal.InOut);c.start()},showWithAlpha:function(a,b){var c=util.getParam(b,"delay",0),d=util.getParam(b,"time",500),e=util.getParam(b,"y",0);if(a.alpha=0,game.add.tween(a).to({alpha:1},d,Phaser.Easing.Linear.None,!0,c),e){var f=a.y;a.y+=e,game.add.tween(a).to({y:f},d,Phaser.Easing.Cubic.Out,!0,c)}},showWithScale:function(a,b){var c=util.getParam(b,"delay",0),d=util.getParam(b,"time",500);a.scale.x=a.scale.y=0,game.add.tween(a.scale).to({x:1,y:1},d,Phaser.Easing.Back.Out,!0,c)},formatTime:function(a){var b=Math.floor(a/1e3),c=Math.floor(b/3600),d=Math.floor((b-3600*c)/60),e=b-3600*c-60*d;return 10>c&&(c="0"+c),10>d&&(d="0"+d),10>e&&(e="0"+e),d+":"+e},randomizeArray:function(a){for(var b,c,d=a.length;d>0;)c=Math.floor(Math.random()*d),d--,b=a[d],a[d]=a[c],a[c]=b;return a},randomizeAndCopyArray:function(a){var b=a.slice();return this.randomizeArray(b)},equalArrays:function(a,b){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0},getDist:function(a,b,c,d){var e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}}),App.CreditsView=App.Dialog.extend({init:function(){this._super("creditsBox",{x:320,y:400,blockBack:!0}),this.close=new App.MyButton("closeButton",this.closeClick,this,{x:175,y:-175,center:!0,parentGroup:this.boxHolder,wobble:!0}),this.logoBt=new App.MyButton("postepennoLogo",this.logoClick,this,{x:-87,y:-40,parentGroup:this.boxHolder});var a="Credits",b=game.add.text(-2,-137,a,{font:"60px Arial",fill:"#000000",align:"center"},this.boxHolder);b.anchor.set(.5,.5)},closeClick:function(){this.close.disableClick(),this.dissapear()},logoClick:function(){window.open("http://postepenno.com","_blank")}}),App.DragItem=Class.extend({init:function(a,b,c,d){this.id=a,this.manager=b,this.parent=c;var e=util.getParam(d,"x",0),f=util.getParam(d,"y",0);this.fixed=util.getParam(d,"fixed",!1),this.group=game.add.group(c),this.group.x=e,this.group.y=f,this.setId=data.getRandomSmileySet(),this.findRail(),this.setState("happy")},findRail:function(){for(var a=0;a<this.manager.rails.length;a++){var b=this.manager.rails[a],c=new Phaser.Point(this.getX(),this.getY()),d=b.minDistToPoint(c);if(10>d)return this.rail=b,void this.rail.updateItem(this,this.getX(),this.getY())}},bringToTop:function(){this.parent.bringToTop(this.group)},saveLinks:function(a){this.links=[];for(var b=0;b<a.length;b++){var c=a[b];(c.p1.id===this.id||c.p2.id===this.id)&&this.links.push(c)}},getLinks:function(){return this.links},render:function(){if(this.fixed)this.updateState("fixed");else{for(var a=!1,b=!1,c=0;c<this.links.length;c++){var d=this.links[c];d.getState()===App.DragLink.STATE_NON_INTERSECT?a=!0:d.getState()===App.DragLink.STATE_INTERSECT&&(b=!0)}a?this.updateState(b?"meh":"happy"):b&&this.updateState("sad")}},updateState:function(a){this.state!=a&&(this.group.removeChild(this.sprite),this.sprite=null,this.setState(a))},setState:function(a){this.state=a;var b=void 0;b="fixed"==this.state?"dragItemFixed":data.getSmileyAsset(this.setId,this.state),this.sprite=data.addAtlasSprite(b,{parent:this.group,center:!0})},getX:function(){return this.group.x},getY:function(){return this.group.y},setPos:function(a,b){this.group.x=a,this.group.y=b},select:function(){game.add.tween(this.group.scale).to({x:1.2,y:1.2},200,Phaser.Easing.Quadratic.InOut,!0),this.rail&&this.rail.select()},deselect:function(){game.add.tween(this.group.scale).to({x:1,y:1},200,Phaser.Easing.Quadratic.InOut,!0),this.rail&&this.rail.deselect()}}),App.DragLink=Class.extend({init:function(a,b,c){this.parentGroup=a,this.p1=b,this.p2=c,this.setState(App.DragLink.STATE_NON_INTERSECT),this.g=new Phaser.Graphics(game,0,0),this.parentGroup.add(this.g)},render:function(){this.g.clear(),this.g.lineStyle(4,this.color),this.g.moveTo(this.p1.getX(),this.p1.getY()),this.g.lineTo(this.p2.getX(),this.p2.getY())},setState:function(a){this.state=a,this.color=App.DragLink.getColorByState(this.state)},getState:function(){return this.state}}),App.DragLink.STATE_INTERSECT="StateIntersect",App.DragLink.STATE_NON_INTERSECT="StateNonIntersect",App.DragLink.STATE_UNKNOWN="StateUnknown",App.DragLink.getColorByState=function(a){return a==App.DragLink.STATE_INTERSECT?"0xE84E40":a==App.DragLink.STATE_NON_INTERSECT?"0x2BAF2B":a==App.DragLink.STATE_UNKNOWN?"0xA5A5A5":void 0},App.FPS=Class.extend({init:function(a){this.parentGroup=a,game.time.advancedTiming=!0,this.fpsTxt=new Phaser.Text(game,0,0,"FPS: XXX",{font:"bold 20px Arial",fill:"#FF0000"}),this.parentGroup.add(this.fpsTxt),this.update(),game.time.events.loop(Phaser.Timer.SECOND,this.update,this)},update:function(){this.fpsTxt.setText("FPS: "+game.time.fps)}}),App.Fader=Class.extend({init:function(){},fade:function(a,b){if(this.callback=a,this.scope=b,Config.ANIMATION){this.pic=game.add.sprite(0,0,"fader"),this.pic.alpha=0,this.pic.inputEnabled=!0;var c=game.add.tween(this.pic).to({alpha:.8},300,Phaser.Easing.Linear.None,!0);c.onComplete.addOnce(this.fadeInComplete,this)}else this.callback.call(this.scope)},fadeInComplete:function(){App.Fader.SHOULD_FADE_OUT=!0,this.callback.call(this.scope)},fadeOut:function(){App.Fader.SHOULD_FADE_OUT=!1,this.pic=game.add.sprite(0,0,"fader"),this.pic.inputEnabled=!0;var a=game.add.tween(this.pic).to({alpha:0},300,Phaser.Easing.Linear.None,!0);a.onComplete.addOnce(this.fadeOutComplete,this)},fadeOutComplete:function(){this.pic.destroy()}}),App.Fader.SHOULD_FADE_OUT=!1,App.GameLogic=Class.extend({init:function(){this.railsGroup=new Phaser.Group(game,game.world),this.linksGroup=new Phaser.Group(game,game.world),this.linksAnimGroup=new Phaser.Group(game,game.world),this.itemsGroup=new Phaser.Group(game,game.world),this.offset={x:0,y:0},this.activeItem=null,this.intersectionsFound=void 0,this.parseLevel(data.curLevel.data),this.connectItemsWithLinks(),this.checkAllIntersections(!0),this.renderLinks(),this.renderItems(),this.linksGroup.setAll("alpha",0),this.levelAppear=new App.LevelAppear(this.items,this.links,this.linksAnimGroup,this.appearComplete,this),game.input.onDown.add(this.touchDownHandler,this)},appearComplete:function(){this.linksAnimGroup.destroy(),this.linksGroup.setAll("alpha",1),this.itemsGroup.setAll("scale.x",1),this.itemsGroup.setAll("scale.y",1),this.levelAppear.destroy(),this.levelAppear=null},parseLevel:function(a){this.rails=[],this.items=[],this.links=[];var b,c,d;if(a.rails)for(b=0;b<a.rails.length;b++)c=a.rails[b],d=new App.RailLine(b,this.railsGroup,{x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2}),this.rails.push(d);if(a.circleRails)for(b=0;b<a.circleRails.length;b++)c=a.circleRails[b],d=new App.RailCircle(b,this.railsGroup,{x:c.x,y:c.y,r:c.r}),this.rails.push(d);for(b=0;b<a.items.length;b++){var e=a.items[b],f=new App.DragItem(e.id,this,this.itemsGroup,{x:e.x,y:e.y,fixed:e.fixed});this.items.push(f)}if(a.links)for(b=0;b<a.links.length;b++){var g=a.links[b],h=this.getItemById(g.p1),i=this.getItemById(g.p2),j=new App.DragLink(this.linksGroup,h,i);this.links.push(j)}},connectItemsWithLinks:function(){for(var a=0;a<this.items.length;a++){var b=this.items[a];b.saveLinks(this.links)}},getItemById:function(a){for(var b=0;b<this.items.length;b++){var c=this.items[b];if(c.id===a)return c}return void 0},touchDownHandler:function(a){var b=Math.round(a.x),c=Math.round(a.y),d=this.getUnfixedItemUnderPoint(b,c);d&&(this.levelAppear&&this.appearComplete(),this.offset.x=b-d.getX(),this.offset.y=c-d.getY(),this.activeItem=d,this.activeItem.bringToTop(),this.activeItem.select(),game.input.onUp.add(this.touchUpHandler,this))},touchUpHandler:function(){game.input.onUp.remove(this.touchUpHandler,this),this.activeItem.deselect(),this.activeItem=null,data.levelMoves++,cmd.playerMove.dispatch(),this.intersectionsFound||Config.EDITOR_MODE||(this.clear(),cmd.levelComplete())},clear:function(){game.input.onDown.remove(this.touchDownHandler,this),game.input.onUp.remove(this.touchUpHandler,this),this.activeItem=null},update:function(){this.activeItem&&(this.updateActiveItemPos(),this.checkAllIntersections(!0),this.renderLinks(),this.renderItems())},updateActiveItemPos:function(){var a=game.input.activePointer,b=Math.round(a.position.x)-this.offset.x,c=Math.round(a.position.y)-this.offset.y,d=this.activeItem.rail;if(d)d.updateItem(this.activeItem,b,c);else{var e=this.fitInBounds(b,c);this.activeItem.setPos(e.x,e.y)}},fitInBounds:function(a,b){var c=Config.ITEM_GFX_RADIUS,d=Config.DRAG_BOUNDS.x,e=Config.DRAG_BOUNDS.y,f=Config.DRAG_BOUNDS.width,g=Config.DRAG_BOUNDS.height;return d+c>a&&(a=d+c),a>d+f-c&&(a=d+f-c),e+c>b&&(b=e+c),b>e+g-c&&(b=e+g-c),{x:a,y:b}},renderItems:function(){for(var a=this.items.length-1;a>=0;a--){var b=this.items[a];b.render()}},renderLinks:function(){for(var a=0;a<this.links.length;a++){var b=this.links[a];b.render()}},getUnfixedItemUnderPoint:function(a,b){for(var c=Config.ITEM_TOUCH_RADIUS,d=void 0,e=0;e<this.items.length;e++){var f=this.items[e];if(!f.fixed){var g=a-f.getX(),h=b-f.getY(),i=Math.sqrt(g*g+h*h);c>=i&&(c=i,d=f)}}return d},checkAllIntersections:function(){this.setLinksState(App.DragLink.STATE_NON_INTERSECT),this.intersectionsFound=!1;for(var a=0;a<this.links.length;a++)for(var b=this.links[a],c=a+1;c<this.links.length;c++){var d=this.links[c];this.linkVsLink(b,d)&&(this.intersectionsFound=!0,b.setState(App.DragLink.STATE_INTERSECT),d.setState(App.DragLink.STATE_INTERSECT))}},setLinksState:function(a){for(var b=this.links.length-1;b>=0;b--){var c=this.links[b];c.setState(a)}},linkVsLink:function(a,b){var c=a.p1.id,d=a.p2.id,e=b.p1.id,f=b.p2.id;if(c==e||c==f||d==e||d==f)return!1;var g=a.p1.getX(),h=a.p2.getX(),i=b.p1.getX(),j=b.p2.getX(),k=a.p1.getY(),l=a.p2.getY(),m=b.p1.getY(),n=b.p2.getY();if(Math.max(g,h)<Math.min(i,j)||Math.max(i,j)<Math.min(g,h))return!1;if(Math.max(k,l)<Math.min(m,n)||Math.max(m,n)<Math.min(k,l))return!1;var o=(j-i)*(k-m)-(n-m)*(g-i),p=(h-g)*(k-m)-(l-k)*(g-i),q=(n-m)*(h-g)-(j-i)*(l-k);return Math.abs(q)<.001?!1:(o/=q,p/=q,o>0&&1>o&&p>0&&1>p?!0:!1)}}),App.LevelAppear=Class.extend({init:function(a,b,c,d,e){this.items=a,this.links=b,this.linksGroup=c,this.callback=d,this.callbackContext=e,this.totalTime=1e3+20*this.items.length;var f,g=(this.totalTime-App.LevelAppear.ITEM_TIME)/this.items.length,h=(this.totalTime-App.LevelAppear.LINK_TIME)/this.links.length;for(f=0;f<this.items.length;f++)this.tweenItem(f*g,this.items[f]);for(this.linkAnims=[],f=0;f<this.links.length;f++){var i=new App.LinkAnim(f*h,c,this.links[f]);this.linkAnims.push(i)}this.timer=game.time.create(!0),this.timer.add(this.totalTime,this.callback,this.callbackContext),this.timer.start()},tweenItem:function(a,b){b.group.scale.x=b.group.scale.y=0,game.add.tween(b.group.scale).delay(a).to({x:1,y:1},App.LevelAppear.ITEM_TIME,Phaser.Easing.Back.Out,!0)},destroy:function(){this.timer.stop(!0)}}),App.LevelAppear.ITEM_TIME=800,App.LevelAppear.LINK_TIME=800,App.LevelCompleteView=App.SlideDialog.extend({init:function(){this._super("levelCompleteBox",{x:120,y:570}),this.next=new App.MyButton("nextButton",this.nextClick,this,{x:200,y:120,center:!0,parentGroup:this.boxHolder})},nextClick:function(){cmd.levelNext()}}),App.LevelItem=Class.extend({init:function(a,b,c,d){if(this.level=b,this.parentGroup=a,this.group=game.add.group(this.parentGroup),this.group.x=c,this.group.y=d,b.isOpen){var e,f="#000000";b.isCompleted?(e="levelItemCompleteBack",f="#39541D"):(e="levelItemBack",f="#212A56"),this.bt=new App.MyButton(e,this.click,this,{center:!0,parentGroup:this.group});var g=new Phaser.Text(game,0,0,(this.level.id+1).toString(),{font:"50px Arial",fill:f});g.anchor.set(.5,.5),this.group.add(g)}else{var h=data.addAtlasSprite("levelItemLockedBack",{x:0,y:0});h.anchor.set(.5,.5),this.group.add(h)}},click:function(){fader.fade(this.go,this)},go:function(){cmd.levelStart(this.level.id)}}),App.LevelsGroup=Class.extend({init:function(a,b){this.id=a,this.parentGroup=b,this.group=new Phaser.Group(game,this.parentGroup),this.group.y=this.id*Config.HEIGHT;var c=100,d=100;this.rows=4,this.cols=4,this.boundsRect={x:70,y:120,width:500,height:460};for(var e=this.rows*this.cols,f=(this.boundsRect.width-c)/(this.cols-1),g=(this.boundsRect.height-d)/(this.rows-1),h=this.id*e,i=(this.id+1)*e,j=0,k=h;i>k;k++){var l=data.levels[k];if(l){var m=this.boundsRect.x+c/2+j%this.cols*f,n=this.boundsRect.y+d/2+Math.floor(j/this.cols)*g;new App.LevelItem(this.group,l,m,n)}j++}},drawBounds:function(){this.g=game.add.graphics(0,0,this.group),this.g.clear(),this.g.lineStyle(5,this.color),this.g.drawRect(this.boundsRect.x,this.boundsRect.y,this.boundsRect.width,this.boundsRect.height)}}),App.LinkAnim=Class.extend({init:function(a,b,c){this.delay=a,this.parentGroup=b,this.link=c,this.color=App.DragLink.getColorByState(c.state),this.g=new Phaser.Graphics(game,0,0),this.parentGroup.add(this.g),this.g.clear(),this.g.lineStyle(4,this.color);var d=this.link.p1.getX(),e=this.link.p1.getY(),f=this.link.p2.getX(),g=this.link.p2.getY(),h=f-d,i=g-e,j=Math.floor(Math.sqrt(h*h+i*i));this.g.x=d+h/2,this.g.y=e+i/2,this.g.moveTo(-j/2,0),this.g.lineTo(j/2,0),this.g.rotation=Math.atan2(i,h),this.g.scale.x=0,game.add.tween(this.g.scale).delay(this.delay).to({x:1},App.LevelAppear.LINK_TIME,Phaser.Easing.Cubic.Out,!0)},destroy:function(){this.g.destroy()}}),App.MyButton=Class.extend({init:function(a,b,c,d){this.callback=b,this.callbackContext=c;var e=util.getParam(d,"x",0),f=util.getParam(d,"y",0),g=util.getParam(d,"center",!1),h=util.getParam(d,"parentGroup",game.world),i=util.getParam(d,"atlas",!0);this.wobble=util.getParam(d,"wobble",!1);var j=util.getParam(d,"scale",1);if(i){var k=data.getAtlasKey(a);this.bt=game.add.button(e,f,data.atlasName,this.clickHandler,this,k,k,k,k,h)}else this.bt=game.add.button(e,f,a,this.clickHandler,this,null,null,null,null,h);this.bt.scale.x=this.bt.scale.y=j,this.bt.input.useHandCursor=!0,g&&this.bt.anchor.set(.5,.5)},clickHandler:function(){sounds.play("sndClick"),this.wobble&&util.wobble(this.bt),this.callback.call(this.callbackContext)},scaleHide:function(){game.add.tween(this.bt.scale).to({x:0,y:0},200,Phaser.Easing.Linear.None,!0)},scaleShow:function(){game.add.tween(this.bt.scale).to({x:1,y:1},200,Phaser.Easing.Linear.None,!0)},hide:function(){this.bt.scale.x=this.bt.scale.y=0},show:function(){this.bt.scale.x=this.bt.scale.y=1},disableClick:function(){this.bt.inputEnabled=!1},enableClick:function(){this.bt.inputEnabled=!0},destroy:function(){this.bt.destroy()}}),App.RailCircle=Class.extend({init:function(a,b,c){this.id=a,this.parent=b;var d=util.getParam(c,"x",200),e=util.getParam(c,"y",200);this.radius=util.getParam(c,"r",100),this.group=game.add.group(b),this.group.x=d,this.group.y=e,this.gfx=game.add.graphics(0,0,this.group),this.strokeAlpha=.2,this.render()},render:function(){this.gfx.clear(),this.gfx.lineStyle(3,5592405,this.strokeAlpha),this.gfx.drawCircle(0,0,this.radius)},getX:function(){return this.group.x},getY:function(){return this.group.y},updateItem:function(a,b,c){var d=b-this.getX(),e=c-this.getY(),f=Math.atan2(e,d),g=this.getX()+Math.cos(f)*this.radius,h=this.getY()+Math.sin(f)*this.radius;a.setPos(g,h)},distanceCirclePoint:function(a,b,c,d){var e=d.x-a,f=d.y-b,g=Math.sqrt(e*e+f*f);return Math.abs(g-c)},minDistToPoint:function(a){return this.distanceCirclePoint(this.getX(),this.getY(),this.radius,a)},select:function(){this.strokeAlpha=.8,this.render()},deselect:function(){this.strokeAlpha=.2,this.render()}}),App.RailLine=Class.extend({init:function(a,b,c){this.id=a,this.parent=b;var d=util.getParam(c,"x1",100),e=util.getParam(c,"y1",100),f=util.getParam(c,"x2",200),g=util.getParam(c,"y2",200);
this.p1=new Phaser.Point(d,e),this.p2=new Phaser.Point(f,g),this.group=game.add.group(b),this.gfx=game.add.graphics(0,0,this.group),this.strokeAlpha=.4,this.render()},render:function(){this.gfx.clear(),this.gfx.lineStyle(3,5592405,this.strokeAlpha),this.gfx.moveTo(this.p1.x,this.p1.y),this.gfx.lineTo(this.p2.x,this.p2.y);var a=Phaser.Point.perp(new Phaser.Point(this.p2.x-this.p1.x,this.p2.y-this.p1.y));a=Phaser.Point.normalize(a),a=a.setMagnitude(10),this.gfx.moveTo(this.p1.x,this.p1.y),this.gfx.lineTo(this.p1.x+a.x,this.p1.y+a.y),this.gfx.moveTo(this.p1.x,this.p1.y),this.gfx.lineTo(this.p1.x-a.x,this.p1.y-a.y),this.gfx.moveTo(this.p2.x,this.p2.y),this.gfx.lineTo(this.p2.x+a.x,this.p2.y+a.y),this.gfx.moveTo(this.p2.x,this.p2.y),this.gfx.lineTo(this.p2.x-a.x,this.p2.y-a.y)},updateItem:function(a,b,c){var d=new Phaser.Point(b,c),e=this.projectPointOntoLine(this.p1,this.p2,d);b=e.x,c=e.y;var f=Math.min(this.p1.x,this.p2.x),g=Math.max(this.p1.x,this.p2.x),h=Math.min(this.p1.y,this.p2.y),i=Math.max(this.p1.y,this.p2.y);f>b&&(b=f),b>g&&(b=g),h>c&&(c=h),c>i&&(c=i),a.setPos(b,c)},differenceVector:function(a,b){return new Phaser.Point(b.x-a.x,b.y-a.y)},projectPointOntoLine:function(a,b,c){var d=this.differenceVector(b,a),e=((c.x-a.x)*(b.x-a.x)+(c.y-a.y)*(b.y-a.y))/(d.getMagnitude()*d.getMagnitude()),f=new Phaser.Point(a.x+e*(b.x-a.x),a.y+e*(b.y-a.y));return f},distanceLinePoint:function(a,b,c){var d=this.projectPointOntoLine(a,b,c);return d?this.differenceVector(c,d).getMagnitude():-1},minDistToPoint:function(a){return this.distanceLinePoint(this.p1,this.p2,a)},select:function(){this.strokeAlpha=.8,this.render()},deselect:function(){this.strokeAlpha=.4,this.render()}}),App.SoundIcon=Class.extend({init:function(a){var b=util.getParam(a,"x",0),c=util.getParam(a,"y",0),d=util.getParam(a,"scale",1),e=util.getParam(a,"parentGroup",game.world);this.group=game.add.group(e),this.group.x=b,this.group.y=c,this.group.scale.x=this.group.scale.y=d,this.btOn=new App.MyButton("soundIconOn",this.sndClick,this,{center:!0,parentGroup:this.group}),this.btOff=new App.MyButton("soundIconOff",this.sndClick,this,{center:!0,parentGroup:this.group}),this.updateIcon()},updateIcon:function(){Config.SOUNDS_ENABLED?(this.btOn.show(),this.btOff.hide()):(this.btOn.hide(),this.btOff.show())},hide:function(){this.group.visible=!1},sndClick:function(){Config.SOUNDS_ENABLED=!Config.SOUNDS_ENABLED,cookies.saveSound(),this.updateIcon(),util.wobble(this.group)},disableClick:function(){this.btOn.disableClick(),this.btOff.disableClick()}}),App.Tutorial=Class.extend({init:function(){0==data.curLevel.id&&this.addText("Touch and drag smileys\nto uncross the lines",700,500)},addText:function(a,b,c){var d=game.add.text(Config.WIDTH/2,b,a,{font:"34px Arial",fill:"#000000"});d.align="center",d.anchor.set(.5,0),d.alpha=0,d.y-=10,game.add.tween(d).delay(c).to({alpha:1,y:b},1e3,Phaser.Easing.Quadratic.Out,!0)}}),App.BootState=function(){},App.BootState.prototype={preload:function(){this.load.image("preloadBar","assets/images/preloadBar.png"),this.load.image("preloadBarHolder","assets/images/preloadBarHolder.png"),this.load.image("background","assets/images/background.png"),game.stage.backgroundColor="#EBE7DA"},create:function(){this.game.input.maxPointers=1,this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0,this.game.scale.enterPortrait.add(this.rescale,this),this.game.scale.enterLandscape.add(this.rescale,this),this.game.scale.setScreenSize(!0),Config.TRANSPARENT&&(this.game.world.alpha=.5),this.game.state.start("Preloader")},rescale:function(){var a=this.game;setTimeout(function(){a.scale.refresh()},500)}},App.GameCompleteState=function(){},App.GameCompleteState.prototype={create:function(){this.add.sprite(0,0,"background"),this.dialog=new App.SlideDialog("gameCompleteBox",{x:60,y:60,blockBack:!1}),this.home=new App.MyButton("homeButton",this.exitClick,this,{x:260,y:500,center:!0,parentGroup:this.dialog.boxHolder}),App.Fader.SHOULD_FADE_OUT&&fader.fadeOut()},exitClick:function(){fader.fade(this.gotoMenu,this)},gotoMenu:function(){this.game.state.start("MainMenu")}},App.GameplayState=function(){},App.GameplayState.prototype={create:function(){this.add.sprite(0,0,"cuteBack1.jpg"),this.coreGroup=new Phaser.Group(this.game,this.game.world),this.uiGroup=new Phaser.Group(this.game,this.game.world),data.addAtlasSprite("levelUIBack",{parent:this.uiGroup}),this.home=new App.MyButton("homeButton",this.homeClick,this,{x:590,y:48,center:!0,parentGroup:this.uiGroup,wobble:!0}),this.restart=new App.MyButton("restartButton",this.restartClick,this,{x:490,y:48,center:!0,parentGroup:this.uiGroup,wobble:!0}),this.soundIcon=new App.SoundIcon({x:390,y:48,parentGroup:this.uiGroup}),Config.ENABLE_CHEAT&&(this.cheat=new App.MyButton("cheatButton",this.cheatClick,this,{x:318,y:30,center:!0,parentGroup:this.uiGroup})),Config.EDITOR_MODE&&(this.save=new App.MyButton("saveButton",this.saveClick,this,{x:268,y:67,center:!0,parentGroup:this.uiGroup}),this.shuffle=new App.MyButton("shuffleButton",this.shuffleClick,this,{x:217,y:32,center:!0,parentGroup:this.uiGroup})),this.logic=new App.GameLogic,this.tutorial=new App.Tutorial,this.movesTf=game.add.text(10,35,"Moves: 0",{font:"30px Arial",fill:"#000000"},this.uiGroup),this.updateMovesUI(),cmd.playerMove.add(this.playerMoveHandler,this),Config.SHOW_FPS&&(this.fps=new App.FPS(this.uiGroup)),App.Fader.SHOULD_FADE_OUT&&fader.fadeOut()},playerMoveHandler:function(){this.updateMovesUI()},updateMovesUI:function(){this.movesTf.setText("Moves: "+data.levelMoves)},shuffleClick:function(){for(var a=this.logic.items,b=0;b<a.length;b++){var c=a[b];if(!c.fixed&&!c.rail){var d=Math.floor(Math.random()*Config.WIDTH),e=Math.floor(Math.random()*Config.HEIGHT),f=this.logic.fitInBounds(d,e);c.setPos(f.x,f.y)}}this.logic.checkAllIntersections(),this.logic.renderLinks(),this.logic.renderItems()},saveClick:function(){this.saveLevel()},saveLevel:function(){var a,b=this.logic.items,c=this.logic.links,d=this.logic.rails,e=[];for(a=0;a<b.length;a++){var f=b[a],g={id:f.id,x:Math.round(f.getX()),y:Math.round(f.getY())};f.fixed&&(g.fixed=!0),e.push(g)}var h=[];for(a=0;a<c.length;a++){var i=c[a],j={p1:i.p1.id,p2:i.p2.id};h.push(j)}var k=[],l=[];for(a=0;a<d.length;a++){var m=d[a];m instanceof App.RailLine?k.push({x1:m.p1.x,y1:m.p1.y,x2:m.p2.x,y2:m.p2.y}):m instanceof App.RailCircle&&l.push({x:m.getX(),y:m.getY(),r:m.radius})}var n=JSON.stringify({name:data.curLevel.data.name,items:e,links:h,rails:k,circleRails:l});this.copyToClipboard(n)},copyToClipboard:function(a){window.prompt("Copy to clipboard: Ctrl+C, Enter",a)},showWithTweens:function(){util.showWithAlpha(this.logic.poster,{time:1e3}),util.showWithAlpha(this.logic.question.group,{delay:1e3}),util.showWithAlpha(this.logic.buttons[0].group,{delay:1500,y:-40}),util.showWithAlpha(this.logic.buttons[1].group,{delay:1600,y:-40}),util.showWithAlpha(this.logic.buttons[2].group,{delay:1700,y:-40}),util.showWithAlpha(this.logic.buttons[3].group,{delay:1800,y:-40})},restartClick:function(){cmd.levelStart(data.curLevel.id)},nextClick:function(){cmd.levelNext()},homeClick:function(){fader.fade(this.gotoMainMenu,this)},gotoMainMenu:function(){game.state.start("LevelSelect")},cheatClick:function(){cmd.levelComplete()},levelComplete:function(){this.next=new App.MyButton("nextButton",this.nextClick,this,{x:280,y:560,center:!0,parentGroup:this.uiGroup,wobble:!0}),util.showWithAlpha(this.next.bt)},tweenAlphaButton:function(a,b){a.alpha=0,this.add.tween(a).to({alpha:1},500,Phaser.Easing.Linear.None,!0,b)},update:function(){this.logic.update()}},App.LevelSelectState=function(){},App.LevelSelectState.prototype={create:function(){this.add.sprite(0,0,"cuteBack1.jpg"),this.itemsHolder=game.add.group(game.world);for(var a=0;1>a;a++){new App.LevelsGroup(a,this.itemsHolder)}this.homeBt=new App.MyButton("homeButton",this.homeClick,this,{x:60,y:760,center:!0,wobble:!0}),App.Fader.SHOULD_FADE_OUT&&fader.fadeOut()},scrollUpClick:function(){1==App.LevelSelectState.CURRENT_GROUP_ID?this.scrollUp.scaleHide():2==App.LevelSelectState.CURRENT_GROUP_ID&&this.scrollDown.scaleShow(),App.LevelSelectState.CURRENT_GROUP_ID--,this.scrollUp.disableClick(),this.scrollDown.disableClick();var a=this.game.add.tween(this.itemsHolder);a.to({y:-Config.HEIGHT*App.LevelSelectState.CURRENT_GROUP_ID},500,Phaser.Easing.Quadratic.InOut,!0),a.onComplete.addOnce(this.scrollComplete,this)},scrollDownClick:function(){0==App.LevelSelectState.CURRENT_GROUP_ID?this.scrollUp.scaleShow():1==App.LevelSelectState.CURRENT_GROUP_ID&&this.scrollDown.scaleHide(),App.LevelSelectState.CURRENT_GROUP_ID++,this.scrollUp.disableClick(),this.scrollDown.disableClick();var a=this.game.add.tween(this.itemsHolder);a.to({y:-Config.HEIGHT*App.LevelSelectState.CURRENT_GROUP_ID},500,Phaser.Easing.Quadratic.InOut,!0),a.onComplete.addOnce(this.scrollComplete,this)},scrollComplete:function(){this.scrollUp.enableClick(),this.scrollDown.enableClick()},homeClick:function(){fader.fade(this.gotoMainMenu,this)},gotoMainMenu:function(){this.game.state.start("MainMenu")}},App.LevelSelectState.CURRENT_GROUP_ID=0,App.MainMenuState=function(){},App.MainMenuState.prototype={create:function(){this.add.sprite(0,0,"cuteBack1.jpg"),this.title=data.addAtlasSprite("gameTitle",{x:150,y:30}),this.playBt=new App.MyButton("playButton",this.playClick,this,{x:320,y:700,center:!0,wobble:!0}),this.playFromFile=new App.MyButton("playButton",this.playFromFileClick,this,{x:600,y:790,center:!0,scale:.4}),this.credits=new App.MyButton("creditsButton",this.creditsClick,this,{x:60,y:760,center:!0,wobble:!0});var a="v "+Config.VERSION,b=this.add.text(5,Config.HEIGHT-5,a,{font:"14px Arial",fill:"#000000"});b.anchor.set(0,1),App.Fader.SHOULD_FADE_OUT&&fader.fadeOut()},playFromFileClick:function(){cmd.levelStartFromFile()},playClick:function(){fader.fade(this.startGame,this)},startGame:function(){cmd.gameStart()},deleteProgressClick:function(){new DeleteProgressView(this.game)},creditsClick:function(){new App.CreditsView}},App.PreloaderState=function(){},App.PreloaderState.prototype={preload:function(){this.add.sprite(0,0,"background");var a,b=["background","fader","blackBack","cuteBack1.jpg"],c=["sndClick","sndLevelComplete"];for(a=0;a<b.length;a++){var d=-1==b[a].indexOf(".jpg")?b[a]+".png":b[a];this.load.image(b[a],"assets/images/"+d)}for(a=0;a<c.length;a++){var e=c[a]+".mp3",f=c[a]+".ogg";this.load.audio(c[a],["assets/sounds/"+e,"assets/sounds/"+f])}this.load.atlasJSONHash("atlas","assets/images/atlas.png","assets/images/atlas.json"),Config.LOAD_LEVEL_FROM_FILE&&this.load.json("jsonLevel","assets/data/TestLevel.json"),this.holder=this.game.add.group(),this.add.sprite(120,280,"preloadBarHolder",null,this.holder),this.preloadBar=this.add.sprite(127,287,"preloadBar",null,this.holder),this.progressTxt=this.game.add.text(Config.WIDTH/2,200,"0%",{font:"bold 50px Arial",fill:"#000000"},this.holder),this.progressTxt.anchor.set(.5,0),this.load.setPreloadSprite(this.preloadBar),this.load.onFileComplete.add(this.fileLoaded,this)},fileLoaded:function(a){this.progressTxt.setText(a+"%")},create:function(){if(Config.ANIMATION){var a=this.game.add.tween(this.holder).to({alpha:0,y:this.holder.y+60},500,Phaser.Easing.Linear.None,!0);a.onComplete.addOnce(this.preloaderComplete,this)}else this.preloaderComplete()},preloaderComplete:function(){fader=new App.Fader,cmd=new App.Commands,data=new App.Data,cookies=new App.Cookies,sounds=new App.Sounds,util=new App.Util,this.game.state.start("MainMenu")}};