function Config(){}function startup(){game=new Phaser.Game(Config.WIDTH,Config.HEIGHT,Phaser.CANVAS,"gameArea"),game.state.add("Boot",App.BootState),game.state.add("Preloader",App.PreloaderState),game.state.add("MainMenu",App.MainMenuState),game.state.add("LevelSelect",App.LevelSelectState),game.state.add("Gameplay",App.GameplayState),game.state.add("GameComplete",App.GameCompleteState),game.state.start("Boot")}App.Commands=Class.extend({init:function(){},gameStart:function(){Config.TEST_GAME_COMPLETE?cmd.gameComplete():cmd.levelStart(Config.START_LEVEL)},levelStart:function(a){data.curLevel=data.levels[a],data.levelStartTime=game.time.now,data.pauseTime=0,data.curLevel.moves=0,game.state.start("Gameplay")},levelComplete:function(a){game.state.getCurrentState().levelComplete(),data.curLevel.complete(a),cookies.levelComplete(),sounds.play(a?"sndLevelComplete":"sndWrong")},levelNext:function(){var a=data.curLevel.id,b=data.levels[a+1];b?fader.fade(this.gotoNextLevel,this):cmd.gameComplete()},gotoNextLevel:function(){var a=data.curLevel.id;cmd.levelStart(a+1)},gameComplete:function(){fader.fade(this.doGameComplete,this)},doGameComplete:function(){game.state.start("GameComplete")}}),Config.VERSION="0.92р",Config.WIDTH=800,Config.HEIGHT=600,Config.LANGUAGE="ru",Config.ANIMATION=!0,Config.SOUNDS_ENABLED=!1,Config.TRANSPARENT=!1,Config.START_LEVEL=0,Config.TEST_GAME_COMPLETE=!1,Config.SHOW_FPS=!0,Config.OPEN_ALL_LEVELS=!0,Config.ENABLE_CHEAT=!1,Config.DEBUG_GRID=!1,Config.RELEASE=!0,Config.RELEASE&&(Config.ANIMATION=!0,Config.SOUNDS_ENABLED=!0,Config.TRANSPARENT=!1,Config.START_LEVEL=0,Config.TEST_GAME_COMPLETE=!1,Config.SHOW_FPS=!1,Config.OPEN_ALL_LEVELS=!1,Config.ENABLE_CHEAT=!1),App.Cookies=Class.extend({init:function(){this.gameStorageKey="ussrposters",this.initSound(),this.isNewGame=!0,this.initLevels()},isSupported:function(){var a="test",b=window.sessionStorage;try{return b.setItem(a,"1"),b.removeItem(a),!0}catch(c){return!1}},getStorage:function(a){return localStorage[this.gameStorageKey+"."+a]},setStorage:function(a,b){this.isSupported()&&(localStorage[this.gameStorageKey+"."+a]=b)},initSound:function(){Config.SOUNDS_ENABLED="false"==this.getStorage("soundEnabled")?!1:!0},saveSound:function(){this.setStorage("soundEnabled",Config.SOUNDS_ENABLED)},initLevels:function(){if(void 0!=this.getStorage("levels"))for(var a=0;a<data.levels.length;a++){var b=data.levels[a];"true"==this.getStorage("levels."+a+".isCompleted")&&(b.isOpen=!0,b.isCompleted=!0,this.isNewGame=!1)}this.updateOpenLevels()},updateOpenLevels:function(){var a,b;if(Config.OPEN_ALL_LEVELS)for(a=0;a<data.levels.length;a++)b=data.levels[a],b.isOpen=!0;else for(a=0;a<data.levels.length;a++)if(b=data.levels[a],!b.isCompleted){b.isOpen=!0;break}},levelComplete:function(){this.setStorage("levels","true");var a=data.curLevel.id;this.setStorage("levels."+a+".isCompleted","true"),this.isNewGame=!1,this.updateOpenLevels()},clear:function(){localStorage.clear(),this.isNewGame=!0,this.uncompleteLevels(),this.updateOpenLevels()},uncompleteLevels:function(){for(var a=0;a<data.levels.length;a++){var b=data.levels[a];b.reset()}}}),App.Data=Class.extend({init:function(){this.texts=JSON.parse(game.cache.getText("textData")),this.curLevel=null,this.levelStartTime=0,this.levelStartTime=0,this.pauseTime=0,this.pausedByUser=!1,this.initLevels(),this.atlasName="atlas"},text:function(a){return data.texts[Config.LANGUAGE][a]},getAtlasKey:function(a){return this.atlasName+"/"+a+"_0000"},addAtlasSprite:function(a,b){var c=util.getParam(b,"x",0),d=util.getParam(b,"y",0),e=util.getParam(b,"center",!1),f=util.getParam(b,"parent",game.world),g=game.add.sprite(c,d,this.atlasName,this.getAtlasKey(a),f);return e&&g.anchor.set(.5,.5),g},createPosterSprite:function(a){return new Phaser.Sprite(game,0,0,"paintings","paintings/"+a+"_0000")},addPainting:function(a,b){this.paintings.push({name:a,info:b,atlasName:"paintings"})},addPainting2:function(a,b){this.paintings.push({name:a,desc:b,atlasName:"paintings2"})},getPaintingDesc:function(){var a=this.getPaintingByName(this.curLevel.data.painting);return a.desc[Config.LANGUAGE]},getPaintingByName:function(a){var b,c;for(b=0;b<this.paintings.length;b++)if(c=this.paintings[b],c.name==a)return c;return null},initLevels:function(){this.POSTER1="picPoster1",this.KOSTI="picKosti",this.NATO="picNato",this.SIGA="picSiga",this.GOLUB="picGolub",this.PILA="picPila",this.STALIN="picStalin",this.KOLHOZ="picKolhoz",this.NEWYEAR="picNewYear",this.HORSES="picHorses",this.FISH="picFish",this.HAIR="picHair",this.BUFER="picBufer",this.WORKPLACE="picWorkplace",this.TREPALO="picTrepalo",this.FOOT="picFoot",this.ROOF="picRoof",this.KRUK="picKruk",this.ELECTRICITY="picElectricity",this.TUTORIAL="picTutorial",this.RUMKI="picRumki",this.BRAK="picBrak",this.JUICE="picJuice",this.DVESTI="picDvesti",this.BOY="picBoy",this.BEER="picBeer",this.PELMENI="picPelmeni",this.ICE="picIce",this.SPUTNIK="picSputnik",this.BOMBA="picBomba",this.levels=[],this.addLevel({poster:this.POSTER1,question:"Что за рисунок у мужика на майке?",answers:["Герб СССР","КПСС","Ленин","Гантели"],sticker:{x:217,y:277,scale:1}}),this.addLevel({poster:this.STALIN,question:"Кто это?",answers:["Сталин","Ленин","Николай II","Путин"],sticker:{x:167,y:96,scale:1}}),this.addLevel({poster:this.FISH,question:"Не ходи...",answers:["По рыбе","В сапогах","По доске","Лунной походкой"],sticker:{x:302,y:184,scale:1.24}}),this.addLevel({poster:this.BOY,question:"Что в руке?",answers:["Флажок","Граната","Ничего","Солдатик"],sticker:{x:216,y:180,scale:1}}),this.addLevel({poster:this.SPUTNIK,question:"Пускает радугу",answers:["Спутник","Колбаса","Единорог","Призма"],sticker:{x:270,y:115,scale:1}}),this.addLevel({poster:this.PELMENI,question:"Рядом с пельмешками",answers:["Уксус","Горчица","Водка","Котэ"],sticker:{x:108,y:410,scale:1}}),this.addLevel({poster:this.BEER,question:"Выгонит вон ханжу и...",answers:["Самогон","Айфон","Капиталистов","Жену"],sticker:{x:298,y:505,scale:1.15}}),this.addLevel({poster:this.DVESTI,question:"Что в руке?",answers:["Двести рублей","Серп","Морковка","Рюмка"],sticker:{x:300,y:66,scale:1}}),this.addLevel({poster:this.JUICE,question:"Новая этикетка",answers:["Сок","Тархун","Самогон","Пивасик"],sticker:{x:221,y:407,scale:1.12}}),this.addLevel({poster:this.BRAK,question:"Что за стикером?",answers:["Брак","Жесть","Отрыв","Спирт"],sticker:{x:87,y:345,scale:1}}),this.addLevel({poster:this.RUMKI,question:"Между бокалами",answers:["Череп","Селедочка","Огурчики","Пельмешки"],sticker:{x:177,y:312,scale:1}}),this.addLevel({poster:this.TUTORIAL,question:"Куда смотрит пострадавший?",answers:["На инструкцию","На палец в беде","На зрителя","На ноги"],sticker:{x:207,y:201,scale:1}}),this.addLevel({poster:this.ELECTRICITY,question:"Инструмент",answers:["Топор","Бензопила","Мачете","Световой меч"],sticker:{x:311,y:129,scale:.74}}),this.addLevel({poster:this.KRUK,question:"Висит на цепи",answers:["Крюк","Ведро","Лосось","Дискошар"],sticker:{x:288,y:308,scale:.72}}),this.addLevel({poster:this.ROOF,question:"Что-то летит рядом с мужиком",answers:["Молоток","Чайка","Бинокль","Банка краски"],sticker:{x:337,y:310,scale:.75}}),this.addLevel({poster:this.ICE,question:"Что охлаждается?",answers:["Масло","Антифриз","Мороженое","Пингвин"],sticker:{x:133,y:373,scale:1}}),this.addLevel({poster:this.FOOT,question:"Что в руке?",answers:["Ничего","Сладкая вата","Отвертка","Мохито"],sticker:{x:194,y:192,scale:.68}}),this.addLevel({poster:this.TREPALO,question:"Мужик на плакате",answers:["Усатый","Бородатый","Лысый","Счастливый"],sticker:{x:310,y:207,scale:1}}),this.addLevel({poster:this.WORKPLACE,question:"Что за стикером?",answers:["Гаечный ключ","Аптечка","Тиски","Кровь, кишки"],sticker:{x:199,y:381,scale:.82}}),this.addLevel({poster:this.HAIR,question:"Рекомендация",answers:["Прячь волосы","Пой RAMMSTEIN","Завивай кудри","Иди против системы"],sticker:{x:239,y:128,scale:1.58}}),this.addLevel({poster:this.KOSTI,question:"Что в руке?",answers:["Кости","Монетка","Кастет","Зажигалка"],sticker:{x:220,y:80,scale:.8}}),this.addLevel({poster:this.NATO,question:"НА...О",answers:["Бомба","Голубь","Ружье","Кирпич"],sticker:{x:251,y:103,scale:1.15}}),this.addLevel({poster:this.SIGA,question:"Что за стикером?",answers:["Сигарета","Трубка","Зажигалка","Порох"],sticker:{x:215,y:207,scale:1.11}}),this.addLevel({poster:this.GOLUB,question:"Что написано на плакате?",answers:["Я голубь","Демократия","Нефть есть?","А если найду?"],sticker:{x:174,y:392,scale:2}}),this.addLevel({poster:this.PILA,question:"Что делает Великобритания?",answers:["Пилит стул","Держит факел","Точит нож","Держит гранату"],sticker:{x:209,y:443,scale:1}}),this.addLevel({poster:this.KOLHOZ,question:"Куда?",answers:["К нам в колхоз!","В жопу!","Бухать!","К нам в стартап!"],sticker:{x:314,y:478,scale:1.54}}),this.addLevel({poster:this.NEWYEAR,question:"Какой год наступил?",answers:["1939","1917","1991","2015"],sticker:{x:285,y:310,scale:1}}),this.addLevel({poster:this.HORSES,question:"Что за стикером?",answers:["Лошадки","Трактор","Стог сена","Куча навоза"],sticker:{x:290,y:461,scale:.8}}),this.addLevel({poster:this.BOMBA,question:"Цель",answers:["Планета","СССР","Унитаз","Человек"],sticker:{x:208,y:534,scale:.69}}),this.addLevel({poster:this.BUFER,question:"Выронил от неожиданности",answers:["Фонарь","Айпад","Водка","Гаечный ключ"],sticker:{x:385,y:441,scale:.69}})},addLevel:function(a){var b=this.levels.length,c=new App.Level(b,a);this.levels.push(c)},getLevelTime:function(){return Math.round(game.time.elapsedSince(this.levelStartTime)-data.pauseTime)},getCorrectAnswers:function(){for(var a=0,b=0;b<this.levels.length;b++){var c=this.levels[b];c.isCorrect&&a++}return a}}),App.Dialog=Class.extend({init:function(a,b){var c=util.getParam(b,"x",0),d=util.getParam(b,"y",0),e=util.getParam(b,"blockBack",!1),f=util.getParam(b,"doTween",!0);if(this.holder=new Phaser.Group(game,game.world),e&&(this.block=new Phaser.Sprite(game,0,0,"blackBack"),this.block.inputEnabled=!0,this.holder.add(this.block)),this.boxHolder=new Phaser.Group(game,this.holder),this.boxHolder.x=c,this.boxHolder.y=d,this.box=data.addAtlasSprite(a,{parent:this.boxHolder}),f){var g=this.boxHolder.y;this.boxHolder.y=Config.HEIGHT,game.add.tween(this.boxHolder).to({y:g},1e3,Phaser.Easing.Back.Out,!0),e&&(this.block.alpha=0,game.add.tween(this.block).to({alpha:1},500,Phaser.Easing.Linear.None,!0))}},destroy:function(){this.holder.destroy()}}),App.Level=Class.extend({init:function(a,b){this.id=a,this.data=b,this.isCorrect=!1,this.reset()},reset:function(){this.isCompleted=!1,this.isOpen=!1},complete:function(a){this.isCompleted=!0,this.isCorrect=a},getTitle:function(){return this.data.name}});var game,cmd,data,cookies,fader,sounds,util;App.Sounds=Class.extend({init:function(){this.musicChannel=void 0},startMusic:function(){Config.SOUNDS_ENABLED&&(this.musicChannel=game.add.audio("music",1,!0),this.musicChannel.play())},stopMusic:function(){this.musicChannel&&this.musicChannel.pause()},play:function(a,b){var c=1;void 0!=b&&(c=b),Config.SOUNDS_ENABLED&&game.sound.play(a,c)}}),App.Util=Class.extend({init:function(){},getParam:function(a,b,c){return a&&"undefined"!=typeof a[b]?a[b]:c},pulse:function(a,b){void 0==b&&(b=1.2),game.add.tween(a.scale).to({x:b,y:b},1e3,Phaser.Easing.Sinusoidal.InOut).to({x:1,y:1},1e3,Phaser.Easing.Sinusoidal.InOut).loop().start()},wobble:function(a,b){void 0==b&&(b=1);for(var c=game.add.tween(a.scale),d=0;b>d;d++)c=c.to({x:1.2,y:.8},100,Phaser.Easing.Sinusoidal.InOut),c.to({x:1,y:1},100,Phaser.Easing.Sinusoidal.InOut);c.start()},showWithAlpha:function(a,b){var c=util.getParam(b,"delay",0),d=util.getParam(b,"time",500),e=util.getParam(b,"y",0);if(a.alpha=0,game.add.tween(a).to({alpha:1},d,Phaser.Easing.Linear.None,!0,c),e){var f=a.y;a.y+=e,game.add.tween(a).to({y:f},d,Phaser.Easing.Cubic.Out,!0,c)}},showWithScale:function(a,b){var c=util.getParam(b,"delay",0),d=util.getParam(b,"time",500);a.scale.x=a.scale.y=0,game.add.tween(a.scale).to({x:1,y:1},d,Phaser.Easing.Back.Out,!0,c)},formatTime:function(a){var b=Math.floor(a/1e3),c=Math.floor(b/3600),d=Math.floor((b-3600*c)/60),e=b-3600*c-60*d;return 10>c&&(c="0"+c),10>d&&(d="0"+d),10>e&&(e="0"+e),d+":"+e},randomizeArray:function(a){for(var b,c,d=a.length;d>0;)c=Math.floor(Math.random()*d),d--,b=a[d],a[d]=a[c],a[c]=b;return a},randomizeAndCopyArray:function(a){var b=a.slice();return this.randomizeArray(b)},equalArrays:function(a,b){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0},getDist:function(a,b,c,d){var e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}}),App.AnswerButton=Class.extend({init:function(a,b){this.manager=a;var c=util.getParam(b,"x",0),d=util.getParam(b,"y",0),e=util.getParam(b,"scale",1),f=util.getParam(b,"parentGroup",game.world);this.text=util.getParam(b,"text","ОТВЕД"),this.group=game.add.group(f),this.group.x=c,this.group.y=d,this.group.scale.x=this.group.scale.y=e,this.bt=new App.MyButton("answerBox",this.click,this,{center:!0,parentGroup:this.group}),this.tf=game.add.text(-100,0,this.text,{font:"22px Russo One",fill:"#000000"},this.group),this.tf.anchor.set(0,.5)},hide:function(){this.group.visible=!1},disableClick:function(){this.bt&&this.bt.disableClick()},click:function(){util.wobble(this.group),this.bt.destroy(),this.bt=null,this.sprite=data.addAtlasSprite("answerBoxSelected",{center:!0,parent:this.group}),this.group.sendToBack(this.sprite),this.manager.answerSelected(this)},setCorrect:function(){this.sprite&&this.sprite.destroy(),this.bt&&this.bt.destroy(),this.sprite=data.addAtlasSprite("answerBoxCorrect",{center:!0,parent:this.group}),this.group.sendToBack(this.sprite)},setSelectedCorrect:function(){this.sprite&&this.sprite.destroy(),this.bt&&this.bt.destroy(),this.sprite=data.addAtlasSprite("answerBoxCorrectSelected",{center:!0,parent:this.group}),this.group.sendToBack(this.sprite)}}),App.CreditsView=App.Dialog.extend({init:function(){this._super("creditsBox",{x:200,y:100,blockBack:!0}),this.closeBt=new App.MyButton("closeButton",this.closeClick,this,{x:375,y:25,center:!0,parentGroup:this.boxHolder}),this.logoBt=new App.MyButton("postepennoLogo",this.logoClick,this,{x:115,y:160,parentGroup:this.boxHolder});var a=data.text("credits"),b=game.add.text(200,60,a,{font:"60px Arial",fill:"#000000",align:"center"},this.boxHolder);b.anchor.set(.5,.5)},closeClick:function(){this.destroy()},logoClick:function(){window.open("http://postepenno.com","_blank")}}),App.Fader=Class.extend({init:function(a){this.game=a},fade:function(a,b){if(this.callback=a,this.scope=b,Config.ANIMATION){this.pic=game.add.sprite(0,0,"fader"),this.pic.alpha=0,this.pic.inputEnabled=!0;var c=game.add.tween(this.pic).to({alpha:.8},300,Phaser.Easing.Linear.None,!0);c.onComplete.addOnce(this.fadeInComplete,this)}else this.callback.call(this.scope)},fadeInComplete:function(){App.Fader.SHOULD_FADE_OUT=!0,this.callback.call(this.scope)},fadeOut:function(){App.Fader.SHOULD_FADE_OUT=!1,this.pic=game.add.sprite(0,0,"fader"),this.pic.inputEnabled=!0;var a=game.add.tween(this.pic).to({alpha:0},300,Phaser.Easing.Linear.None,!0);a.onComplete.addOnce(this.fadeOutComplete,this)},fadeOutComplete:function(){this.pic.destroy()}}),App.Fader.SHOULD_FADE_OUT=!1,App.Gallery=Class.extend({init:function(a){this.group=game.add.group(a),this.grid=new App.Grid(this.group,640,640,5,5),this.bornModes=[],this.addBornMode({useScale:!0,useRotation:!1,startFrom:"center"}),this.addBornMode({useScale:!0,useRotation:!0,startFrom:"topLeft"}),this.addBornMode({useScale:!0,useRotation:!1,startFrom:"topLeft"}),this.startRound()},addBornMode:function(a){this.bornModes.push(new App.BornMode(a))},startRound:function(){var a=Math.floor(Math.random()*this.bornModes.length);this.bornMode=this.bornModes[a];var b=Math.floor(Math.random()*data.paintings.length);this.sourceSprite=data.createPaintingSprite(data.paintings[b].name),this.createTiles(),this.showTiles(),game.time.events.add(this.bornMode.showTime,this.endRound,this)},createTiles:function(){this.tiles=[];for(var a=0;a<this.grid.rows;a++)for(var b=0;b<this.grid.cols;b++){var c=a*this.grid.cols+b,d=new App.PicTileGallery(this,c,this.group,this.sourceSprite,a,b,this.grid.cellWidth,this.grid.cellHeight);this.tiles.push(d)}},showTiles:function(){for(var a=0;a<this.tiles.length;a++){var b=this.tiles[a];b.born(this.bornMode)}},endRound:function(){this.hideTiles(),game.time.events.add(3*Phaser.Timer.SECOND,this.roundComplete,this)},hideTiles:function(){for(var a=0;a<this.tiles.length;a++){var b=this.tiles[a],c=100*a;b.dieWithScale(c)}},destroyTiles:function(){for(var a=0;a<this.tiles.length;a++){var b=this.tiles[a];b.destroy()}},roundComplete:function(){this.destroyTiles(),this.startRound()}}),App.BornMode=Class.extend({init:function(a){this.useScale=!0,this.useRotation=!0,this.startFrom="topLeft",a&&(void 0!=a.useScale&&(this.useScale=a.useScale),void 0!=a.useRotation&&(this.useRotation=a.useRotation),void 0!=a.startFrom&&(this.startFrom=a.startFrom)),this.showTime=3e3,"topLeft"==this.startFrom?this.showTime=5e3:"center"==this.startFrom&&(this.showTime=4e3)},getDelay:function(a){return"topLeft"==this.startFrom?100*(5*a.row+a.col):"center"==this.startFrom?300*(Math.abs(2-a.row)+Math.abs(2-a.col)):void 0}}),App.GameLogic=Class.extend({init:function(a,b){this.uiGroup=b,this.group=game.add.group(a),this.group.x=0,this.group.y=0;var c=data.curLevel.data,d=c.poster,e=c.question,f=c.answers,g=c.sticker;this.correctAnswer=f[0];var h=util.randomizeAndCopyArray(f);this.poster=data.createPosterSprite(d),this.group.add(this.poster),this.isTweening=!1,this.question=new App.PosterQuestion(b,e);var i=[175,175,175,175],j=[150,220,290,360];this.buttons=[];for(var k=0;4>k;k++)this.addAnswerButton({x:i[k],y:j[k],text:h[k],parentGroup:this.uiGroup});this.addLevelNum(),this.sticker=new App.Sticker(this,{x:g.x,y:g.y,scale:g.scale,parent:this.group}),this.playerBt=void 0},addLevelNum:function(){var a="Плакат "+(data.curLevel.id+1)+"/"+data.levels.length;this.levelNumTf=game.add.text(175,500,a,{font:"22px Russo One",fill:"#ffffff",align:"center"},this.uiGroup),this.levelNumTf.anchor.set(.5,.5)},addAnswerButton:function(a){this.buttons.push(new App.AnswerButton(this,a))},answerSelected:function(a){for(var b=0;b<this.buttons.length;b++){var c=this.buttons[b];c.disableClick()}this.playerBt=a,Config.ANIMATION?this.sticker.hideWithTween():(this.sticker.hide(),this.stickerDissapeared())},stickerDissapeared:function(){var a=!1;if(this.playerBt.text===this.correctAnswer)this.playerBt.setSelectedCorrect(),util.wobble(this.playerBt.group),a=!0;else{var b=this.getButtonByAnswer(this.correctAnswer);b.setCorrect(),util.wobble(b.group)}cmd.levelComplete(a)},getButtonByAnswer:function(a){for(var b=0;b<this.buttons.length;b++){var c=this.buttons[b];if(c.text===a)return c}return null}}),App.GameTitle=Class.extend({init:function(a,b){this.group=game.add.group(),this.group.x=a,this.group.y=b,this.defaultY=b,data.addAtlasSprite("gameTitle",{x:0,y:0,center:!0,parent:this.group}),this.time=0},update:function(){this.time+=.05,this.group.y=this.defaultY+10*Math.sin(this.time)}}),App.Grid=Class.extend({init:function(a,b,c,d,e){this.rows=d,this.cols=e,this.width=b,this.height=c,this.group=game.add.group(a),this.cellWidth=Math.round(this.width/this.cols),this.cellHeight=Math.round(this.height/this.rows);var f,g;for(this.cells=[],f=0;d>f;f++)for(g=0;e>g;g++){var h=f*e+g,i=new App.GridCell(this,this.group,h,f,g);this.cells.push(i)}Config.DEBUG_GRID&&this.drawCells()},drawCells:function(){for(this.g=new Phaser.Graphics(game,0,0),this.group.add(this.g),this.g.clear(),this.g.lineStyle(2,7829367),i=0;i<=this.cols;i++)this.g.moveTo(i*this.cellWidth,0),this.g.lineTo(i*this.cellWidth,this.height);for(i=0;i<=this.rows;i++)this.g.moveTo(0,i*this.cellHeight),this.g.lineTo(this.width,i*this.cellHeight)}}),App.GridCell=Class.extend({init:function(a,b,c,d,e){this.id=c,this.grid=a,this.row=d,this.col=e,this.x=e*a.cellWidth,this.y=d*a.cellHeight,Config.DEBUG_GRID&&game.add.text(this.x+5,this.y+5,c.toString(),{font:"12px Arial",fill:"#000000"},b)}}),App.LanguageButton=Class.extend({init:function(a){var b=util.getParam(a,"x",0),c=util.getParam(a,"y",0),d=util.getParam(a,"scale",1),e=util.getParam(a,"parentGroup",game.world);this.group=game.add.group(e),this.group.x=b,this.group.y=c,this.group.scale.x=this.group.scale.y=d,this.english=new App.MyButton("flagEn",this.click,this,{center:!0,parentGroup:this.group}),this.russian=new App.MyButton("flagRu",this.click,this,{center:!0,parentGroup:this.group}),this.updateIcon()},updateIcon:function(){this.english.hide(),this.russian.hide(),"en"==Config.LANGUAGE?this.english.show():"ru"==Config.LANGUAGE&&this.russian.show()},click:function(){util.wobble(this.group),"en"==Config.LANGUAGE?Config.LANGUAGE="ru":"ru"==Config.LANGUAGE&&(Config.LANGUAGE="en"),this.updateIcon()}}),App.LevelItem=Class.extend({init:function(a,b,c,d,e){if(this.game=a,this.level=c,this.parentGroup=b,this.group=new Phaser.Group(this.game,this.parentGroup),this.group.x=d,this.group.y=e,c.isOpen){var f,g=0;c.isCompleted?(f="levelItemCompleteBack",g=3757085):(f="levelItemBack",g=16777215),this.bt=new App.MyButton(f,this.click,this,{center:!0,parentGroup:this.group});var h=this.game.add.bitmapText(0,0,"eras",(this.level.id+1).toString(),50,this.group);if(h.x=.5*-h.textWidth,h.y=.3*-h.textHeight,h.tint=g,c.isCompleted){var i=0;void 0!=c.bestMoves&&(i=c.bestMoves);var j=this.game.add.bitmapText(0,0,"eras",i.toString(),18,this.group);j.x=.5*-j.textWidth,j.y=.5*-j.textHeight+30,j.tint=2236962}}else{var k=data.addAtlasSprite("levelItemLockedBack",{x:0,y:0,parent:this.group});k.anchor.set(.5,.5)}},click:function(){util.wobble(this.group),fader.fade(this.go,this)},go:function(){cmd.levelStart(this.level.id)}}),App.LevelsGroup=Class.extend({init:function(a,b,c){this.game=a,this.id=b,this.parentGroup=c,this.group=new Phaser.Group(this.game,this.parentGroup),this.group.y=this.id*Config.HEIGHT;var d=80,e=85;this.rows=4,this.cols=4,this.boundsRect={x:95,y:105,width:450,height:440};for(var f=this.rows*this.cols,g=(this.boundsRect.width-d)/(this.cols-1),h=(this.boundsRect.height-e)/(this.rows-1),i=this.id*f,j=(this.id+1)*f,k=0,l=i;j>l;l++){var m=data.levels[l];if(m){var n=this.boundsRect.x+d/2+k%this.cols*g,o=this.boundsRect.y+e/2+Math.floor(k/this.cols)*h;new App.LevelItem(this.game,this.group,m,n,o)}k++}},drawBounds:function(){this.g=game.add.graphics(0,0,this.group),this.g.clear(),this.g.lineStyle(5,this.color),this.g.drawRect(this.boundsRect.x,this.boundsRect.y,this.boundsRect.width,this.boundsRect.height)}}),App.MyButton=Class.extend({init:function(a,b,c,d){this.callback=b,this.callbackContext=c;var e=util.getParam(d,"x",0),f=util.getParam(d,"y",0),g=util.getParam(d,"center",!1),h=util.getParam(d,"parentGroup",game.world),i=util.getParam(d,"atlas",!0);if(this.wobble=util.getParam(d,"wobble",!1),i){var j=data.getAtlasKey(a);this.bt=game.add.button(e,f,data.atlasName,this.clickHandler,this,j,j,j,j,h)}else this.bt=game.add.button(e,f,a,this.clickHandler,this,null,null,null,null,h);this.bt.input.useHandCursor=!0,g&&this.bt.anchor.set(.5,.5)},clickHandler:function(){sounds.play("sndClick"),this.wobble&&util.wobble(this.bt),this.callback.call(this.callbackContext)},scaleHide:function(){game.add.tween(this.bt.scale).to({x:0,y:0},200,Phaser.Easing.Linear.None,!0)},scaleShow:function(){game.add.tween(this.bt.scale).to({x:1,y:1},200,Phaser.Easing.Linear.None,!0)},hide:function(){this.bt.scale.x=this.bt.scale.y=0},show:function(){this.bt.scale.x=this.bt.scale.y=1},disableClick:function(){this.bt.inputEnabled=!1},enableClick:function(){this.bt.inputEnabled=!0},destroy:function(){this.bt.destroy()}}),App.PicTile=Class.extend({init:function(a,b,c,d,e,f,g,h){this.manager=a,this.id=b,this.parent=c,this.row=e,this.col=f,this.width=g,this.height=h;var i=f*g,j=e*h;this.group=game.add.group(c);var k=game.make.bitmapData(this.width,this.height),l=i,m=j,n=new Phaser.Rectangle(l,m,this.width,this.height);k.copyPixels(d,n,0,0),this.bmdHolder=new Phaser.Image(game,0,0,k),this.bmdHolder.anchor.set(.5,.5),this.bmdHolder.x=this.width/2,this.bmdHolder.y=this.height/2,this.group.add(this.bmdHolder),this.setXY(i,j)},isPointInside:function(a,b){var c=a>=this.group.x&&a<=this.group.x+this.width,d=b>=this.group.y&&b<=this.group.y+this.height;return c&&d},getX:function(){return this.group.x},getY:function(){return this.group.y},setXY:function(a,b){this.group.x=a,this.group.y=b},setX:function(a){this.group.x=a},setY:function(a){this.group.y=a},setRowCol:function(a,b){this.row=a,this.col=b,this.setXY(b*this.width,a*this.height)},toTop:function(){this.parent.bringToTop(this.group)},destroy:function(){this.group.destroy()}}),App.PicTileGallery=App.PicTile.extend({init:function(a,b,c,d,e,f,g,h){this._super(a,b,c,d,e,f,g,h)},bornWithScale:function(a){this.bmdHolder.scale.x=this.bmdHolder.scale.y=0,game.add.tween(this.bmdHolder.scale).to({x:1,y:1},500,Phaser.Easing.Back.Out,!0,a)},dieWithScale:function(a){game.add.tween(this.bmdHolder.scale).to({x:0,y:0},500,Phaser.Easing.Back.In,!0,a)},born:function(a){var b=a.getDelay(this);if(a.useScale&&(this.bmdHolder.scale.x=this.bmdHolder.scale.y=0,game.add.tween(this.bmdHolder.scale).to({x:1,y:1},500,Phaser.Easing.Back.Out,!0,b)),a.useRotation){this.bmdHolder.angle=90;var c=0;game.add.tween(this.bmdHolder).to({angle:c},500,Phaser.Easing.Linear.None,!0,b)}},bornWithScaleRotation:function(a){this.bmdHolder.scale.x=this.bmdHolder.scale.y=0,this.bmdHolder.angle=90;var b=0;game.add.tween(this.bmdHolder.scale).to({x:1,y:1},500,Phaser.Easing.Back.Out,!0,a),game.add.tween(this.bmdHolder).to({angle:b},500,Phaser.Easing.Linear.None,!0,a)},dieWithScaleRotation:function(a){game.add.tween(this.bmdHolder.scale).to({x:0,y:0},500,Phaser.Easing.Back.In,!0,a),game.add.tween(this.bmdHolder).to({angle:90},500,Phaser.Easing.Linear.None,!0,a)}}),App.PosterQuestion=Class.extend({init:function(a,b){this.group=game.add.group(a),this.group.x=175,this.group.y=50,data.addAtlasSprite("questionBack",{center:!0,parent:this.group}),this.questionTf=game.add.text(0,0,b,{font:"22px Russo One",fill:"#ffffff",align:"center"},this.group),this.questionTf.wordWrap=!0,this.questionTf.wordWrapWidth=280,this.questionTf.anchor.set(.5,.5)}}),App.SoundIcon=Class.extend({init:function(a){var b=util.getParam(a,"x",0),c=util.getParam(a,"y",0),d=util.getParam(a,"scale",1),e=util.getParam(a,"parentGroup",game.world);this.group=game.add.group(e),this.group.x=b,this.group.y=c,this.group.scale.x=this.group.scale.y=d,this.btOn=new App.MyButton("soundIconOn",this.sndClick,this,{center:!0,parentGroup:this.group}),this.btOff=new App.MyButton("soundIconOff",this.sndClick,this,{center:!0,parentGroup:this.group}),this.updateIcon()},updateIcon:function(){Config.SOUNDS_ENABLED?(this.btOn.show(),this.btOff.hide()):(this.btOn.hide(),this.btOff.show())},hide:function(){this.group.visible=!1},sndClick:function(){Config.SOUNDS_ENABLED=!Config.SOUNDS_ENABLED,Config.SOUNDS_ENABLED?sounds.startMusic():sounds.stopMusic(),cookies.saveSound(),this.updateIcon(),util.wobble(this.group)},disableClick:function(){this.btOn.disableClick(),this.btOff.disableClick()}}),App.Sticker=Class.extend({init:function(a,b){this.manager=a;var c=util.getParam(b,"x",0),d=util.getParam(b,"y",0),e=util.getParam(b,"scale",1),f=util.getParam(b,"parent",game.world);this.group=game.add.group(f),this.group.x=c,this.group.y=d,this.group.scale.x=this.group.scale.y=e,this.sprite=data.addAtlasSprite("sticker",{center:!0,parent:this.group})},hide:function(){this.group.visible=!1},hideWithTween:function(){this.star=data.addAtlasSprite("stickerStar",{center:!0,parent:this.group}),this.group.sendToBack(this.star),this.star.scale.x=this.star.scale.y=0,game.add.tween(this.star.scale).to({x:1,y:1},500,Phaser.Easing.Back.Out,!0).to({x:0,y:0},500,Phaser.Easing.Back.In,!0,500),game.add.tween(this.star).to({rotation:Math.PI/2},2e3,Phaser.Easing.Linear.None,!0);var a=game.add.tween(this.group).to({alpha:0},500,Phaser.Easing.Linear.None,!0,1500);a.onComplete.addOnce(this.tweenComplete,this)},tweenComplete:function(){this.manager.stickerDissapeared()}}),App.BootState=function(){},App.BootState.prototype={preload:function(){this.load.image("preloadBar","assets/images/preloadBar.png"),this.load.image("preloadBarHolder","assets/images/preloadBarHolder.png"),this.load.image("background","assets/images/background.jpg"),this.load.image("cuteBack1.jpg","assets/images/cuteBack1.jpg"),game.stage.backgroundColor="#EBE7DA"},create:function(){this.game.input.maxPointers=1,Config.TRANSPARENT&&(this.game.world.alpha=.5),this.game.state.start("Preloader")},rescale:function(){var a=this.game;setTimeout(function(){a.scale.refresh()},500)}},App.GameCompleteState=function(){},App.GameCompleteState.prototype={create:function(){this.add.sprite(0,0,"cuteBack2.jpg"),this.posterComplete=data.addAtlasSprite("posterComplete",{x:50,y:50}),this.twitter=new App.MyButton("twitterButton",this.twitterClick,this,{x:120,y:488,center:!0,wobble:!0}),this.vk=new App.MyButton("vkButton",this.vkClick,this,{x:240,y:488,center:!0,wobble:!0}),this.home=new App.MyButton("homeButton",this.homeClick,this,{x:740,y:540,center:!0,wobble:!0});var a=data.getCorrectAnswers(),b="Правильные ответы: "+a+" из "+data.levels.length;this.answersTf=game.add.text(560,120,b,{font:"28px Russo One",fill:"#000000",align:"center"}),this.answersTf.anchor.set(.5,.5),this.addComment(a),this.showWithTweens(),App.Fader.SHOULD_FADE_OUT&&fader.fadeOut()},addComment:function(a){var b="...";b=10>a?"Слабовато. Попробуй еще раз.":20>a?"Дружище, тебе нужно лучше знать историю своей страны!":30>a?"Неплохо, мой друг. Из тебя бы вышел отличный коммунист!":"Ни одной ошибки! Скажи честно - тебе 100 лет и все советские плакаты были нарисованы при твоей жизни?",this.commentTf=game.add.text(560,220,b,{font:"24px Russo One",fill:"#333333"}),this.commentTf.anchor.set(.5,.5),this.commentTf.wordWrap=!0,this.commentTf.wordWrapWidth=400},showWithTweens:function(){util.showWithAlpha(this.answersTf),util.showWithAlpha(this.commentTf,{delay:1e3}),util.showWithAlpha(this.posterComplete,{delay:2e3}),util.showWithScale(this.twitter.bt,{delay:2100}),util.showWithScale(this.vk.bt,{delay:2200}),util.showWithScale(this.home.bt,{delay:3e3})},twitterClick:function(){var a="http://twitter.com/share?text=Советские плакаты! Угадай, что за стикером.&url=http://postepenno.com/ussr";window.open(a,"_blank")},vkClick:function(){var a="http://postepenno.com/ussr",b="Советские плакаты",c="Угадай, что за стикером.",d="http://vkontakte.ru/share.php?";d+="url="+encodeURIComponent(a),d+="&title="+encodeURIComponent(b),d+="&description="+encodeURIComponent(c),d+="&noparse=true",window.open(d,"","toolbar=0,status=0,width=626,height=436")},homeClick:function(){fader.fade(this.gotoMainMenu,this)},gotoMainMenu:function(){game.state.start("MainMenu")}},App.GameplayState=function(){},App.GameplayState.prototype={create:function(){this.add.sprite(0,0,"cuteBack1.jpg"),this.coreGroup=new Phaser.Group(this.game,this.game.world),this.uiGroup=new Phaser.Group(this.game,this.game.world),this.uiGroup.x=450,this.home=new App.MyButton("backButton",this.homeClick,this,{x:70,y:560,center:!0,parentGroup:this.uiGroup,wobble:!0}),this.soundIcon=new App.SoundIcon({x:175,y:560,parentGroup:this.uiGroup}),Config.ENABLE_CHEAT&&(this.cheatBt=new App.MyButton("cheatButton",this.cheatClick,this,{x:615,y:25,center:!0,parentGroup:this.uiGroup})),this.logic=new App.GameLogic(this.coreGroup,this.uiGroup),Config.ANIMATION&&this.showWithTweens(),App.Fader.SHOULD_FADE_OUT&&fader.fadeOut()},showWithTweens:function(){util.showWithAlpha(this.logic.poster,{time:1e3}),util.showWithAlpha(this.logic.question.group,{delay:1e3}),util.showWithAlpha(this.logic.buttons[0].group,{delay:1500,y:-40}),util.showWithAlpha(this.logic.buttons[1].group,{delay:1600,y:-40}),util.showWithAlpha(this.logic.buttons[2].group,{delay:1700,y:-40}),util.showWithAlpha(this.logic.buttons[3].group,{delay:1800,y:-40})},nextClick:function(){cmd.levelNext()},homeClick:function(){fader.fade(this.gotoMainMenu,this)
},gotoMainMenu:function(){game.state.start("MainMenu")},cheatClick:function(){cmd.levelComplete()},levelComplete:function(){this.next=new App.MyButton("nextButton",this.nextClick,this,{x:280,y:560,center:!0,parentGroup:this.uiGroup,wobble:!0}),util.showWithAlpha(this.next.bt)},tweenAlphaButton:function(a,b){a.alpha=0,this.add.tween(a).to({alpha:1},500,Phaser.Easing.Linear.None,!0,b)}},App.LevelSelectState=function(){},App.LevelSelectState.prototype={create:function(){this.add.sprite(0,0,"cuteBack2.jpg"),data.addAtlasSprite("itemsBack",{x:160,y:20}),this.home=new App.MyButton("homeButton",this.homeClick,this,{x:70,y:530,center:!0,wobble:!0}),this.itemsHolder=new Phaser.Group(this.game,this.game.world),this.groupsNum=1;for(var a=0;a<this.groupsNum;a++){new App.LevelsGroup(this.game,a,this.itemsHolder)}App.Fader.SHOULD_FADE_OUT&&fader.fadeOut()},scrollUpClick:function(){1==App.LevelSelectState.CURRENT_GROUP_ID&&this.scrollUp.scaleHide(),App.LevelSelectState.CURRENT_GROUP_ID==this.groupsNum-1&&this.scrollDown.scaleShow(),App.LevelSelectState.CURRENT_GROUP_ID--,this.scrollUp.disableClick(),this.scrollDown.disableClick();var a=this.game.add.tween(this.itemsHolder);a.to({y:-Config.HEIGHT*App.LevelSelectState.CURRENT_GROUP_ID},500,Phaser.Easing.Quadratic.InOut,!0),a.onComplete.addOnce(this.scrollComplete,this)},scrollDownClick:function(){0==App.LevelSelectState.CURRENT_GROUP_ID&&this.scrollUp.scaleShow(),App.LevelSelectState.CURRENT_GROUP_ID==this.groupsNum-2&&this.scrollDown.scaleHide(),App.LevelSelectState.CURRENT_GROUP_ID++,this.scrollUp.disableClick(),this.scrollDown.disableClick();var a=this.game.add.tween(this.itemsHolder);a.to({y:-Config.HEIGHT*App.LevelSelectState.CURRENT_GROUP_ID},500,Phaser.Easing.Quadratic.InOut,!0),a.onComplete.addOnce(this.scrollComplete,this)},scrollComplete:function(){this.scrollUp.enableClick(),this.scrollDown.enableClick()},homeClick:function(){fader.fade(this.gotoMainMenu,this)},gotoMainMenu:function(){this.game.state.start("MainMenu")}},App.LevelSelectState.CURRENT_GROUP_ID=0,App.MainMenuState=function(){},App.MainMenuState.prototype={create:function(){this.add.sprite(0,0,"cuteBack1.jpg"),this.poster=data.addAtlasSprite("soski",{x:384}),this.title=new App.GameTitle(190,180),this.playBt=new App.MyButton("playButton",this.playClick,this,{x:192,y:490,center:!0,wobble:!0}),this.creditsBt=new App.MyButton("creditsButton",this.creditsClick,this,{x:60,y:490,center:!0,wobble:!0}),this.soundIcon=new App.SoundIcon({x:320,y:490});var a="v "+Config.VERSION,b=this.add.text(5,Config.HEIGHT-5,a,{font:"12px Russo One",fill:"#000000"});b.anchor.set(0,1),Config.ANIMATION&&this.showWithTweens(),App.Fader.SHOULD_FADE_OUT&&fader.fadeOut()},showWithTweens:function(){util.showWithAlpha(this.poster),util.showWithAlpha(this.title.group,{delay:500}),util.showWithScale(this.soundIcon.group,{delay:1e3}),util.showWithScale(this.creditsBt.bt,{delay:1200}),util.showWithScale(this.playBt.bt,{delay:1400})},playClick:function(){fader.fade(this.startGame,this)},startGame:function(){cmd.gameStart()},creditsClick:function(){new App.CreditsView},update:function(){this.title.update()}},App.PreloaderState=function(){},App.PreloaderState.prototype={preload:function(){this.add.sprite(0,0,"cuteBack1.jpg");var a,b=["fader","blackBack","cuteBack2.jpg"],c=["sndClick","sndLevelComplete","sndWrong","music"];for(a=0;a<b.length;a++){var d=-1==b[a].indexOf(".jpg")?b[a]+".png":b[a];this.load.image(b[a],"assets/images/"+d)}for(a=0;a<c.length;a++){var e=c[a]+".mp3",f=c[a]+".ogg";this.load.audio(c[a],["assets/sounds/"+e,"assets/sounds/"+f])}this.load.atlasJSONHash("atlas","assets/images/atlas.png","assets/images/atlas.json"),this.load.atlasJSONHash("paintings","assets/images/paintings.jpg","assets/images/paintings.json"),this.load.bitmapFont("eras","assets/fonts/eras.png","assets/fonts/eras.fnt"),this.load.text("textData","assets/txt/TextData.json"),this.holder=this.game.add.group(),this.preloadBar=this.add.sprite(Config.WIDTH/2,Config.HEIGHT/2,"preloadBar",null,this.holder),this.preloadBar.x-=this.preloadBar.width/2,this.preloadBar.y-=this.preloadBar.height/2,this.progressTxt=this.game.add.text(Config.WIDTH/2,430,"0%",{font:"bold 50px Arial",fill:"#FFFFFF"},this.holder),this.progressTxt.anchor.set(.5,0),this.load.setPreloadSprite(this.preloadBar),this.load.onFileComplete.add(this.fileLoaded,this)},fileLoaded:function(a){this.progressTxt.setText(a+"%")},create:function(){if(Config.ANIMATION){var a=this.game.add.tween(this.holder).to({alpha:0,y:this.holder.y+60},800,Phaser.Easing.Linear.None,!0);a.onComplete.addOnce(this.preloaderComplete,this)}else this.preloaderComplete()},preloaderComplete:function(){fader=new App.Fader(this.game),cmd=new App.Commands,data=new App.Data,cookies=new App.Cookies,sounds=new App.Sounds,sounds.startMusic(),util=new App.Util,this.game.state.start("MainMenu")}};